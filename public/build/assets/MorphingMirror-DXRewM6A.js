var Le=Object.defineProperty;var Xe=(e,i,s)=>i in e?Le(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s;var I=(e,i,s)=>(Xe(e,typeof i!="symbol"?i+"":i,s),s);import{d as xe,l as A,m as Pe,o as S,g as H,b as B,F as ie,s as le,Q as Re,p as Ee,q as je,a as Ae,h as j,u as we,x as Oe,e as ve,t as be}from"./app-BM1evEm7.js";import{r as $e}from"./register_all_kernels-DPvm_hBi.js";import{k as Ge,S as Ke,q as Ue,U as qe}from"./body-segmentation.esm-CriI99Ng.js";import{m as Fe,s as de,p as Me,M as Qe}from"./Mirror-fbttQdJw.js";const Je=async e=>{await $e(),console.log("Tensorflow ready"),console.log("Setting up inferences"),e.inference.bodyPix=void 0;const i=await Ge(Ke.BodyPix);e.inference.bodyPix=i,console.log("BodyPix ready"),e.inference.blazePose=void 0;const s={runtime:"tfjs",enableSmoothing:!0,modelType:"lite"},r=await Fe(de.BlazePose,s);e.inference.blazePose=r,console.log("BlazePose ready")},Ze=async e=>{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(g=>g.stop());const o=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput").map(g=>({device:g,capabilities:g.getCapabilities()}));console.log(o);const a=o.find(g=>g.device.label.includes("back"))||o[0];e.availableVideoDevices=o,e.currentVideoDeviceId=a.device.deviceId,console.log("Current video device: "+a.device.label)},et=async e=>{if(!e.currentVideoDeviceId){console.error("No current video device");return}e.availableVideoDevices.find(o=>o.device.deviceId===e.currentVideoDeviceId);const s=(e.availableVideoDevices.findIndex(o=>o.device.deviceId===e.currentVideoDeviceId)+1)%e.availableVideoDevices.length,r=e.availableVideoDevices[s];e.currentVideoDeviceId=r.device.deviceId,console.log("Switching video device to: "+r.device.label),De(e,e.div_video)},De=async(e,i)=>{if(!i){console.error("No video div");return}if(e.video){const o=e.video.srcObject;o&&o.getTracks().forEach(a=>a.stop()),e.video.pause(),e.video.srcObject=null,e.video=null,i.innerHTML=""}e.div_video=i;const s=document.createElement("video");s.width=640,s.height=480,s.muted=!0,s.setAttribute("playsinline","true"),s.style.objectFit="cover",i.innerHTML="",i.appendChild(s),console.log("Getting media stream"),console.log(e.availableVideoDevices);const r={video:{deviceId:e.currentVideoDeviceId?{exact:e.currentVideoDeviceId}:void 0,width:{ideal:640},height:{ideal:480}}};try{const o=await navigator.mediaDevices.getUserMedia(r);s.srcObject=o}catch(o){console.error("Error accessing media devices.",o);return}if(await new Promise(o=>{s.onloadedmetadata=()=>{console.log("Video metadata loaded"),o(!0)}}),s.play(),!s){console.error("No video element available");return}return e.video=s,await new Promise(o=>{s.addEventListener("loadeddata",()=>{console.log("Video loaded"),o(!0)})}),new Promise(o=>{o(!0)})},tt=async(e,i,s)=>{var a,g;if(!i){console.error("No div process");return}e.div_process=i;const r=document.createElement("canvas");if(r.id="canvas_process",r.width=((a=e.video)==null?void 0:a.videoWidth)||0,r.height=((g=e.video)==null?void 0:g.videoHeight)||0,e.canvas_process=r,e.div_process.appendChild(r),!s){console.error("No div render");return}e.div_render=s;const o=document.createElement("canvas");return o.id="canvas_render",o.width=e.div_render.clientWidth,o.height=e.div_render.clientHeight,e.canvas_render=o,e.div_render.appendChild(o),new Promise(m=>{m(!0)})},it=async(e,i)=>{if(!i||!e.inference.bodyPix){console.error("No video or inference");return}const s=e.inference.bodyPix,r={multiSegmentation:!1,segmentBodyParts:!0,maxDetections:1},o=await s.segmentPeople(i,r);e.inferenceData.bodyPixSegmentation=o;const a=await Ue(o,qe,{r:255,g:255,b:255,a:255});return e.inferenceData.coloredPartImage=a,e.inferenceData.maskData=await o[0].mask.toImageData(),o},ot=async(e,i)=>{if(!i||!e.inference.blazePose){console.error("No video or inference");return}const s={flipHorizontal:!1,maxPoses:1},r=performance.now(),a=await e.inference.blazePose.estimatePoses(i,s,r);return e.inferenceData.poses=a,a},st=async(e,i)=>{let s=[];const r=i.data,o=i.width;i.height;for(let a=0;a<r.length;a+=4){const g=r[a],m=r[a+1],_=r[a+2],u=r[a+3],n=a/4%o,c=Math.floor(a/4/o);s.push({x:n,y:c,color:{r:g,g:m,b:_,a:u}})}return e.inferenceData.pixels=s,s},ke={head:[0,1,2,3,4,5,6,7,8,9,10],torso:[11,12,24,23],right_arm:[12,14,16,22],left_arm:[11,13,15,21],right_leg:[24,26,28,32],left_leg:[23,25,27,31],right_hand:[16,18,20,22],left_hand:[15,17,19,21],right_foot:[28,30,32],left_foot:[27,29,31]},nt=async(e,i,s)=>{for(const r of i){const o=r.keypoints,a=r.keypoints3D||[];at(e,o,a)}},at=async(e,i,s,r)=>{var a,g;e.boundingBoxes=[],e.inferenceData.pixels,(a=e.inferenceData.maskData)==null||a.width,(g=e.inferenceData.maskData)==null||g.height;const o=Object.keys(ke);for(let m of o){const _=m,u=[],n=[];for(const v of ke[_])u.push(i[v]),n.push(s[v]);const c=Math.min(...u.map(v=>v.x)),t=Math.min(...u.map(v=>v.y)),l=Math.max(...u.map(v=>v.x)),d=Math.max(...u.map(v=>v.y)),h=l-c,p=d-t,w={x:c,y:t,width:h,height:p,keypoints:u,keypoints3D:n,label:`${_}_pose`};e.boundingBoxes.push(w)}},rt=async e=>{e.boundingBoxesProcessed=[];const i=e.boundingBoxes.find(f=>f.label==="head_pose"),s=e.boundingBoxes.find(f=>f.label==="torso_pose"),r=e.boundingBoxes.find(f=>f.label==="right_arm_pose"),o=e.boundingBoxes.find(f=>f.label==="left_arm_pose"),a=e.boundingBoxes.find(f=>f.label==="right_leg_pose"),g=e.boundingBoxes.find(f=>f.label==="left_leg_pose"),m=e.boundingBoxes.find(f=>f.label==="right_hand_pose"),_=e.boundingBoxes.find(f=>f.label==="left_hand_pose"),u=e.boundingBoxes.find(f=>f.label==="right_foot_pose"),n=e.boundingBoxes.find(f=>f.label==="left_foot_pose");if(!i||!s||!r||!o||!a||!g||!m||!_||!u||!n){console.error("Some bounding boxes are undefined");return}const c=s.width*.75,t=c*1.15,l=i.x-(c-i.width)/2,d=i.y-(t-i.height)/2,h={x:l,y:d,width:c,height:t,keypoints:i.keypoints,keypoints3D:i.keypoints3D,label:"head_processed"};e.boundingBoxesProcessed.push(h);const p=t*1.65,w=s.height*1.25,v=s.x-(p-s.width)/2,N=s.y-(w-s.height)/2,x={x:v,y:N,width:p,height:w,keypoints:s.keypoints,keypoints3D:s.keypoints3D,label:"torso_processed"};e.boundingBoxesProcessed.push(x);const P=r.keypoints.find(f=>f.name==="right_shoulder"),y=r.keypoints.find(f=>f.name==="right_elbow"),V=r.keypoints.find(f=>f.name==="right_wrist");r.keypoints.find(f=>f.name==="right_thumb");const L=r.width*1.45,C=Math.abs(P.y-y.y)+Math.abs(y.y-V.y)*1.35,D=r.x-(L-r.width)/2,X=r.y-(C-r.height)/2,O={x:D,y:X,width:L,height:C,keypoints:r.keypoints,keypoints3D:r.keypoints3D,label:"right_arm_processed"};e.boundingBoxesProcessed.push(O);const ce=o.keypoints.find(f=>f.name==="left_shoulder"),oe=o.keypoints.find(f=>f.name==="left_elbow"),he=o.keypoints.find(f=>f.name==="left_wrist");o.keypoints.find(f=>f.name==="left_thumb");const q=o.width*1.45,z=Math.abs(ce.y-oe.y)+Math.abs(oe.y-he.y)*1.35,F=o.x-(q-o.width)/2,Q=o.y-(z-o.height)/2,$={x:F,y:Q,width:q,height:z,keypoints:o.keypoints,keypoints3D:o.keypoints3D,label:"left_arm_processed"};e.boundingBoxesProcessed.push($);const T=m.width*3,Y=m.height*1.5,te=m.x-(T-m.width)/2,G=m.y-(Y-m.height)/2,J={x:te,y:G,width:T,height:Y,keypoints:m.keypoints,keypoints3D:m.keypoints3D,label:"right_hand_processed"};e.boundingBoxesProcessed.push(J);const Z=_.width*3,ee=_.height*1.5,se=_.x-(Z-_.width)/2,ne=_.y-(ee-_.height)/2,b={x:se,y:ne,width:Z,height:ee,keypoints:_.keypoints,keypoints3D:_.keypoints3D,label:"left_hand_processed"};e.boundingBoxesProcessed.push(b);const M=a.keypoints.find(f=>f.name==="right_hip"),k=a.keypoints.find(f=>f.name==="right_knee"),W=a.keypoints.find(f=>f.name==="right_ankle");a.keypoints.find(f=>f.name==="right_foot_index");const R=a.width*1.35,K=Math.abs(M.y-k.y)+Math.abs(k.y-W.y)*1.35,E=a.x-(R-a.width)/2,U=a.y-(K-a.height)/2,ae={x:E,y:U,width:R,height:K,keypoints:a.keypoints,keypoints3D:a.keypoints3D,label:"right_leg_processed"};e.boundingBoxesProcessed.push(ae);const Be=g.keypoints.find(f=>f.name==="left_hip"),ge=g.keypoints.find(f=>f.name==="left_knee"),Ce=g.keypoints.find(f=>f.name==="left_ankle");g.keypoints.find(f=>f.name==="left_foot_index");const pe=g.width*1.35,fe=Math.abs(Be.y-ge.y)+Math.abs(ge.y-Ce.y)*1.35,Ie=g.x-(pe-g.width)/2,Se=g.y-(fe-g.height)/2,He={x:Ie,y:Se,width:pe,height:fe,keypoints:g.keypoints,keypoints3D:g.keypoints3D,label:"left_leg_processed"};e.boundingBoxesProcessed.push(He);const me=u.width*1.5,ue=u.height*1.5,Ve=u.x-(me-u.width)/2,We=u.y-(ue-u.height)/2,Ne={x:Ve,y:We,width:me,height:ue,keypoints:u.keypoints,keypoints3D:u.keypoints3D,label:"right_foot_processed"};e.boundingBoxesProcessed.push(Ne);const _e=n.width*1.5,ye=n.height*1.5,Te=n.x-(_e-n.width)/2,Ye=n.y-(ye-n.height)/2,ze={x:Te,y:Ye,width:_e,height:ye,keypoints:n.keypoints,keypoints3D:n.keypoints3D,label:"left_foot_processed"};e.boundingBoxesProcessed.push(ze)},lt=async(e,i)=>{await it(e,i),await ot(e,i),await st(e,e.inferenceData.maskData),e.inferenceData.poses&&e.inferenceData.coloredPartImage&&(await nt(e,e.inferenceData.poses,e.inferenceData.coloredPartImage),await rt(e))},dt=async e=>{if(!e.canvas_process){console.error("No canvas");return}const i=e.canvas_process,s=i.getContext("2d");if(!s){console.error("No context");return}s.clearRect(0,0,i.width,i.height)},ct=async e=>{if(!e.canvas_process||!e.video){console.error("No canvas or video");return}const i=e.canvas_process,s=i.getContext("2d");if(!s){console.error("No context");return}s.drawImage(e.video,0,0,i.width,i.height)},ht=async(e,i,s)=>{if(!i){console.error("No context");return}const r=Me.getKeypointIndexBySide(de.BlazePose);i.fillStyle="Red",i.lineWidth=5;for(const o of r.middle)i.strokeStyle=s[o].score??!1?"rgba(0,255,0,1)":"rgba(0,0,255)",re(e,i,s[o]);i.fillStyle="Green";for(const o of r.left)i.strokeStyle=s[o].score??!1?"rgba(0,255,0,1)":"rgba(0,0,255)",re(e,i,s[o]);i.fillStyle="Orange";for(const o of r.right)i.strokeStyle=s[o].score??!1?"rgba(0,255,0,1)":"rgba(0,0,255)",re(e,i,s[o])},re=async(e,i,s)=>{const r=s.score!=null?s.score:1,o=0,a=8;if(r>=o){const g=new Path2D;g.arc(s.x,s.y,a,0,2*Math.PI),i.fill(g),i.stroke(g)}},gt=async(e,i,s,r)=>{const o="#a9a9a9";i.fillStyle=o,i.strokeStyle=o,i.lineWidth=3,Me.getAdjacentPairs(de.BlazePose).forEach(([a,g])=>{const m=s[a],_=s[g],u=m.score!=null?m.score:1,n=_.score!=null?_.score:1,c=0;u>=c&&n>=c&&(i.beginPath(),i.moveTo(m.x,m.y),i.lineTo(_.x,_.y),i.stroke())})},pt=async e=>{if(!e.canvas_process||!e.inferenceData.poses)return;const s=e.canvas_process.getContext("2d");if(!s){console.error("No context");return}const r=e.inferenceData.poses;r.length>0&&(ht(e,s,r[0].keypoints),gt(e,s,r[0].keypoints))},ft=async e=>{await dt(e),await ct(e),await pt(e)};class mt{constructor(){I(this,"drawCanvas",!1);I(this,"canvasses",null);I(this,"cutouts",[]);I(this,"div_video",null);I(this,"video",null);I(this,"div_process",null);I(this,"canvas_process",null);I(this,"div_render",null);I(this,"canvas_render",null);I(this,"mousePos",{x:0,y:0});I(this,"availableVideoDevices",[]);I(this,"currentVideoDeviceId");I(this,"inference",{bodyPix:void 0,blazePose:void 0,cocoSsd:void 0,selfieSegmentation:void 0});I(this,"inferenceData",{poses:void 0,bodyPixSegmentation:void 0,coloredPartImage:void 0,pixels:void 0,maskData:void 0,detectedOjects:void 0,humans:void 0});I(this,"boundingBoxes",[]);I(this,"boundingBoxesProcessed",[]);console.log("ImageProcessor constructor")}async init(i,s,r){return console.log("init"),await Je(this),console.log("Inferences setup"),await Ze(this),console.log("Got available video devices"),await De(this,i),console.log("Got media stream"),await tt(this,s,r),console.log("Canvasses created"),new Promise((o,a)=>{o(!0)})}async switchVideoDevice(){await et(this)}async loop(){if(!this.video||!this.canvas_process){console.error("No video or canvas");return}await lt(this,this.video),await this.draw(),await this.render()}async draw(){await ft(this)}async render(){if(!this.canvas_process||!this.canvas_render){console.error("No canvas or rendering canvas");return}const i=this.canvas_process,s=this.canvas_render,r=s.getContext("2d"),o=i.getContext("2d");if(!r||!o){console.error("No context");return}const a=i.width/i.height,g=s.height,m=g*a,_=(s.width-m)/2;r.drawImage(i,_,0,m,g)}}const ut=["src","alt"],_t=xe({__name:"Camera",emits:["newSlice","pictureTaken"],setup(e,{emit:i}){const s=new mt,r=A(null),o=A(null),a=A(null),g=i;Pe(async()=>{r.value&&o.value&&a.value&&(await s.init(r.value,o.value,a.value),requestAnimationFrame(m))});const m=async()=>{r.value&&o.value&&(await s.loop(),requestAnimationFrame(m))},_=A([]),u=()=>{s.switchVideoDevice()},n=()=>{console.log("take photo"),console.log("making collage with ",s.boundingBoxesProcessed),g("pictureTaken",s.boundingBoxesProcessed)};return(c,t)=>(S(),H(ie,null,[B("div",{ref_key:"video_container",ref:r,class:"video-container"},null,512),B("div",{ref_key:"div_process",ref:o,class:"div-process"},null,512),B("div",{ref_key:"div_render",ref:a,class:"div-render"},null,512),B("button",{class:"switch-device-button",onClick:u},"Switch Device"),B("div",{class:"take-photo-button",onClick:n},"Take Photo"),(S(!0),H(ie,null,le(_.value,l=>(S(),H("div",{key:l.part},[B("img",{src:l.img,alt:l.part},null,8,ut)]))),128))],64))}}),yt=async(e,i,s,r)=>{console.log("corpse",e),console.log(i.clientHeight);const o=document.createElement("canvas");o.id="collage-canvas",o.width=r.x,o.height=r.y,i.innerHTML="",i==null||i.appendChild(o);const a=o.getContext("2d");if(!a){console.error("no ctx");return}let g=Object.keys(e);if(s.length>0){let b=g[Math.floor(Math.random()*g.length)],M=s[Math.floor(Math.random()*s.length)],k=e[b],W=new Image;W.src=M.img,await new Promise(ae=>{W.onload=()=>{ae()}}),W.width,W.height,k.label;const R={...k,path:M.img,base_image:{...k.base_image,path:M.img}},K={...e,[b]:R},E=[...g],U=E.indexOf(b);U!==-1&&E.splice(U,1),E.push(b),e=K,g=E}console.log("keys",g);let m=[];for(let b=0;b<g.length;b++){const M=g[b],k=e[M],W=new Image;W.src=k.path,await new Promise(U=>{W.onload=()=>{U()}});const R=W.width,K=W.height,E=M;m.push({img:W,width:R,height:K,label:E})}m=m.sort(()=>Math.random()-.5);const _=o.width,u=o.height,n={x:_/2,y:u/2};let c={};for(let b=0;b<m.length;b++){const M=m[b];let k=M.width;M.width=_,M.height=M.height*(M.width/k),c[M.label]=M}console.log("pieces",m),a.fillStyle="gray",a.fillRect(0,0,_,u);let t=0,l=0,d=0,h=0,p="empty",w=.05,v={min:.9,max:1.1},N=1,x=0,P=0,y={},V=1,L=10,C=0,D=!1,X=.15,O=.15;for(p="middle",V=c[p].height/c[p].width,x=_*(Math.random()*(.65-.45)+.45),P=x*V,d=x*N,h=P*(d/x),t=n.x-d/2,l=n.y-h/2,a.fillStyle="red",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h},p="top",V=c[p].height/c[p].width,P=y.middle.y-0-u*w,x=P/V,h=P*N,d=x*(h/P),D=!1,C=0,O=0,X=.35,v={min:.75,max:1};!D&&C<L;)d=y.middle.width*(Math.random()*(v.max-v.min)+v.min),h=d*(P/x),t=Math.random()*(y.middle.width-d)+y.middle.x,l=y.middle.y-h,l+=h*X*Math.random(),D=!0,C++;if(!D){console.error("Could not find a valid position");return}for(a.fillStyle="blue",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h},p="left",V=c[p].height/c[p].width,x=y.middle.x-0-_*w,P=x*V,d=x*N,h=P*(d/x),D=!1,C=0,O=.35,v={min:.75,max:1};!D&&C<L;)d=y.middle.width*(Math.random()*(v.max-v.min)+v.min),h=d*(P/x),l=Math.random()*(y.middle.height-h)+y.middle.y,t=y.middle.x-d,t+=d*O*Math.random(),D=!0,C++;if(!D){console.error("Could not find a valid position");return}for(a.fillStyle="green",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h},p="right",V=c[p].height/c[p].width,x=_-y.middle.x-y.middle.width-_*w,P=x*V,d=x*N,h=P*(d/x),D=!1,C=0,O=.65,v={min:.75,max:1};!D&&C<L;)d=y.middle.width*(Math.random()*(v.max-v.min)+v.min),h=d*(P/x),l=Math.random()*(y.middle.height-h)+y.middle.y,t=y.middle.x+y.middle.width,t-=d*O*Math.random(),D=!0,C++;if(!D){console.error("Could not find a valid position");return}a.fillStyle="purple",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h},p="low",V=c[p].height/c[p].width;let q=(u-y.middle.y-y.middle.height-u*w/2)/2;for(P=q,x=P/V,h=P*N,d=x*(h/P),D=!1,C=0,X=.55,v={min:.75,max:1};!D&&C<L;)d=y.middle.width*(Math.random()*(v.max-v.min)+v.min),h=d*(P/x),t=Math.random()*(y.middle.width-d)+y.middle.x,l=y.middle.y+y.middle.height,l-=h*X*Math.random(),D=!0,C++;if(!D){console.error("Could not find a valid position");return}for(a.fillStyle="yellow",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h},p="lowlow",V=c[p].height/c[p].width,P=q,x=P/V,h=P*N,d=x*(h/P),D=!1,C=0,X=.5,v={min:.75,max:1};!D&&C<L;)d=y.low.width*(Math.random()*(v.max-v.min)+v.min),h=d*(P/x),t=Math.random()*(y.low.width-d)+y.low.x,l=y.low.y+y.low.height,l-=h*X*Math.random(),D=!0,C++;a.fillStyle="orange",a.fillRect(t,l,d,h),y[p]={x:t,y:l,width:d,height:h};let z=Object.keys(y),F=1/0,Q=1/0;for(let b=0;b<z.length;b++){const M=z[b],k=y[M];k.x<F&&(F=k.x),k.y<Q&&(Q=k.y)}for(let b=0;b<z.length;b++){const M=z[b],k=y[M];k.x-=F,k.y-=Q}let $=document.createElement("canvas"),T=0,Y=0;for(let b=0;b<z.length;b++){const M=z[b],k=y[M];k.x+k.width>T&&(T=k.x+k.width),k.y+k.height>Y&&(Y=k.y+k.height)}$.width=T,$.height=Y,console.log("totalWidth",T),console.log("totalHeight",Y);let te=$.getContext("2d");if(!te){console.error("no buffer ctx");return}let G=["middle","top","left","right","low","lowlow"];G=G.sort(()=>Math.random()-.5);for(let b=0;b<G.length;b++){const M=G[b],k=y[M];let W=k.x,R=k.y;te.drawImage(c[M].img,W,R,k.width*N,k.height*N)}let J=1;w=.05,(T>_-_*w||Y>u-u*w)&&(J=Math.min((_-_*w)/T,(u-u*w)/Y));let Z=T*J,ee=Y*J,se=(_-Z)/2,ne=(u-ee)/2;return a.fillStyle="gray",a.fillRect(0,0,_,u),a.drawImage($,se,ne,Z,ee),new Promise(b=>{b()})},wt=async(e,i,s,r)=>{console.log("createCollageBoundingBoxes"),console.log("corpse",e),console.log("collage_container",i),console.log("boundingBoxes",s),console.log("startingSize",r);const o=document.createElement("canvas");o.width=r.x,o.height=r.y,o.id="collage-canvas",i.innerHTML="",i.appendChild(o);const a=o.getContext("2d");if(!a){console.error("No context");return}let g=Object.keys(e);console.log("keys",g);let m=[];for(let u=0;u<g.length;u++){const n=g[u],c=e[n],t=new Image;t.src=c.path,await new Promise(p=>{t.onload=()=>{p()}});const l=t.width,d=t.height,h=n;m.push({img:t,width:l,height:d,label:h})}m=m.sort(()=>Math.random()-.5),console.log("pieces",m);const _=s.filter(u=>u.x!==1/0&&u.y!==1/0&&u.width!==1/0&&u.height!==1/0);console.log("filteredBoundingBoxes",_);for(let u=0;u<_.length;u++){const n=_[u];let c=!1,t=null;switch(a.strokeStyle="blue",a.strokeRect(n.x,n.y,n.width,n.height),n.label){case"head_processed":if(c="head",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+n.height-h;a.drawImage(t.img,p,w,d,h)}break;case"torso_processed":if(c="torso",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"right_arm_processed":if(c="right_arm",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+n.width-d,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"left_arm_processed":if(c="left_arm",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"right_leg_processed":if(c="right_leg",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+n.width-d,w=n.y;a.drawImage(t.img,p,w,d,h)}break;case"left_leg_processed":if(c="left_leg",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x,w=n.y;a.drawImage(t.img,p,w,d,h)}break;case"right_foot_processed":if(c="right_foot",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"left_foot_processed":if(c="left_foot",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"right_hand_processed":if(c="right_hand",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;case"left_hand_processed":if(c="left_hand",t=m.find(l=>l.label===c),t){const l=Math.min(n.width/t.width,n.height/t.height),d=t.width*l,h=t.height*l,p=n.x+(n.width-d)/2,w=n.y+(n.height-h)/2;a.drawImage(t.img,p,w,d,h)}break;default:c=!1}}},vt={class:"morphing-mirror-layout"},bt=B("header",null,[B("h1",null,"MU - Morphing Mirror")],-1),kt=["hidden"],xt=B("span",{class:"hint"}," Click on the video to capture a slice ",-1),Pt={key:0,class:"slices"},Mt=["hidden"],Dt=["hidden"],Bt={class:"list-container"},Ct=B("h2",null,"Used slices",-1),It=B("br",null,null,-1),St=B("footer",null,"(alpha test)",-1),Ht=3,zt=xe({__name:"MorphingMirror",setup(e){new Qe;const i=A(null),s=Re(),r=A([]),o=A("camera");Pe(async()=>{document.body.classList.add("mirror"),await Ee()}),je(()=>{document.body.classList.remove("mirror")});const a=A(!1),g=async()=>{if(a.value)return;if(a.value=!0,!i.value){console.error("no collage container");return}if(!s.props.corpse){console.error("no corpse");return}let n=document.getElementById("canvas_process");if(!n){console.error("no container");return}let c={x:n.offsetWidth,y:n.offsetHeight};await yt(s.props.corpse,i.value,r.value,c),o.value="collage",a.value=!1},m=n=>{r.value.unshift(n),r.value.length>Ht&&r.value.pop()},_=()=>{window.location.reload()},u=async n=>{if(console.log("picture taken",n),a.value)return;if(a.value=!0,!i.value){console.error("no collage container");return}if(!s.props.corpse){console.error("no corpse");return}let c=document.getElementById("canvas_process");if(!c){console.error("no container");return}let t={x:c.offsetWidth,y:c.offsetHeight};await wt(s.props.corpse,i.value,n,t),o.value="collage",a.value=!1};return(n,c)=>(S(),H("div",vt,[bt,B("main",null,[B("div",{class:"screen",hidden:o.value!="camera"},[xt,Ae(_t,{onNewSlice:m,onPictureTaken:u}),r.value.length?(S(),H("div",Pt,[(S(!0),H(ie,null,le(r.value,t=>(S(),H("div",{key:t.part,class:"slice",style:Oe(`background-image: url('${t.img}')`)},null,4))),128))])):j("",!0),r.value.length?(S(),H("button",{key:1,class:"collage-button",onClick:g},"Make Collage")):j("",!0)],8,kt),B("div",{class:"screen",hidden:o.value!="collage"},[B("div",{ref_key:"collage_container",ref:i,class:"collage collage-container"},null,512),r.value.length?(S(),H("button",{key:0,class:"redo-button",onClick:c[0]||(c[0]=t=>o.value="camera")},"Start Over")):j("",!0),r.value.length?(S(),H("button",{key:1,class:"redo-button",onClick:c[1]||(c[1]=t=>o.value="camera")},"Go back")):j("",!0),r.value.length?(S(),H("button",{key:2,class:"start-over-button",onClick:c[2]||(c[2]=t=>_())},"Start over with new corpse")):j("",!0),r.value.length?(S(),H("button",{key:3,class:"list-button",onClick:c[3]||(c[3]=t=>o.value="list")},"List")):j("",!0)],8,Mt),B("div",{class:"screen",hidden:o.value!="list"},[B("div",Bt,[Ct,we(s).props.corpse?(S(!0),H(ie,{key:0},le(we(s).props.corpse,t=>(S(),H("div",{key:t.id,class:"list-item"},[B("span",null,[ve(" Name:"),It,ve(" "+be(t.base_image.name??"no name"),1)]),B("span",null," Link: "+be(t.base_image.link??"no link"),1)]))),128)):j("",!0)]),r.value.length?(S(),H("button",{key:0,class:"list-button",onClick:c[4]||(c[4]=t=>o.value="collage")},"Go Back")):j("",!0)],8,Dt)]),St]))}});export{zt as default};
