var io=Object.defineProperty;var oo=(s,i,r)=>i in s?io(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r;var oe=(s,i,r)=>(oo(s,typeof i!="symbol"?i+"":i,r),r);import{_ as so}from"./PoolLayout.vue_vue_type_script_setup_true_lang-BFzpikBF.js";import{_ as ao}from"./BaseImageDetails.vue_vue_type_script_setup_true_lang-CxnUkd6V.js";import{ds as uo,dt as lo,cY as Bt,du as co,dv as fo,d2 as Z,dc as Dt,b as st,d7 as We,d3 as Xe,d8 as Ie,db as An,dh as _n,dk as ho,c_ as Te,c$ as Lt,dw as En,df as po,d4 as mo,d5 as vo,dd as jn,d1 as go,d9 as at,dx as Wr,dy as Vr,da as Ut,de as Mn,dq as yo,dz as wo,dA as bo,dn as ut,d as Gr,dB as Yr,dC as xo,dD as So,dg as Ao,cZ as _o}from"./register_all_kernels-BiFiLXma.js";import{y as It,z as Kr,d as Eo,Q as jo,l as At,m as Mo,o as Ee,c as ko,w as Oo,b as je,t as hn,u as dn,g as Pe,F as _t,s as _r,a as Po,n as To,h as Et,A as No}from"./app-Bt6mra0n.js";/** @license See the LICENSE file. */const Fo="4.19.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Io=Object.freeze(Object.defineProperty({__proto__:null,GraphModel:uo,deregisterOp:lo,loadGraphModel:Bt,loadGraphModelSync:co,registerOp:fo,version_converter:Fo},Symbol.toStringTag,{value:"Module"}));var Ro={};(function(){var s;function i(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};function u(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof It=="object"&&It];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}var a=u(this);function f(e,t){if(t)e:{var n=a;e=e.split(".");for(var o=0;o<e.length-1;o++){var l=e[o];if(!(l in n))break e;n=n[l]}e=e[e.length-1],o=n[e],t=t(o),t!=o&&t!=null&&r(n,e,{configurable:!0,writable:!0,value:t})}}f("Symbol",function(e){function t(h){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(o+(h||"")+"_"+l++,h)}function n(h,c){this.h=h,r(this,"description",{configurable:!0,writable:!0,value:c})}if(e)return e;n.prototype.toString=function(){return this.h};var o="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",l=0;return t}),f("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var o=a[t[n]];typeof o=="function"&&typeof o.prototype[e]!="function"&&r(o.prototype,e,{configurable:!0,writable:!0,value:function(){return d(i(this))}})}return e});function d(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function m(e){var t=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:i(e)}}function y(e){if(!(e instanceof Array)){e=m(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}var v=typeof Object.assign=="function"?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(e[l]=o[l])}return e};f("Object.assign",function(e){return e||v});var p=typeof Object.create=="function"?Object.create:function(e){function t(){}return t.prototype=e,new t},x;if(typeof Object.setPrototypeOf=="function")x=Object.setPrototypeOf;else{var w;e:{var A={a:!0},S={};try{S.__proto__=A,w=S.a;break e}catch{}w=!1}x=w?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var j=x;function O(e,t){if(e.prototype=p(t.prototype),e.prototype.constructor=e,j)j(e,t);else for(var n in t)if(n!="prototype")if(Object.defineProperties){var o=Object.getOwnPropertyDescriptor(t,n);o&&Object.defineProperty(e,n,o)}else e[n]=t[n];e.za=t.prototype}function M(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function P(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}M.prototype.u=function(e){this.i=e};function N(e,t){e.l={ma:t,na:!0},e.h=e.s||e.v}M.prototype.return=function(e){this.l={return:e},this.h=this.v};function E(e,t,n){return e.h=n,{value:t}}function I(e){this.h=new M,this.i=e}function F(e,t){P(e.h);var n=e.h.j;return n?U(e,"return"in n?n.return:function(o){return{value:o,done:!0}},t,e.h.return):(e.h.return(t),L(e))}function U(e,t,n,o){try{var l=t.call(e.h.j,n);if(!(l instanceof Object))throw new TypeError("Iterator result "+l+" is not an object");if(!l.done)return e.h.m=!1,l;var h=l.value}catch(c){return e.h.j=null,N(e.h,c),L(e)}return e.h.j=null,o.call(e.h,h),L(e)}function L(e){for(;e.h.h;)try{var t=e.i(e.h);if(t)return e.h.m=!1,{value:t.value,done:!1}}catch(n){e.h.i=void 0,N(e.h,n)}if(e.h.m=!1,e.h.l){if(t=e.h.l,e.h.l=null,t.na)throw t.ma;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function z(e){this.next=function(t){return P(e.h),e.h.j?t=U(e,e.h.j.next,t,e.h.u):(e.h.u(t),t=L(e)),t},this.throw=function(t){return P(e.h),e.h.j?t=U(e,e.h.j.throw,t,e.h.u):(N(e.h,t),t=L(e)),t},this.return=function(t){return F(e,t)},this[Symbol.iterator]=function(){return this}}function G(e){function t(o){return e.next(o)}function n(o){return e.throw(o)}return new Promise(function(o,l){function h(c){c.done?o(c.value):Promise.resolve(c.value).then(t,n).then(h,l)}h(e.next())})}function C(e){return G(new z(new I(e)))}f("Promise",function(e){function t(c){this.i=0,this.j=void 0,this.h=[],this.u=!1;var g=this.l();try{c(g.resolve,g.reject)}catch(b){g.reject(b)}}function n(){this.h=null}function o(c){return c instanceof t?c:new t(function(g){g(c)})}if(e)return e;n.prototype.i=function(c){if(this.h==null){this.h=[];var g=this;this.j(function(){g.m()})}this.h.push(c)};var l=a.setTimeout;n.prototype.j=function(c){l(c,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var c=this.h;this.h=[];for(var g=0;g<c.length;++g){var b=c[g];c[g]=null;try{b()}catch(_){this.l(_)}}}this.h=null},n.prototype.l=function(c){this.j(function(){throw c})},t.prototype.l=function(){function c(_){return function(k){b||(b=!0,_.call(g,k))}}var g=this,b=!1;return{resolve:c(this.I),reject:c(this.m)}},t.prototype.I=function(c){if(c===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof t)this.L(c);else{e:switch(typeof c){case"object":var g=c!=null;break e;case"function":g=!0;break e;default:g=!1}g?this.F(c):this.s(c)}},t.prototype.F=function(c){var g=void 0;try{g=c.then}catch(b){this.m(b);return}typeof g=="function"?this.M(g,c):this.s(c)},t.prototype.m=function(c){this.v(2,c)},t.prototype.s=function(c){this.v(1,c)},t.prototype.v=function(c,g){if(this.i!=0)throw Error("Cannot settle("+c+", "+g+"): Promise already settled in state"+this.i);this.i=c,this.j=g,this.i===2&&this.K(),this.H()},t.prototype.K=function(){var c=this;l(function(){if(c.D()){var g=a.console;typeof g<"u"&&g.error(c.j)}},1)},t.prototype.D=function(){if(this.u)return!1;var c=a.CustomEvent,g=a.Event,b=a.dispatchEvent;return typeof b>"u"?!0:(typeof c=="function"?c=new c("unhandledrejection",{cancelable:!0}):typeof g=="function"?c=new g("unhandledrejection",{cancelable:!0}):(c=a.document.createEvent("CustomEvent"),c.initCustomEvent("unhandledrejection",!1,!0,c)),c.promise=this,c.reason=this.j,b(c))},t.prototype.H=function(){if(this.h!=null){for(var c=0;c<this.h.length;++c)h.i(this.h[c]);this.h=null}};var h=new n;return t.prototype.L=function(c){var g=this.l();c.T(g.resolve,g.reject)},t.prototype.M=function(c,g){var b=this.l();try{c.call(g,b.resolve,b.reject)}catch(_){b.reject(_)}},t.prototype.then=function(c,g){function b(R,T){return typeof R=="function"?function(D){try{_(R(D))}catch(H){k(H)}}:T}var _,k,B=new t(function(R,T){_=R,k=T});return this.T(b(c,_),b(g,k)),B},t.prototype.catch=function(c){return this.then(void 0,c)},t.prototype.T=function(c,g){function b(){switch(_.i){case 1:c(_.j);break;case 2:g(_.j);break;default:throw Error("Unexpected state: "+_.i)}}var _=this;this.h==null?h.i(b):this.h.push(b),this.u=!0},t.resolve=o,t.reject=function(c){return new t(function(g,b){b(c)})},t.race=function(c){return new t(function(g,b){for(var _=m(c),k=_.next();!k.done;k=_.next())o(k.value).T(g,b)})},t.all=function(c){var g=m(c),b=g.next();return b.done?o([]):new t(function(_,k){function B(D){return function(H){R[D]=H,T--,T==0&&_(R)}}var R=[],T=0;do R.push(void 0),T++,o(b.value).T(B(R.length-1),k),b=g.next();while(!b.done)})},t});function q(e,t){e instanceof String&&(e+="");var n=0,o=!1,l={next:function(){if(!o&&n<e.length){var h=n++;return{value:t(h,e[h]),done:!1}}return o=!0,{done:!0,value:void 0}}};return l[Symbol.iterator]=function(){return l},l}f("Array.prototype.keys",function(e){return e||function(){return q(this,function(t){return t})}}),f("Array.prototype.fill",function(e){return e||function(t,n,o){var l=this.length||0;for(0>n&&(n=Math.max(0,l+n)),(o==null||o>l)&&(o=l),o=Number(o),0>o&&(o=Math.max(0,l+o)),n=Number(n||0);n<o;n++)this[n]=t;return this}});function K(e){return e||Array.prototype.fill}f("Int8Array.prototype.fill",K),f("Uint8Array.prototype.fill",K),f("Uint8ClampedArray.prototype.fill",K),f("Int16Array.prototype.fill",K),f("Uint16Array.prototype.fill",K),f("Int32Array.prototype.fill",K),f("Uint32Array.prototype.fill",K),f("Float32Array.prototype.fill",K),f("Float64Array.prototype.fill",K),f("Object.is",function(e){return e||function(t,n){return t===n?t!==0||1/t===1/n:t!==t&&n!==n}}),f("Array.prototype.includes",function(e){return e||function(t,n){var o=this;o instanceof String&&(o=String(o));var l=o.length;for(n=n||0,0>n&&(n=Math.max(n+l,0));n<l;n++){var h=o[n];if(h===t||Object.is(h,t))return!0}return!1}}),f("String.prototype.includes",function(e){return e||function(t,n){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(t,n||0)!==-1}});var ee=this||self;function te(e,t){e=e.split(".");var n=ee;e[0]in n||typeof n.execScript>"u"||n.execScript("var "+e[0]);for(var o;e.length&&(o=e.shift());)e.length||t===void 0?n[o]&&n[o]!==Object.prototype[o]?n=n[o]:n=n[o]={}:n[o]=t}function ne(e){var t;e:{if((t=ee.navigator)&&(t=t.userAgent))break e;t=""}return t.indexOf(e)!=-1}var ue=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,o=Array(n),l=typeof e=="string"?e.split(""):e,h=0;h<n;h++)h in l&&(o[h]=t.call(void 0,l[h],h,e));return o},ve={},fe=null;function Re(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):"=.".indexOf(e[t-1])!=-1&&(n="=.".indexOf(e[t-2])!=-1?n-2:n-1);var o=new Uint8Array(n),l=0;return Ce(e,function(h){o[l++]=h}),l!==n?o.subarray(0,l):o}function Ce(e,t){function n(b){for(;o<e.length;){var _=e.charAt(o++),k=fe[_];if(k!=null)return k;if(!/^[\s\xa0]*$/.test(_))throw Error("Unknown base64 encoding at char: "+_)}return b}Me();for(var o=0;;){var l=n(-1),h=n(0),c=n(64),g=n(64);if(g===64&&l===-1)break;t(l<<2|h>>4),c!=64&&(t(h<<4&240|c>>2),g!=64&&t(c<<6&192|g))}}function Me(){if(!fe){fe={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var o=e.concat(t[n].split(""));ve[n]=o;for(var l=0;l<o.length;l++){var h=o[l];fe[h]===void 0&&(fe[h]=l)}}}}var he=typeof Uint8Array<"u",de=!(ne("Trident")||ne("MSIE"))&&typeof ee.btoa=="function";function ge(e){if(!de){var t;t===void 0&&(t=0),Me(),t=ve[t];for(var n=Array(Math.floor(e.length/3)),o=t[64]||"",l=0,h=0;l<e.length-2;l+=3){var c=e[l],g=e[l+1],b=e[l+2],_=t[c>>2];c=t[(c&3)<<4|g>>4],g=t[(g&15)<<2|b>>6],b=t[b&63],n[h++]=_+c+g+b}switch(_=0,b=o,e.length-l){case 2:_=e[l+1],b=t[(_&15)<<2]||o;case 1:e=e[l],n[h]=t[e>>2]+t[(e&3)<<4|_>>4]+b+o}return n.join("")}for(t="";10240<e.length;)t+=String.fromCharCode.apply(null,e.subarray(0,10240)),e=e.subarray(10240);return t+=String.fromCharCode.apply(null,e),btoa(t)}var pe=RegExp("[-_.]","g");function ke(e){switch(e){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Ne(e){if(!de)return Re(e);pe.test(e)&&(e=e.replace(pe,ke)),e=atob(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}var Be;function Ve(){return Be||(Be=new Uint8Array(0))}var De={},fi=typeof Uint8Array.prototype.slice=="function",J=0,ae=0;function Pn(e){var t=0>e;e=Math.abs(e);var n=e>>>0;e=Math.floor((e-n)/4294967296),t&&(n=m(Tn(n,e)),t=n.next().value,e=n.next().value,n=t),J=n>>>0,ae=e>>>0}var hi=typeof BigInt=="function";function Tn(e,t){return t=~t,e?e=~e+1:t+=1,[e,t]}function Nn(e,t){this.i=e>>>0,this.h=t>>>0}function Fn(e){if(!e)return In||(In=new Nn(0,0));if(!/^-?\d+$/.test(e))return null;if(16>e.length)Pn(Number(e));else if(hi)e=BigInt(e),J=Number(e&BigInt(4294967295))>>>0,ae=Number(e>>BigInt(32)&BigInt(4294967295));else{var t=+(e[0]==="-");ae=J=0;for(var n=e.length,o=t,l=(n-t)%6+t;l<=n;o=l,l+=6)o=Number(e.slice(o,l)),ae*=1e6,J=1e6*J+o,4294967296<=J&&(ae+=J/4294967296|0,J%=4294967296);t&&(t=m(Tn(J,ae)),e=t.next().value,t=t.next().value,J=e,ae=t)}return new Nn(J,ae)}var In;function Rn(e,t){return Error("Invalid wire type: "+e+" (at position "+t+")")}function Vt(){return Error("Failed to read varint, encoding is invalid.")}function Cn(e,t){return Error("Tried to read past the end of the data "+t+" > "+e)}function Le(){throw Error("Invalid UTF8")}function Bn(e,t){return t=String.fromCharCode.apply(null,t),e==null?t:e+t}var ft=void 0,Gt,di=typeof TextDecoder<"u",Dn,pi=typeof TextEncoder<"u",Ln;function Un(e){if(e!==De)throw Error("illegal external caller")}function $e(e,t){if(Un(t),this.V=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}function Yt(){return Ln||(Ln=new $e(null,De))}function Hn(e){Un(De);var t=e.V;return t=t==null||he&&t!=null&&t instanceof Uint8Array?t:typeof t=="string"?Ne(t):null,t==null?t:e.V=t}function mi(e){if(typeof e=="string")return{buffer:Ne(e),C:!1};if(Array.isArray(e))return{buffer:new Uint8Array(e),C:!1};if(e.constructor===Uint8Array)return{buffer:e,C:!1};if(e.constructor===ArrayBuffer)return{buffer:new Uint8Array(e),C:!1};if(e.constructor===$e)return{buffer:Hn(e)||Ve(),C:!0};if(e instanceof Uint8Array)return{buffer:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function zn(e,t){this.i=null,this.m=!1,this.h=this.j=this.l=0,Kt(this,e,t)}function Kt(e,t,n){n=n===void 0?{}:n,e.S=n.S===void 0?!1:n.S,t&&(t=mi(t),e.i=t.buffer,e.m=t.C,e.l=0,e.j=e.i.length,e.h=e.l)}zn.prototype.reset=function(){this.h=this.l};function Ue(e,t){if(e.h=t,t>e.j)throw Cn(e.j,t)}function Qe(e){var t=e.i,n=e.h,o=t[n++],l=o&127;if(o&128&&(o=t[n++],l|=(o&127)<<7,o&128&&(o=t[n++],l|=(o&127)<<14,o&128&&(o=t[n++],l|=(o&127)<<21,o&128&&(o=t[n++],l|=o<<28,o&128&&t[n++]&128&&t[n++]&128&&t[n++]&128&&t[n++]&128&&t[n++]&128)))))throw Vt();return Ue(e,n),l}function Wn(e,t){if(0>t)throw Error("Tried to read a negative byte length: "+t);var n=e.h,o=n+t;if(o>e.j)throw Cn(t,e.j-n);return e.h=o,n}var Vn=[];function Xt(){this.h=[]}Xt.prototype.length=function(){return this.h.length},Xt.prototype.end=function(){var e=this.h;return this.h=[],e};function Gn(e,t,n){for(;0<n||127<t;)e.h.push(t&127|128),t=(t>>>7|n<<25)>>>0,n>>>=7;e.h.push(t)}function He(e,t){for(;127<t;)e.h.push(t&127|128),t>>>=7;e.h.push(t)}function $t(e,t){if(Vn.length){var n=Vn.pop();Kt(n,e,t),e=n}else e=new zn(e,t);this.h=e,this.j=this.h.h,this.i=this.l=-1,this.setOptions(t)}$t.prototype.setOptions=function(e){e=e===void 0?{}:e,this.ca=e.ca===void 0?!1:e.ca},$t.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Yn(e){var t=e.h;if(t.h==t.j)return!1;e.j=e.h.h;var n=Qe(e.h)>>>0;if(t=n>>>3,n&=7,!(0<=n&&5>=n))throw Rn(n,e.j);if(1>t)throw Error("Invalid field number: "+t+" (at position "+e.j+")");return e.l=t,e.i=n,!0}function ht(e){switch(e.i){case 0:if(e.i!=0)ht(e);else e:{e=e.h;for(var t=e.h,n=t+10,o=e.i;t<n;)if(!(o[t++]&128)){Ue(e,t);break e}throw Vt()}break;case 1:e=e.h,Ue(e,e.h+8);break;case 2:e.i!=2?ht(e):(t=Qe(e.h)>>>0,e=e.h,Ue(e,e.h+t));break;case 5:e=e.h,Ue(e,e.h+4);break;case 3:t=e.l;do{if(!Yn(e))throw Error("Unmatched start-group tag: stream EOF");if(e.i==4){if(e.l!=t)throw Error("Unmatched end-group tag");break}ht(e)}while(!0);break;default:throw Rn(e.i,e.j)}}var dt=[];function vi(){this.j=[],this.i=0,this.h=new Xt}function Ge(e,t){t.length!==0&&(e.j.push(t),e.i+=t.length)}function gi(e,t){if(t=t.R){Ge(e,e.h.end());for(var n=0;n<t.length;n++)Ge(e,Hn(t[n])||Ve())}}var Oe=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function ze(e,t){return Oe?e[Oe]|=t:e.A!==void 0?e.A|=t:(Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}}),t)}function Kn(e,t){Oe?e[Oe]&&(e[Oe]&=~t):e.A!==void 0&&(e.A&=~t)}function Q(e){var t;return Oe?t=e[Oe]:t=e.A,t??0}function xe(e,t){Oe?e[Oe]=t:e.A!==void 0?e.A=t:Object.defineProperties(e,{A:{value:t,configurable:!0,writable:!0,enumerable:!1}})}function Qt(e){return ze(e,1),e}function yi(e,t){xe(t,(e|0)&-51)}function pt(e,t){xe(t,(e|18)&-41)}var qt={};function mt(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&e.constructor===Object}var qe,Xn=[];xe(Xn,23),qe=Object.freeze(Xn);function Zt(e){if(Q(e.o)&2)throw Error("Cannot mutate an immutable Message")}function Jt(e){var t=e.length;(t=t?e[t-1]:void 0)&&mt(t)?t.g=1:(t={},e.push((t.g=1,t)))}function $n(e){var t=e.i+e.G;return e.B||(e.B=e.o[t]={})}function ye(e,t){return t===-1?null:t>=e.i?e.B?e.B[t]:void 0:e.o[t+e.G]}function Se(e,t,n,o){Zt(e),Ze(e,t,n,o)}function Ze(e,t,n,o){e.j&&(e.j=void 0),t>=e.i||o?$n(e)[t]=n:(e.o[t+e.G]=n,(e=e.B)&&t in e&&delete e[t])}function en(e,t,n,o){var l=ye(e,t);Array.isArray(l)||(l=qe);var h=Q(l);if(h&1||Qt(l),o)h&2||ze(l,2),n&1||Object.freeze(l);else{o=!(n&2);var c=h&2;n&1||!c?o&&h&16&&!c&&Kn(l,16):(l=Qt(Array.prototype.slice.call(l)),Ze(e,t,l))}return l}function tn(e,t){var n=ye(e,t),o=n==null?n:typeof n=="number"||n==="NaN"||n==="Infinity"||n==="-Infinity"?Number(n):void 0;return o!=null&&o!==n&&Ze(e,t,o),o}function Qn(e,t,n,o,l){e.h||(e.h={});var h=e.h[n],c=en(e,n,3,l);if(!h){var g=c;h=[];var b=!!(Q(e.o)&16);c=!!(Q(g)&2);var _=g;!l&&c&&(g=Array.prototype.slice.call(g));for(var k=c,B=0;B<g.length;B++){var R=g[B],T=t,D=!1;if(D=D===void 0?!1:D,R=Array.isArray(R)?new T(R):D?new T:void 0,R!==void 0){T=R.o;var H=D=Q(T);c&&(H|=2),b&&(H|=16),H!=D&&xe(T,H),T=H,k=k||!!(2&T),h.push(R)}}return e.h[n]=h,b=Q(g),t=b|33,t=k?t&-9:t|8,b!=t&&(k=g,Object.isFrozen(k)&&(k=Array.prototype.slice.call(k)),xe(k,t),g=k),_!==g&&Ze(e,n,g),(l||o&&c)&&ze(h,2),o&&Object.freeze(h),h}return l||(l=Object.isFrozen(h),o&&!l?Object.freeze(h):!o&&l&&(h=Array.prototype.slice.call(h),e.h[n]=h)),h}function nn(e,t,n){var o=!!(Q(e.o)&2);if(t=Qn(e,t,n,o,o),e=en(e,n,3,o),!(o||Q(e)&8)){for(o=0;o<t.length;o++){if(n=t[o],Q(n.o)&2){var l=nr(n,!1);l.j=n}else l=n;n!==l&&(t[o]=l,e[o]=l.o)}ze(e,8)}return t}function Ae(e,t,n){if(n!=null&&typeof n!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);Se(e,t,n)}function qn(e,t,n,o,l){Zt(e);var h=Qn(e,n,t,!1,!1);return n=o??new n,e=en(e,t,2,!1),l!=null?(h.splice(l,0,n),e.splice(l,0,n.o)):(h.push(n),e.push(n.o)),n.C()&&Kn(e,8),n}function vt(e,t){return e??t}function _e(e,t,n){return n=n===void 0?0:n,vt(tn(e,t),n)}var gt;function wi(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":if(e)if(Array.isArray(e)){if(Q(e)&128)return e=Array.prototype.slice.call(e),Jt(e),e}else{if(he&&e!=null&&e instanceof Uint8Array)return ge(e);if(e instanceof $e){var t=e.V;return t==null?"":typeof t=="string"?t:e.V=ge(t)}}}return e}function Zn(e,t,n,o){if(e!=null){if(Array.isArray(e))e=rn(e,t,n,o!==void 0);else if(mt(e)){var l={},h;for(h in e)l[h]=Zn(e[h],t,n,o);e=l}else e=t(e,o);return e}}function rn(e,t,n,o){var l=Q(e);o=o?!!(l&16):void 0,e=Array.prototype.slice.call(e);for(var h=0;h<e.length;h++)e[h]=Zn(e[h],t,n,o);return n(l,e),e}function bi(e){return e.ja===qt?e.toJSON():wi(e)}function xi(e,t){e&128&&Jt(t)}function Jn(e,t,n){if(n=n===void 0?pt:n,e!=null){if(he&&e instanceof Uint8Array)return e.length?new $e(new Uint8Array(e),De):Yt();if(Array.isArray(e)){var o=Q(e);return o&2?e:t&&!(o&32)&&(o&16||o===0)?(xe(e,o|2),e):(e=rn(e,Jn,o&4?pt:n,!0),t=Q(e),t&4&&t&2&&Object.freeze(e),e)}return e.ja===qt?tr(e):e}}function er(e,t,n,o,l,h,c){if(e=e.h&&e.h[n]){if(o=Q(e),o&2?o=e:(h=ue(e,tr),pt(o,h),Object.freeze(h),o=h),Zt(t),c=o==null?qe:Qt([]),o!=null){for(h=!!o.length,e=0;e<o.length;e++){var g=o[e];h=h&&!(Q(g.o)&2),c[e]=g.o}h=(h?8:0)|1,e=Q(c),(e&h)!==h&&(Object.isFrozen(c)&&(c=Array.prototype.slice.call(c)),xe(c,e|h)),t.h||(t.h={}),t.h[n]=o}else t.h&&(t.h[n]=void 0);Ze(t,n,c,l)}else Se(t,n,Jn(o,h,c),l)}function tr(e){return Q(e.o)&2||(e=nr(e,!0),ze(e.o,2)),e}function nr(e,t){var n=e.o,o=[];ze(o,16);var l=e.constructor.h;if(l&&o.push(l),l=e.B,l){o.length=n.length,o.fill(void 0,o.length,n.length);var h={};o[o.length-1]=h}Q(n)&128&&Jt(o),t=t||e.C()?pt:yi,h=e.constructor,gt=o,o=new h(o),gt=void 0,e.R&&(o.R=e.R.slice()),h=!!(Q(n)&16);for(var c=l?n.length-1:n.length,g=0;g<c;g++)er(e,o,g-e.G,n[g],!1,h,t);if(l)for(var b in l)er(e,o,+b,l[b],!0,h,t);return o}function le(e,t,n){e==null&&(e=gt),gt=void 0;var o=this.constructor.i||0,l=0<o,h=this.constructor.h,c=!1;if(e==null){e=h?[h]:[];var g=48,b=!0;l&&(o=0,g|=128),xe(e,g)}else{if(!Array.isArray(e)||h&&h!==e[0])throw Error();var _=g=ze(e,0);if((b=(16&_)!==0)&&((c=(32&_)!==0)||(_|=32)),l){if(128&_)o=0;else if(0<e.length){var k=e[e.length-1];if(mt(k)&&"g"in k){o=0,_|=128,delete k.g;var B=!0,R;for(R in k){B=!1;break}B&&e.pop()}}}else if(128&_)throw Error();g!==_&&xe(e,_)}this.G=(h?0:-1)-o,this.h=void 0,this.o=e;e:{if(h=this.o.length,o=h-1,h&&(h=this.o[o],mt(h))){this.B=h,this.i=o-this.G;break e}t!==void 0&&-1<t?(this.i=Math.max(t,o+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!l&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n){t=b&&!c&&!0,l=this.i;var T;for(b=0;b<n.length;b++)c=n[b],c<l?(c+=this.G,(o=e[c])?rr(o,t):e[c]=qe):(T||(T=$n(this)),(o=T[c])?rr(o,t):T[c]=qe)}}le.prototype.toJSON=function(){return rn(this.o,bi,xi)},le.prototype.C=function(){return!!(Q(this.o)&2)};function rr(e,t){if(Array.isArray(e)){var n=Q(e),o=1;!t||n&2||(o|=16),(n&o)!==o&&xe(e,n|o)}}le.prototype.ja=qt,le.prototype.toString=function(){return this.o.toString()};function ir(e,t,n){if(n){var o={},l;for(l in n){var h=n[l],c=h.ra;c||(o.J=h.xa||h.oa.W,h.ia?(o.aa=lr(h.ia),c=function(g){return function(b,_,k){return g.J(b,_,k,g.aa)}}(o)):h.ka?(o.Z=cr(h.da.P,h.ka),c=function(g){return function(b,_,k){return g.J(b,_,k,g.Z)}}(o)):c=o.J,h.ra=c),c(t,e,h.da),o={J:o.J,aa:o.aa,Z:o.Z}}}gi(t,e)}var yt=Symbol();function or(e,t,n){return e[yt]||(e[yt]=function(o,l){return t(o,l,n)})}function sr(e){var t=e[yt];if(!t){var n=sn(e);t=function(o,l){return fr(o,l,n)},e[yt]=t}return t}function Si(e){var t=e.ia;if(t)return sr(t);if(t=e.wa)return or(e.da.P,t,e.ka)}function Ai(e){var t=Si(e),n=e.da,o=e.oa.U;return t?function(l,h){return o(l,h,n,t)}:function(l,h){return o(l,h,n)}}function ar(e,t){var n=e[t];return typeof n=="function"&&n.length===0&&(n=n(),e[t]=n),Array.isArray(n)&&(et in n||Je in n||0<n.length&&typeof n[0]=="function")?n:void 0}function ur(e,t,n,o,l,h){t.P=e[0];var c=1;if(e.length>c&&typeof e[c]!="number"){var g=e[c++];n(t,g)}for(;c<e.length;){n=e[c++];for(var b=c+1;b<e.length&&typeof e[b]!="number";)b++;switch(g=e[c++],b-=c,b){case 0:o(t,n,g);break;case 1:(b=ar(e,c))?(c++,l(t,n,g,b)):o(t,n,g,e[c++]);break;case 2:b=c++,b=ar(e,b),l(t,n,g,b,e[c++]);break;case 3:h(t,n,g,e[c++],e[c++],e[c++]);break;case 4:h(t,n,g,e[c++],e[c++],e[c++],e[c++]);break;default:throw Error("unexpected number of binary field arguments: "+b)}}return t}var wt=Symbol();function lr(e){var t=e[wt];if(!t){var n=on(e);t=function(o,l){return hr(o,l,n)},e[wt]=t}return t}function cr(e,t){var n=e[wt];return n||(n=function(o,l){return ir(o,l,t)},e[wt]=n),n}var Je=Symbol();function _i(e,t){e.push(t)}function Ei(e,t,n){e.push(t,n.W)}function ji(e,t,n,o){var l=lr(o),h=on(o).P,c=n.W;e.push(t,function(g,b,_){return c(g,b,_,h,l)})}function Mi(e,t,n,o,l,h){var c=cr(o,h),g=n.W;e.push(t,function(b,_,k){return g(b,_,k,o,c)})}function on(e){var t=e[Je];return t||(t=ur(e,e[Je]=[],_i,Ei,ji,Mi),et in e&&Je in e&&(e.length=0),t)}var et=Symbol();function ki(e,t){e[0]=t}function Oi(e,t,n,o){var l=n.U;e[t]=o?function(h,c,g){return l(h,c,g,o)}:l}function Pi(e,t,n,o,l){var h=n.U,c=sr(o),g=sn(o).P;e[t]=function(b,_,k){return h(b,_,k,g,c,l)}}function Ti(e,t,n,o,l,h,c){var g=n.U,b=or(o,l,h);e[t]=function(_,k,B){return g(_,k,B,o,b,c)}}function sn(e){var t=e[et];return t||(t=ur(e,e[et]={},ki,Oi,Pi,Ti),et in e&&Je in e&&(e.length=0),t)}function fr(e,t,n){for(;Yn(t)&&t.i!=4;){var o=t.l,l=n[o];if(!l){var h=n[0];h&&(h=h[o])&&(l=n[o]=Ai(h))}if(!l||!l(t,e,o)){l=t,o=e,h=l.j,ht(l);var c=l;if(!c.ca){if(l=c.h.h-h,c.h.h=h,c=c.h,l==0)l=Yt();else{if(h=Wn(c,l),c.S&&c.m)l=c.i.subarray(h,h+l);else{c=c.i;var g=h;l=h+l,l=g===l?Ve():fi?c.slice(g,l):new Uint8Array(c.subarray(g,l))}l=l.length==0?Yt():new $e(l,De)}(h=o.R)?h.push(l):o.R=[l]}}}return e}function hr(e,t,n){for(var o=n.length,l=o%2==1,h=l?1:0;h<o;h+=2)(0,n[h+1])(t,e,n[h]);ir(e,t,l?n[0]:void 0)}function tt(e,t){return{U:e,W:t}}var we=tt(function(e,t,n){if(e.i!==5)return!1;e=e.h;var o=e.i,l=e.h,h=o[l],c=o[l+1],g=o[l+2];return o=o[l+3],Ue(e,e.h+4),c=(h<<0|c<<8|g<<16|o<<24)>>>0,e=2*(c>>31)+1,h=c>>>23&255,c&=8388607,Se(t,n,h==255?c?NaN:1/0*e:h==0?e*Math.pow(2,-149)*c:e*Math.pow(2,h-150)*(c+Math.pow(2,23))),!0},function(e,t,n){if(t=tn(t,n),t!=null){He(e.h,8*n+5),e=e.h;var o=+t;o===0?0<1/o?J=ae=0:(ae=0,J=2147483648):isNaN(o)?(ae=0,J=2147483647):(o=(n=0>o?-2147483648:0)?-o:o,34028234663852886e22<o?(ae=0,J=(n|2139095040)>>>0):11754943508222875e-54>o?(o=Math.round(o/Math.pow(2,-149)),ae=0,J=(n|o)>>>0):(t=Math.floor(Math.log(o)/Math.LN2),o*=Math.pow(2,-t),o=Math.round(8388608*o),16777216<=o&&++t,ae=0,J=(n|t+127<<23|o&8388607)>>>0)),n=J,e.h.push(n>>>0&255),e.h.push(n>>>8&255),e.h.push(n>>>16&255),e.h.push(n>>>24&255)}}),Ni=tt(function(e,t,n){if(e.i!==0)return!1;var o=e.h,l=0,h=e=0,c=o.i,g=o.h;do{var b=c[g++];l|=(b&127)<<h,h+=7}while(32>h&&b&128);for(32<h&&(e|=(b&127)>>4),h=3;32>h&&b&128;h+=7)b=c[g++],e|=(b&127)<<h;if(Ue(o,g),128>b)o=l>>>0,b=e>>>0,(e=b&2147483648)&&(o=~o+1>>>0,b=~b>>>0,o==0&&(b=b+1>>>0)),o=4294967296*b+(o>>>0);else throw Vt();return Se(t,n,e?-o:o),!0},function(e,t,n){t=ye(t,n),t!=null&&(typeof t=="string"&&Fn(t),t!=null&&(He(e.h,8*n),typeof t=="number"?(e=e.h,Pn(t),Gn(e,J,ae)):(n=Fn(t),Gn(e.h,n.i,n.h))))}),Fi=tt(function(e,t,n){return e.i!==0?!1:(Se(t,n,Qe(e.h)),!0)},function(e,t,n){if(t=ye(t,n),t!=null&&t!=null)if(He(e.h,8*n),e=e.h,n=t,0<=n)He(e,n);else{for(t=0;9>t;t++)e.h.push(n&127|128),n>>=7;e.h.push(1)}}),dr=tt(function(e,t,n){if(e.i!==2)return!1;var o=Qe(e.h)>>>0;e=e.h;var l=Wn(e,o);if(e=e.i,di){var h=e,c;(c=Gt)||(c=Gt=new TextDecoder("utf-8",{fatal:!0})),e=l+o,h=l===0&&e===h.length?h:h.subarray(l,e);try{var g=c.decode(h)}catch(B){if(ft===void 0){try{c.decode(new Uint8Array([128]))}catch{}try{c.decode(new Uint8Array([97])),ft=!0}catch{ft=!1}}throw!ft&&(Gt=void 0),B}}else{g=l,o=g+o,l=[];for(var b=null,_,k;g<o;)_=e[g++],128>_?l.push(_):224>_?g>=o?Le():(k=e[g++],194>_||(k&192)!==128?(g--,Le()):l.push((_&31)<<6|k&63)):240>_?g>=o-1?Le():(k=e[g++],(k&192)!==128||_===224&&160>k||_===237&&160<=k||((h=e[g++])&192)!==128?(g--,Le()):l.push((_&15)<<12|(k&63)<<6|h&63)):244>=_?g>=o-2?Le():(k=e[g++],(k&192)!==128||(_<<28)+(k-144)>>30||((h=e[g++])&192)!==128||((c=e[g++])&192)!==128?(g--,Le()):(_=(_&7)<<18|(k&63)<<12|(h&63)<<6|c&63,_-=65536,l.push((_>>10&1023)+55296,(_&1023)+56320))):Le(),8192<=l.length&&(b=Bn(b,l),l.length=0);g=Bn(b,l)}return Se(t,n,g),!0},function(e,t,n){if(t=ye(t,n),t!=null){var o=!1;if(o=o===void 0?!1:o,pi){if(o&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(t))throw Error("Found an unpaired surrogate");t=(Dn||(Dn=new TextEncoder)).encode(t)}else{for(var l=0,h=new Uint8Array(3*t.length),c=0;c<t.length;c++){var g=t.charCodeAt(c);if(128>g)h[l++]=g;else{if(2048>g)h[l++]=g>>6|192;else{if(55296<=g&&57343>=g){if(56319>=g&&c<t.length){var b=t.charCodeAt(++c);if(56320<=b&&57343>=b){g=1024*(g-55296)+b-56320+65536,h[l++]=g>>18|240,h[l++]=g>>12&63|128,h[l++]=g>>6&63|128,h[l++]=g&63|128;continue}else c--}if(o)throw Error("Found an unpaired surrogate");g=65533}h[l++]=g>>12|224,h[l++]=g>>6&63|128}h[l++]=g&63|128}}t=l===h.length?h:h.subarray(0,l)}He(e.h,8*n+2),He(e.h,t.length),Ge(e,e.h.end()),Ge(e,t)}}),pr=tt(function(e,t,n,o,l){if(e.i!==2)return!1;t=qn(t,n,o),n=e.h.j,o=Qe(e.h)>>>0;var h=e.h.h+o,c=h-n;if(0>=c&&(e.h.j=h,l(t,e,void 0,void 0,void 0),c=h-e.h.h),c)throw Error("Message parsing ended unexpectedly. Expected to read "+(o+" bytes, instead read "+(o-c)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return e.h.h=h,e.h.j=n,!0},function(e,t,n,o,l){if(t=nn(t,o,n),t!=null)for(o=0;o<t.length;o++){var h=e;He(h.h,8*n+2);var c=h.h.end();Ge(h,c),c.push(h.i),h=c,l(t[o],e),c=e;var g=h.pop();for(g=c.i+c.h.length()-g;127<g;)h.push(g&127|128),g>>>=7,c.i++;h.push(g),c.i++}});function an(e){return function(t,n){e:{if(dt.length){var o=dt.pop();o.setOptions(n),Kt(o.h,t,n),t=o}else t=new $t(t,n);try{var l=sn(e),h=fr(new l.P,t,l);break e}finally{l=t.h,l.i=null,l.m=!1,l.l=0,l.j=0,l.h=0,l.S=!1,t.l=-1,t.i=-1,100>dt.length&&dt.push(t)}h=void 0}return h}}function un(e){return function(){var t=new vi;hr(this,t,on(e)),Ge(t,t.h.end());for(var n=new Uint8Array(t.i),o=t.j,l=o.length,h=0,c=0;c<l;c++){var g=o[c];n.set(g,h),h+=g.length}return t.j=[n],n}}function Ye(e){le.call(this,e)}O(Ye,le);var mr=[Ye,1,Fi,2,we,3,dr,4,dr];Ye.prototype.l=un(mr);function ln(e){le.call(this,e,-1,Ii)}O(ln,le),ln.prototype.addClassification=function(e,t){return qn(this,1,Ye,e,t),this};var Ii=[1],Ri=an([ln,1,pr,mr]);function nt(e){le.call(this,e)}O(nt,le);var vr=[nt,1,we,2,we,3,we,4,we,5,we];nt.prototype.l=un(vr);function gr(e){le.call(this,e,-1,Ci)}O(gr,le);var Ci=[1],Bi=an([gr,1,pr,vr]);function bt(e){le.call(this,e)}O(bt,le);var yr=[bt,1,we,2,we,3,we,4,we,5,we,6,Ni],Di=an(yr);bt.prototype.l=un(yr);function wr(e,t,n){if(n=e.createShader(n===0?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+e.getShaderInfoLog(n));return n}function Li(e){return nn(e,Ye,1).map(function(t){var n=ye(t,1);return{index:n??0,qa:_e(t,2),label:ye(t,3)!=null?vt(ye(t,3),""):void 0,displayName:ye(t,4)!=null?vt(ye(t,4),""):void 0}})}function Ui(e){return{x:_e(e,1),y:_e(e,2),z:_e(e,3),visibility:tn(e,4)!=null?_e(e,4):void 0}}function cn(e,t){this.i=e,this.h=t,this.m=0}function br(e,t,n){return Hi(e,t),typeof e.h.canvas.transferToImageBitmap=="function"?Promise.resolve(e.h.canvas.transferToImageBitmap()):n?Promise.resolve(e.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(e.h.canvas):(e.j===void 0&&(e.j=document.createElement("canvas")),new Promise(function(o){e.j.height=e.h.canvas.height,e.j.width=e.h.canvas.width,e.j.getContext("2d",{}).drawImage(e.h.canvas,0,0,e.h.canvas.width,e.h.canvas.height),o(e.j)}))}function Hi(e,t){var n=e.h;if(e.s===void 0){var o=wr(n,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),l=wr(n,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),h=n.createProgram();if(n.attachShader(h,o),n.attachShader(h,l),n.linkProgram(h),!n.getProgramParameter(h,n.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+n.getProgramInfoLog(h));o=e.s=h,n.useProgram(o),l=n.getUniformLocation(o,"sampler0"),e.l={O:n.getAttribLocation(o,"aVertex"),N:n.getAttribLocation(o,"aTex"),ya:l},e.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.enableVertexAttribArray(e.l.O),n.vertexAttribPointer(e.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.enableVertexAttribArray(e.l.N),n.vertexAttribPointer(e.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(l,0)}o=e.l,n.useProgram(e.s),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.i.bindTexture2d(t.glName),n.enableVertexAttribArray(o.O),n.bindBuffer(n.ARRAY_BUFFER,e.v),n.vertexAttribPointer(o.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(o.N),n.bindBuffer(n.ARRAY_BUFFER,e.u),n.vertexAttribPointer(o.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(o.O),n.disableVertexAttribArray(o.N),n.bindBuffer(n.ARRAY_BUFFER,null),e.i.bindTexture2d(0)}function zi(e){this.h=e}var Wi=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Vi(e,t){return t+e}function xr(e,t){window[e]=t}function Gi(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise(function(n){t.addEventListener("load",function(){n()},!1),t.addEventListener("error",function(){n()},!1),document.body.appendChild(t)})}function Yi(){return C(function(e){switch(e.h){case 1:return e.s=2,E(e,WebAssembly.instantiate(Wi),4);case 4:e.h=3,e.s=0;break;case 2:return e.s=0,e.l=null,e.return(!1);case 3:return e.return(!0)}})}function fn(e){if(this.h=e,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=e&&e.locateFile||Vi,typeof window=="object")var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=t,e.options){t=m(Object.keys(e.options));for(var n=t.next();!n.done;n=t.next()){n=n.value;var o=e.options[n].default;o!==void 0&&(this.l[n]=typeof o=="function"?o():o)}}}s=fn.prototype,s.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function Ki(e){var t,n,o,l,h,c,g,b,_,k,B;return C(function(R){switch(R.h){case 1:return e.ga?(t=e.h.files===void 0?[]:typeof e.h.files=="function"?e.h.files(e.l):e.h.files,E(R,Yi(),2)):R.return();case 2:if(n=R.i,typeof window=="object")return xr("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),xr("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),c=t.filter(function(T){return T.data!==void 0}),g=t.filter(function(T){return T.data===void 0}),b=Promise.all(c.map(function(T){var D=xt(e,T.url);if(T.path!==void 0){var H=T.path;D=D.then(function($){return e.overrideFile(H,$),Promise.resolve($)})}return D})),_=Promise.all(g.map(function(T){return T.simd===void 0||T.simd&&n||!T.simd&&!n?Gi(e.locateFile(T.url,e.ha)):Promise.resolve()})).then(function(){var T,D,H;return C(function($){if($.h==1)return T=window.createMediapipeSolutionsWasm,D=window.createMediapipeSolutionsPackedAssets,H=e,E($,T(D),2);H.i=$.i,$.h=0})}),k=function(){return C(function(T){return e.h.graph&&e.h.graph.url?T=E(T,xt(e,e.h.graph.url),0):(T.h=0,T=void 0),T})}(),E(R,Promise.all([_,b,k]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return o=t.filter(function(T){return T.simd===void 0||T.simd&&n||!T.simd&&!n}).map(function(T){return e.locateFile(T.url,e.ha)}),importScripts.apply(null,y(o)),l=e,E(R,createMediapipeSolutionsWasm(Module),6);case 6:l.i=R.i,e.m=new OffscreenCanvas(1,1),e.i.canvas=e.m,h=e.i.GL.createContext(e.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),e.i.GL.makeContextCurrent(h),R.h=4;break;case 7:if(e.m=document.createElement("canvas"),B=e.m.getContext("webgl2",{}),!B&&(B=e.m.getContext("webgl",{}),!B))return alert("Failed to create WebGL canvas context when passing video frame."),R.return();e.K=B,e.i.canvas=e.m,e.i.createContext(e.m,!0,!0,{});case 4:e.j=new e.i.SolutionWasm,e.ga=!1,R.h=0}})}function Xi(e){var t,n,o,l,h,c,g,b;return C(function(_){if(_.h==1){if(e.h.graph&&e.h.graph.url&&e.fa===e.h.graph.url)return _.return();if(e.u=!0,!e.h.graph||!e.h.graph.url){_.h=2;return}return e.fa=e.h.graph.url,E(_,xt(e,e.h.graph.url),3)}for(_.h!=2&&(t=_.i,e.j.loadGraph(t)),n=m(Object.keys(e.D)),o=n.next();!o.done;o=n.next())l=o.value,e.j.overrideFile(l,e.D[l]);if(e.D={},e.h.listeners)for(h=m(e.h.listeners),c=h.next();!c.done;c=h.next())g=c.value,Zi(e,g);b=e.l,e.l={},e.setOptions(b),_.h=0})}s.reset=function(){var e=this;return C(function(t){e.j&&(e.j.reset(),e.s={},e.v={}),t.h=0})},s.setOptions=function(e,t){var n=this;if(t=t||this.h.options){for(var o=[],l=[],h={},c=m(Object.keys(e)),g=c.next();!g.done;h={X:h.X,Y:h.Y},g=c.next())if(g=g.value,!(g in this.l&&this.l[g]===e[g])){this.l[g]=e[g];var b=t[g];b!==void 0&&(b.onChange&&(h.X=b.onChange,h.Y=e[g],o.push(function(_){return function(){var k;return C(function(B){if(B.h==1)return E(B,_.X(_.Y),2);k=B.i,k===!0&&(n.u=!0),B.h=0})}}(h))),b.graphOptionXref&&(g=Object.assign({},{calculatorName:"",calculatorIndex:0},b.graphOptionXref,{valueNumber:b.type===1?e[g]:0,valueBoolean:b.type===0?e[g]:!1,valueString:b.type===2?e[g]:""}),l.push(g)))}(o.length!==0||l.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(l),this.F=(this.F===void 0?[]:this.F).concat(o))}};function $i(e){var t,n,o,l,h,c,g;return C(function(b){switch(b.h){case 1:if(!e.u)return b.return();if(!e.F){b.h=2;break}t=m(e.F),n=t.next();case 3:if(n.done){b.h=5;break}return o=n.value,E(b,o(),4);case 4:n=t.next(),b.h=3;break;case 5:e.F=void 0;case 2:if(e.H){for(l=new e.i.GraphOptionChangeRequestList,h=m(e.H),c=h.next();!c.done;c=h.next())g=c.value,l.push_back(g);e.j.changeOptions(l),l.delete(),e.H=void 0}e.u=!1,b.h=0}})}s.initialize=function(){var e=this;return C(function(t){return t.h==1?E(t,Ki(e),2):t.h!=3?E(t,Xi(e),3):E(t,$i(e),0)})};function xt(e,t){var n,o;return C(function(l){return t in e.L?l.return(e.L[t]):(n=e.locateFile(t,""),o=fetch(n).then(function(h){return h.arrayBuffer()}),e.L[t]=o,l.return(o))})}s.overrideFile=function(e,t){this.j?this.j.overrideFile(e,t):this.D[e]=t},s.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},s.send=function(e,t){var n=this,o,l,h,c,g,b,_,k,B;return C(function(R){switch(R.h){case 1:return n.h.inputs?(o=1e3*(t??performance.now()),E(R,n.I,2)):R.return();case 2:return E(R,n.initialize(),3);case 3:for(l=new n.i.PacketDataList,h=m(Object.keys(e)),c=h.next();!c.done;c=h.next())if(g=c.value,b=n.h.inputs[g]){e:{var T=e[g];switch(b.type){case"video":var D=n.s[b.stream];if(D||(D=new cn(n.i,n.K),n.s[b.stream]=D),D.m===0&&(D.m=D.i.createTexture()),typeof HTMLVideoElement<"u"&&T instanceof HTMLVideoElement)var H=T.videoWidth,$=T.videoHeight;else typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement?(H=T.naturalWidth,$=T.naturalHeight):(H=T.width,$=T.height);$={glName:D.m,width:H,height:$},H=D.h,H.canvas.width=$.width,H.canvas.height=$.height,H.activeTexture(H.TEXTURE0),D.i.bindTexture2d(D.m),H.texImage2D(H.TEXTURE_2D,0,H.RGBA,H.RGBA,H.UNSIGNED_BYTE,T),D.i.bindTexture2d(0),D=$;break e;case"detections":for(D=n.s[b.stream],D||(D=new zi(n.i),n.s[b.stream]=D),D.data||(D.data=new D.h.DetectionListData),D.data.reset(T.length),$=0;$<T.length;++$){H=T[$];var X=D.data,re=X.setBoundingBox,me=$,ce=H.la,Y=new bt;if(Ae(Y,1,ce.sa),Ae(Y,2,ce.ta),Ae(Y,3,ce.height),Ae(Y,4,ce.width),Ae(Y,5,ce.rotation),Se(Y,6,ce.pa),ce=Y.l(),re.call(X,me,ce),H.ea)for(X=0;X<H.ea.length;++X){Y=H.ea[X],re=D.data,me=re.addNormalizedLandmark,ce=$,Y=Object.assign({},Y,{visibility:Y.visibility?Y.visibility:0});var ie=new nt;Ae(ie,1,Y.x),Ae(ie,2,Y.y),Ae(ie,3,Y.z),Y.visibility&&Ae(ie,4,Y.visibility),Y=ie.l(),me.call(re,ce,Y)}if(H.ba)for(X=0;X<H.ba.length;++X)re=D.data,me=re.addClassification,ce=$,Y=H.ba[X],ie=new Ye,Ae(ie,2,Y.qa),Y.index&&Se(ie,1,Y.index),Y.label&&Se(ie,3,Y.label),Y.displayName&&Se(ie,4,Y.displayName),Y=ie.l(),me.call(re,ce,Y)}D=D.data;break e;default:D={}}}switch(_=D,k=b.stream,b.type){case"video":l.pushTexture2d(Object.assign({},_,{stream:k,timestamp:o}));break;case"detections":B=_,B.stream=k,B.timestamp=o,l.pushDetectionList(B);break;default:throw Error("Unknown input config type: '"+b.type+"'")}}return n.j.send(l),E(R,n.I,4);case 4:l.delete(),R.h=0}})};function Qi(e,t,n){var o,l,h,c,g,b,_,k,B,R,T,D,H,$;return C(function(X){switch(X.h){case 1:if(!n)return X.return(t);for(o={},l=0,h=m(Object.keys(n)),c=h.next();!c.done;c=h.next())g=c.value,b=n[g],typeof b!="string"&&b.type==="texture"&&t[b.stream]!==void 0&&++l;1<l&&(e.M=!1),_=m(Object.keys(n)),c=_.next();case 2:if(c.done){X.h=4;break}if(k=c.value,B=n[k],typeof B=="string")return H=o,$=k,E(X,qi(e,k,t[B]),14);if(R=t[B.stream],B.type==="detection_list"){if(R){for(var re=R.getRectList(),me=R.getLandmarksList(),ce=R.getClassificationsList(),Y=[],ie=0;ie<re.size();++ie){var Fe=Di(re.get(ie)),Ji=_e(Fe,1),eo=_e(Fe,2),to=_e(Fe,3),no=_e(Fe,4),ro=_e(Fe,5,0),St=void 0;St=St===void 0?0:St,Fe={la:{sa:Ji,ta:eo,height:to,width:no,rotation:ro,pa:vt(ye(Fe,6),St)},ea:nn(Bi(me.get(ie)),nt,1).map(Ui),ba:Li(Ri(ce.get(ie)))},Y.push(Fe)}re=Y}else re=[];o[k]=re,X.h=7;break}if(B.type==="proto_list"){if(R){for(re=Array(R.size()),me=0;me<R.size();me++)re[me]=R.get(me);R.delete()}else re=[];o[k]=re,X.h=7;break}if(R===void 0){X.h=3;break}if(B.type==="float_list"){o[k]=R,X.h=7;break}if(B.type==="proto"){o[k]=R,X.h=7;break}if(B.type!=="texture")throw Error("Unknown output config type: '"+B.type+"'");return T=e.v[k],T||(T=new cn(e.i,e.K),e.v[k]=T),E(X,br(T,R,e.M),13);case 13:D=X.i,o[k]=D;case 7:B.transform&&o[k]&&(o[k]=B.transform(o[k])),X.h=3;break;case 14:H[$]=X.i;case 3:c=_.next(),X.h=2;break;case 4:return X.return(o)}})}function qi(e,t,n){var o;return C(function(l){return typeof n=="number"||n instanceof Uint8Array||n instanceof e.i.Uint8BlobList?l.return(n):n instanceof e.i.Texture2dDataOut?(o=e.v[t],o||(o=new cn(e.i,e.K),e.v[t]=o),l.return(br(o,n,e.M))):l.return(void 0)})}function Zi(e,t){for(var n=t.name||"$",o=[].concat(y(t.wants)),l=new e.i.StringList,h=m(t.wants),c=h.next();!c.done;c=h.next())l.push_back(c.value);h=e.i.PacketListener.implement({onResults:function(g){for(var b={},_=0;_<t.wants.length;++_)b[o[_]]=g.get(_);var k=e.listeners[n];k&&(e.I=Qi(e,b,t.outs).then(function(B){B=k(B);for(var R=0;R<t.wants.length;++R){var T=b[o[R]];typeof T=="object"&&T.hasOwnProperty&&T.hasOwnProperty("delete")&&T.delete()}B&&(e.I=B)}))}}),e.j.attachMultiListener(l,h),l.delete()}s.onResults=function(e,t){this.listeners[t||"$"]=e},te("Solution",fn),te("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function Sr(e){switch(e===void 0&&(e=0),e){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function Ar(e){var t=this;e=e||{},this.h=new fn({locateFile:e.locateFile,files:function(n){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:Sr(n.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(n){var o,l,h;return C(function(c){return c.h==1?(o=Sr(n),l="third_party/mediapipe/modules/selfie_segmentation/"+o,E(c,xt(t.h,o),2)):(h=c.i,t.h.overrideFile(l,h),c.return(!0))})}}}})}s=Ar.prototype,s.close=function(){return this.h.close(),Promise.resolve()},s.onResults=function(e){this.h.onResults(e)},s.initialize=function(){var e=this;return C(function(t){return E(t,e.h.initialize(),0)})},s.reset=function(){this.h.reset()},s.send=function(e){var t=this;return C(function(n){return E(n,t.h.send(e),0)})},s.setOptions=function(e){this.h.setOptions(e)},te("SelfieSegmentation",Ar),te("VERSION","0.1.1675465747")}).call(It);/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var bn=function(s,i){return bn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,u){r.__proto__=u}||function(r,u){for(var a in u)u.hasOwnProperty(a)&&(r[a]=u[a])},bn(s,i)};function Xr(s,i){function r(){this.constructor=s}bn(s,i),s.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}var se=function(){return se=Object.assign||function(s){for(var i,r=1,u=arguments.length;r<u;r++)for(var a in i=arguments[r])Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a]);return s},se.apply(this,arguments)};function W(s,i,r,u){return new(r||(r=Promise))(function(a,f){function d(v){try{y(u.next(v))}catch(p){f(p)}}function m(v){try{y(u.throw(v))}catch(p){f(p)}}function y(v){var p;v.done?a(v.value):(p=v.value,p instanceof r?p:new r(function(x){x(p)})).then(d,m)}y((u=u.apply(s,[])).next())})}function V(s,i){var r,u,a,f,d={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return f={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function m(y){return function(v){return function(p){if(r)throw new TypeError("Generator is already executing.");for(;d;)try{if(r=1,u&&(a=2&p[0]?u.return:p[0]?u.throw||((a=u.return)&&a.call(u),0):u.next)&&!(a=a.call(u,p[1])).done)return a;switch(u=0,a&&(p=[2&p[0],a.value]),p[0]){case 0:case 1:a=p;break;case 4:return d.label++,{value:p[1],done:!1};case 5:d.label++,u=p[1],p=[0];continue;case 7:p=d.ops.pop(),d.trys.pop();continue;default:if(a=d.trys,!((a=a.length>0&&a[a.length-1])||p[0]!==6&&p[0]!==2)){d=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){d.label=p[1];break}if(p[0]===6&&d.label<a[1]){d.label=a[1],a=p;break}if(a&&d.label<a[2]){d.label=a[2],d.ops.push(p);break}a[2]&&d.ops.pop(),d.trys.pop();continue}p=i.call(s,d)}catch(x){p=[6,x],u=0}finally{r=a=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([y,v])}}}function Rt(s){return s instanceof SVGAnimatedLength?s.baseVal.value:s}function kn(s){return W(this,void 0,void 0,function(){var i,r;return V(this,function(u){switch(u.label){case 0:return i=document.createElement("canvas"),s instanceof Te?[4,Lt(s,i)]:[3,2];case 1:return u.sent(),[3,3];case 2:i.width=Rt(s.width),i.height=Rt(s.height),r=i.getContext("2d"),s instanceof ImageData?r.putImageData(s,0,0):r.drawImage(s,0,0),u.label=3;case 3:return[2,i]}})})}function $r(s){return W(this,void 0,void 0,function(){var i,r,u,a,f,d;return V(this,function(m){switch(m.label){case 0:return s instanceof Te?(i=s.shape.slice(0,2),r=i[0],u=i[1],a=ImageData.bind,[4,Lt(s)]):[3,2];case 1:return[2,new(a.apply(ImageData,[void 0,m.sent(),u,r]))];case 2:return f=document.createElement("canvas"),d=f.getContext("2d"),f.width=Rt(s.width),f.height=Rt(s.height),d.drawImage(s,0,0),[2,d.getImageData(0,0,f.width,f.height)]}})})}function Qr(s){return W(this,void 0,void 0,function(){var i,r;return V(this,function(u){switch(u.label){case 0:return s instanceof SVGImageElement||s instanceof OffscreenCanvas?[4,kn(s)]:[3,2];case 1:return r=u.sent(),[3,3];case 2:r=s,u.label=3;case 3:return i=r,[2,jn(i,4)]}})})}function ct(s){if(s<0||s>=256)throw new Error("Mask value must be in range [0, 255] but got "+s);if(!Number.isInteger(s))throw new Error("Mask value must be an integer but got "+s)}var pn=[[110,64,170],[143,61,178],[178,60,178],[210,62,167],[238,67,149],[255,78,125],[255,94,99],[255,115,75],[255,140,56],[239,167,47],[217,194,49],[194,219,64],[175,240,91],[135,245,87],[96,247,96],[64,243,115],[40,234,141],[28,219,169],[26,199,194],[33,176,213],[47,150,224],[65,125,224],[84,101,214],[99,81,195]];function Co(s){if(ct(s),s<pn.length){var i=pn[s];return{r:i[0],g:i[1],b:i[2],a:255}}throw new Error("Mask value must be in range [0, "+pn.length+")")}function qr(s){var i=s.shape[2],r=yo(s,2),u=Ut(r,[-1]);return wo(u,i)}function jt(s,i){return Z(function(){return We(bo(s,ut(i)),"int32")})}function Bo(s,i){var r=i.shape,u=r[0],a=r[1],f=r[2];return Z(function(){var d=qr(i),m=Xe(Wr(0,f,1,"int32"),1),y=We(Vr(d,m),"int32"),v=Ut(y,[u,a]),p=Dt(v,ut(1,"int32"));return _n(function(x,w){return Mn(x,w)}(p,s),ut(1,"int32"))})}var Zr=function(){function s(i,r){this.model=i,this.outputStride=r;var u=this.model.inputs[0].shape;st(u[1]===-1&&u[2]===-1,function(){return"Input shape ["+u[1]+", "+u[2]+"] must both be equal to or -1"})}return s.prototype.predict=function(i){var r=this;return Z(function(){var u=r.preprocessInput(We(i,"float32")),a=Xe(u,0),f=r.model.predict(a).map(function(m){return Ie(m,[0])}),d=r.nameOutputResults(f);return{heatmapScores:An(d.heatmap),offsets:d.offsets,displacementFwd:d.displacementFwd,displacementBwd:d.displacementBwd,segmentation:d.segmentation,partHeatmaps:d.partHeatmaps,longOffsets:d.longOffsets,partOffsets:d.partOffsets}})},s.prototype.dispose=function(){this.model.dispose()},s}(),Do=function(s){function i(){return s!==null&&s.apply(this,arguments)||this}return Xr(i,s),i.prototype.preprocessInput=function(r){return Z(function(){return _n(ho(r,127.5),1)})},i.prototype.nameOutputResults=function(r){return{offsets:r[0],segmentation:r[1],partHeatmaps:r[2],longOffsets:r[3],heatmap:r[4],displacementFwd:r[5],displacementBwd:r[6],partOffsets:r[7]}},i}(Zr),Ht=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],be=Ht.length,Ct=Ht.reduce(function(s,i,r){return s[i]=r,s},{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(s){var i=s[0],r=s[1];return[Ct[i],Ct[r]]});function On(s,i,r){var u=s[0],a=s[1],f=i[0],d=i[1],m=r.top,y=r.bottom;return[d/(r.left+r.right+a),f/(m+y+u)]}function Jr(s,i,r,u){return{y:u.get(s,i,r),x:u.get(s,i,r+be)}}function ei(s,i,r){var u=Jr(s.heatmapY,s.heatmapX,s.id,r),a=u.y,f=u.x;return{x:s.heatmapX*i+f,y:s.heatmapY*i+a}}function Er(s,i,r){return s<i?i:s>r?r:s}function jr(s,i){return{x:s.x+i.x,y:s.y+i.y}}function Lo(s,i,r){r===void 0&&(r=.3);for(var u=0,a=0,f=0;f<s.length;f++)i.keypoints[f].score>r&&(a+=1,u+=Math.pow(s[f].x-i.keypoints[f].position.x,2)+Math.pow(s[f].y-i.keypoints[f].position.y,2));return a===0?u=1/0:u/=a,u}function Uo(s,i,r,u,a,f,d){for(var m=d[0],y=d[1],v=r(s),p=v.y*u+v.x,x=a[be*(2*p)+i],w=a[be*(2*p+1)+i],A=s.y+x,S=s.x+w,j=0;j<f;j++){A=Math.min(A,m-1);var O=r({x:S=Math.min(S,y-1),y:A}),M=O.y*u+O.x;A+=x=a[be*(2*M)+i],S+=w=a[be*(2*M+1)+i]}return{x:S,y:A}}function ti(s,i,r,u,a,f,d,m,y,v){for(var p=a[0],x=a[1],w=f[0],A=f[1],S=m[0],j=m[1],O=[],M=function(L){return function(z,G,C,q){var K=G[0],ee=G[1],te=C[0],ne=C[1],ue=Math.round(((K+z.y+1)*ne-1)/q);return{x:Math.round(((ee+z.x+1)*te-1)/q),y:ue}}(L,[p,x],[w,A],y)},P=0;P<u;P++){var N=Uo(s,P,M,d,i,v,[S,j]);O.push(N)}for(var E=-1,I=1/0,F=0;F<r.length;F++){var U=Lo(O,r[F]);U<I&&(E=F,I=U)}return E}function ni(s,i){var r=s[0],u=s[1];return[Math.round((u-1)/i+1),Math.round((r-1)/i+1)]}function ri(s,i,r,u,a,f,d,m,y,v,p){for(var x=d[0],w=d[1],A=s.shape,S=A[0],j=A[1],O=i.shape.slice(0,2),M=O[0],P=O[1],N=Ut(i,[M,P,2,be]),E=new Float32Array(p*be*3).fill(0),I=0;I<r.length;I++)for(var F=I*be*3,U=r[I],L=0;L<be;L++){var z=U.keypoints[L],G=F+3*L;E[G]=z.score,E[G+1]=z.position.y,E[G+2]=z.position.x}var C=On([u,a],[x,w],m),q=C[0],K=C[1],ee=So(E,[p,be,3]),te=m.top,ne=m.left,ue={variableNames:["segmentation","longOffsets","poses"],outputShape:[S,j],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+te+", "+K+", "+f+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+ne+", "+q+", "+f+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+p+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+be+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+y+`; s++) {
            int yRounded = round(min(y, float(`+(u-1)+`)));
            int xRounded = round(min(x, float(`+(a-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+te+", "+K+", "+f+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+ne+", "+q+", "+f+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+v+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return Ao().compileAndRun(ue,[s,N,ee])}function ii(){return _o()==="webgl"}function Ho(s,i,r,u,a,f,d,m,y,v,p,x){var w=d[0],A=d[1];return y===void 0&&(y=.2),v===void 0&&(v=8),p===void 0&&(p=.3),x===void 0&&(x=10),W(this,void 0,void 0,function(){var S,j,O,M,P;return V(this,function(N){switch(N.label){case 0:return S=r.filter(function(E){return E.score>=y}),ii()?(O=Z(function(){var E=ri(s,i,S,u,a,f,[w,A],m,v,p,x),I=Gr().makeTensorFromDataId(E.dataId,E.shape,E.dtype);return S.map(function(F,U){return function(L,z){return Z(function(){return We(Yr(L,ut(z)),"int32")})}(I,U)})}),[4,Promise.all(O.map(function(E){return E.data()}))]):[3,2];case 1:return j=N.sent(),O.forEach(function(E){return E.dispose()}),[3,5];case 2:return[4,s.data()];case 3:return M=N.sent(),[4,i.data()];case 4:P=N.sent(),j=function(E,I,F,U,L,z,G,C,q,K){var ee=G[0],te=G[1];K===void 0&&(K=5);for(var ne=F.map(function(ke){return new Uint8Array(U*L).fill(0)}),ue=C.top,ve=C.left,fe=On([U,L],[ee,te],C),Re=fe[0],Ce=fe[1],Me=ni([ee,te],z)[0],he=0;he<U;he+=1)for(var de=0;de<L;de+=1){var ge=he*L+de;if(E[ge]===1){var pe=ti({x:de,y:he},I,F,K,[ue,ve],[Re,Ce],Me,[U,L],z,q);pe>=0&&(ne[pe][ge]=1)}}return ne}(M,P,S,u,a,f,[w,A],m,v),N.label=5;case 5:return[2,j.map(function(E,I){return{data:E,pose:S[I],width:a,height:u}})]}})})}function zo(s,i,r,u,a,f,d,m,y,v,p,x,w){var A=m[0],S=m[1];return v===void 0&&(v=.2),p===void 0&&(p=8),x===void 0&&(x=.3),w===void 0&&(w=10),W(this,void 0,void 0,function(){var j,O,M,P,N,E;return V(this,function(I){switch(I.label){case 0:return j=u.filter(function(F){return F.score>=v}),ii()?(M=Z(function(){var F=ri(s,i,j,a,f,d,[A,S],y,p,x,w),U=Gr().makeTensorFromDataId(F.dataId,F.shape,F.dtype);return j.map(function(L,z){return function(G,C,q){return Z(function(){return _n(Mn(We(Yr(G,ut(q)),"int32"),Dt(C,1)),1)})}(U,r,z)})}),[4,Promise.all(M.map(function(F){return F.data()}))]):[3,2];case 1:return O=I.sent(),M.forEach(function(F){return F.dispose()}),[3,6];case 2:return[4,s.data()];case 3:return P=I.sent(),[4,i.data()];case 4:return N=I.sent(),[4,r.data()];case 5:E=I.sent(),O=function(F,U,L,z,G,C,q,K,ee,te,ne){var ue=K[0],ve=K[1];ne===void 0&&(ne=5);for(var fe=z.map(function(Ve){return new Int32Array(G*C).fill(-1)}),Re=ee.top,Ce=ee.left,Me=On([G,C],[ue,ve],ee),he=Me[0],de=Me[1],ge=ni([ue,ve],q)[0],pe=0;pe<G;pe+=1)for(var ke=0;ke<C;ke+=1){var Ne=pe*C+ke;if(F[Ne]===1){var Be=ti({x:ke,y:pe},U,z,ne,[Re,Ce],[he,de],ge,[G,C],q,te);Be>=0&&(fe[Be][Ne]=L[Ne])}}return fe}(P,N,E,j,a,f,d,[A,S],y,p),I.label=6;case 6:return[2,O.map(function(F,U){return{pose:j[U],data:F,height:a,width:f}})]}})})}function mn(s){return Math.floor(s/2)}var Wo=function(){function s(i,r){this.priorityQueue=new Array(i),this.numberOfElements=-1,this.getElementValue=r}return s.prototype.enqueue=function(i){this.priorityQueue[++this.numberOfElements]=i,this.swim(this.numberOfElements)},s.prototype.dequeue=function(){var i=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,i},s.prototype.empty=function(){return this.numberOfElements===-1},s.prototype.size=function(){return this.numberOfElements+1},s.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},s.prototype.max=function(){return this.priorityQueue[0]},s.prototype.swim=function(i){for(;i>0&&this.less(mn(i),i);)this.exchange(i,mn(i)),i=mn(i)},s.prototype.sink=function(i){for(;2*i<=this.numberOfElements;){var r=2*i;if(r<this.numberOfElements&&this.less(r,r+1)&&r++,!this.less(i,r))break;this.exchange(i,r),i=r}},s.prototype.getValueAt=function(i){return this.getElementValue(this.priorityQueue[i])},s.prototype.less=function(i,r){return this.getValueAt(i)<this.getValueAt(r)},s.prototype.exchange=function(i,r){var u=this.priorityQueue[i];this.priorityQueue[i]=this.priorityQueue[r],this.priorityQueue[r]=u},s}();function Vo(s,i,r,u,a,f){for(var d=f.shape,m=d[0],y=d[1],v=!0,p=Math.max(r-a,0),x=Math.min(r+a+1,m),w=p;w<x;++w){for(var A=Math.max(u-a,0),S=Math.min(u+a+1,y),j=A;j<S;++j)if(f.get(w,j,s)>i){v=!1;break}if(!v)break}return v}var oi=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(s){var i=s[0],r=s[1];return[Ct[i],Ct[r]]}),vn=oi.map(function(s){return s[1]}),Mr=oi.map(function(s){return s[0]});function gn(s,i,r,u){return{y:Er(Math.round(s.y/i),0,r-1),x:Er(Math.round(s.x/i),0,u-1)}}function kr(s,i,r,u,a,f,d,m){m===void 0&&(m=2);for(var y=u.shape,v=y[0],p=y[1],x=function(P,N,E){var I=E.shape[2]/2;return{y:E.get(N.y,N.x,P),x:E.get(N.y,N.x,I+P)}}(s,gn(i.position,f,v,p),d),w=jr(i.position,x),A=0;A<m;A++){var S=gn(w,f,v,p),j=Jr(S.y,S.x,r,a);w=jr({x:S.x*f,y:S.y*f},{x:j.x,y:j.y})}var O=gn(w,f,v,p),M=u.get(O.y,O.x,r);return{position:w,part:Ht[r],score:M}}function Go(s,i,r,u,a,f){var d=i.shape[2],m=vn.length,y=new Array(d),v=s.part,p=s.score,x=ei(v,u,r);y[v.id]={score:p,part:Ht[v.id],position:x};for(var w=m-1;w>=0;--w){var A=vn[w],S=Mr[w];y[A]&&!y[S]&&(y[S]=kr(w,y[A],S,i,r,u,f))}for(w=0;w<m;++w)A=Mr[w],S=vn[w],y[A]&&!y[S]&&(y[S]=kr(w,y[A],S,i,r,u,a));return y}function si(s,i,r,u){var a=r.x,f=r.y;return s.some(function(d){var m,y,v,p,x,w,A=d.keypoints[u].position;return m=f,y=a,v=A.y,p=A.x,(x=v-m)*x+(w=p-y)*w<=i})}function Yo(s,i,r){var u=r.reduce(function(a,f,d){var m=f.position,y=f.score;return si(s,i,m,d)||(a+=y),a},0);return u/r.length}function Mt(s,i,r,u,a,f,d,m){d===void 0&&(d=.5),m===void 0&&(m=20);for(var y=[],v=function(S,j,O){for(var M=O.shape,P=M[0],N=M[1],E=M[2],I=new Wo(P*N*E,function(G){return G.score}),F=0;F<P;++F)for(var U=0;U<N;++U)for(var L=0;L<E;++L){var z=O.get(F,U,L);z<S||Vo(L,z,F,U,j,O)&&I.enqueue({score:z,part:{heatmapY:F,heatmapX:U,id:L}})}return I}(d,1,s),p=m*m;y.length<f&&!v.empty();){var x=v.dequeue();if(!si(y,p,ei(x.part,a,i),x.part.id)){var w=Go(x,s,i,a,r,u),A=Yo(y,p,w);y.push({keypoints:w,score:A})}}return y}var rt,Ko=[-123.15,-115.9,-103.06],Xo=function(s){function i(){return s!==null&&s.apply(this,arguments)||this}return Xr(i,s),i.prototype.preprocessInput=function(r){return Dt(r,Ko)},i.prototype.nameOutputResults=function(r){var u=r[0],a=r[1],f=r[2],d=r[3],m=r[4],y=r[5];return{offsets:m,segmentation:r[6],partHeatmaps:y,longOffsets:d,heatmap:f,displacementFwd:a,displacementBwd:u,partOffsets:r[7]}},i}(Zr),Or="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",Pr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function it(s){if(typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement)return function(i){if("offsetHeight"in i&&i.offsetHeight!==0&&"offsetWidth"in i&&i.offsetWidth!==0)return[i.offsetHeight,i.offsetWidth];if(i.height!=null&&i.width!=null)return[i.height,i.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(s);if(typeof ImageData<"u"&&s instanceof ImageData)return[s.height,s.width];if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement)return function(i){return i.hasAttribute("height")&&i.hasAttribute("width")?[i.height,i.width]:[i.videoHeight,i.videoWidth]}(s);if(s instanceof Te)return[s.shape[0],s.shape[1]];throw new Error("error: Unknown input type: "+s+".")}function Tr(s,i){return function(r,u){return(r-1)%u==0}(s,i)?s:Math.floor(s/i)*i+1}var ot={low:"low",medium:"medium",high:"high",full:"full"},$o=((rt={})[ot.low]=.25,rt[ot.medium]=.5,rt[ot.high]=.75,rt[ot.full]=1,rt);function kt(s,i,r){var u=r[0],a=r[1],f=function(d){if(typeof d=="string"){var m=$o[d];return st(typeof m=="number",function(){return"string value of inputResolution must be one of "+Object.values(ot).join(",")+" but was "+d+"."}),m}return st(typeof d=="number"&&d<=2&&d>=.1,function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+d}),d}(s);return[Tr(u*f,i),Tr(a*f,i)]}function Ke(s,i,r,u,a){var f=i[0],d=i[1],m=r[0],y=r[1],v=u[0],p=v[0],x=v[1],w=u[1],A=w[0],S=w[1];return Z(function(){var j=at.resizeBilinear(s,[m,y],!0);return j=An(j),function(O,M,P){var N=M[0],E=M[1],I=P[0],F=I[0],U=I[1],L=P[1],z=L[0],G=L[1];return Z(function(){var C=Xe(O);return Ie(at.cropAndResize(C,[[F/(N+F+U-1),z/(E+z+G-1),(F+N-1)/(N+F+U-1),(z+E-1)/(E+z+G-1)]],[0],[N,E]),[0])})}(j,[f,d],[[p,x],[A,S]])})}function Ot(s,i){var r=i[0],u=i[1],a=it(s),f=a[0],d=a[1],m=u/r,y=[0,0,0,0],v=y[0],p=y[1],x=y[2],w=y[3];d/f<m?(v=0,p=0,x=Math.round(.5*(m*f-d)),w=Math.round(.5*(m*f-d))):(v=Math.round(.5*(1/m*d-f)),p=Math.round(.5*(1/m*d-f)),x=0,w=0);var A=Z(function(){var S=function(j){return j instanceof Te?j:jn(j)}(s);return S=xo(S,[[v,p],[x,w],[0,0]]),at.resizeBilinear(S,[r,u])});return{resized:A,padding:{top:v,left:x,right:w,bottom:p}}}function Pt(s){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,Promise.all(s.map(function(r){return r.buffer()}))]})})}function Tt(s,i,r,u,a){var f=i[0],d=i[1],m=r[0],y=r[1],v=function(p,x,w,A,S){return A===void 0&&(A=0),S===void 0&&(S=0),w===1&&x===1&&A===0&&S===0?p:p.map(function(j){return function(O,M,P,N,E){return N===void 0&&(N=0),E===void 0&&(E=0),{score:O.score,keypoints:O.keypoints.map(function(I){var F=I.score,U=I.part,L=I.position;return{score:F,part:U,position:{x:L.x*P+E,y:L.y*M+N}}})}}(j,x,w,A,S)})}(s,(f+u.top+u.bottom)/m,(d+u.left+u.right)/y,-u.top,-u.left);return a?function(p,x){return x<=0?p:p.map(function(w){return function(A,S){return{score:A.score,keypoints:A.keypoints.map(function(j){var O=j.score,M=j.part,P=j.position;return{score:O,part:M,position:{x:S-1-P.x,y:P.y}}})}}(w,x)})}(v,d):v}var Nr={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},Fr=["MobileNetV1","ResNet50"],Ir={MobileNetV1:[8,16,32],ResNet50:[32,16]},Rr={MobileNetV1:[.5,.75,1],ResNet50:[1]},Cr=[1,2,4],Nt={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},Ft={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function Br(s){var i=s.segmentationThreshold,r=s.maxDetections,u=s.scoreThreshold,a=s.nmsRadius;if(i<0||i>1)throw new Error("segmentationThreshold "+i+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid maxDetections "+r+". Should be > 0");if(u<0||u>1)throw new Error("Invalid scoreThreshold "+u+". Should be in range [0.0, 1.0]");if(a<=0)throw new Error("Invalid nmsRadius "+a+".")}function Dr(s){var i=s.segmentationThreshold,r=s.maxDetections,u=s.scoreThreshold,a=s.nmsRadius,f=s.minKeypointScore,d=s.refineSteps;if(i<0||i>1)throw new Error("segmentationThreshold "+i+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid maxDetections "+r+". Should be > 0");if(u<0||u>1)throw new Error("Invalid scoreThreshold "+u+". Should be in range [0.0, 1.0]");if(a<=0)throw new Error("Invalid nmsRadius "+a+".");if(f<0||f>1)throw new Error("Invalid minKeypointScore "+f+".Should be in range [0.0, 1.0]");if(d<=0||d>20)throw new Error("Invalid refineSteps "+d+".Should be in range [1, 20]")}var ai=function(){function s(i){this.baseModel=i}return s.prototype.predictForPersonSegmentation=function(i){var r=this.baseModel.predict(i);return{segmentLogits:r.segmentation,heatmapScores:r.heatmapScores,offsets:r.offsets,displacementFwd:r.displacementFwd,displacementBwd:r.displacementBwd}},s.prototype.predictForPersonSegmentationAndPart=function(i){var r=this.baseModel.predict(i);return{segmentLogits:r.segmentation,partHeatmapLogits:r.partHeatmaps,heatmapScores:r.heatmapScores,offsets:r.offsets,displacementFwd:r.displacementFwd,displacementBwd:r.displacementBwd}},s.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(i){var r=this.baseModel.predict(i);return{segmentLogits:r.segmentation,longOffsets:r.longOffsets,heatmapScores:r.heatmapScores,offsets:r.offsets,displacementFwd:r.displacementFwd,displacementBwd:r.displacementBwd,partHeatmaps:r.partHeatmaps}},s.prototype.segmentPersonActivation=function(i,r,u){var a=this;u===void 0&&(u=.5);var f=it(i),d=f[0],m=f[1],y=kt(r,this.baseModel.outputStride,[d,m]),v=Ot(i,y),p=v.resized,x=v.padding,w=Z(function(){var P=a.predictForPersonSegmentation(p),N=P.segmentLogits,E=P.heatmapScores,I=P.offsets,F=P.displacementFwd,U=P.displacementBwd,L=p.shape,z=L[0],G=L[1],C=Ke(N,[d,m],[z,G],[[x.top,x.bottom],[x.left,x.right]]);return{segmentation:jt(Ie(C),u),heatmapScores:E,offsets:I,displacementFwd:F,displacementBwd:U}}),A=w.segmentation,S=w.heatmapScores,j=w.offsets,O=w.displacementFwd,M=w.displacementBwd;return p.dispose(),{segmentation:A,heatmapScores:S,offsets:j,displacementFwd:O,displacementBwd:M,padding:x,internalResolutionHeightAndWidth:y}},s.prototype.segmentPerson=function(i,r){return r===void 0&&(r=Nt),W(this,void 0,void 0,function(){var u,a,f,d,m,y,v,p,x,w,A,S,j,O,M,P,N,E;return V(this,function(I){switch(I.label){case 0:return Br(r=se(se({},Nt),r)),u=this.segmentPersonActivation(i,r.internalResolution,r.segmentationThreshold),a=u.segmentation,f=u.heatmapScores,d=u.offsets,m=u.displacementFwd,y=u.displacementBwd,v=u.padding,p=u.internalResolutionHeightAndWidth,x=a.shape,w=x[0],A=x[1],[4,a.data()];case 1:return S=I.sent(),a.dispose(),[4,Pt([f,d,m,y])];case 2:return j=I.sent(),O=j[0],M=j[1],P=j[2],N=j[3],E=Tt(E=Mt(O,M,P,N,this.baseModel.outputStride,r.maxDetections,r.scoreThreshold,r.nmsRadius),[w,A],p,v,!1),f.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,{height:w,width:A,data:S,allPoses:E}]}})})},s.prototype.segmentMultiPerson=function(i,r){return r===void 0&&(r=Ft),W(this,void 0,void 0,function(){var u,a,f,d,m,y,v,p,x,w,A,S,j,O,M,P,N,E,I,F,U,L=this;return V(this,function(z){switch(z.label){case 0:return Dr(r=se(se({},Ft),r)),u=it(i),a=u[0],f=u[1],d=kt(r.internalResolution,this.baseModel.outputStride,[a,f]),m=Ot(i,d),y=m.resized,v=m.padding,p=Z(function(){var G,C=L.predictForMultiPersonInstanceSegmentationAndPart(y),q=C.segmentLogits,K=C.longOffsets,ee=C.heatmapScores,te=C.offsets,ne=C.displacementFwd,ue=C.displacementBwd,ve=Ke(q,[a,f],d,[[v.top,v.bottom],[v.left,v.right]]);return G=K,{segmentation:jt(Ie(ve),r.segmentationThreshold),longOffsets:G,heatmapScoresRaw:ee,offsetsRaw:te,displacementFwdRaw:ne,displacementBwdRaw:ue}}),x=p.segmentation,w=p.longOffsets,A=p.heatmapScoresRaw,S=p.offsetsRaw,j=p.displacementFwdRaw,O=p.displacementBwdRaw,[4,Pt([A,S,j,O])];case 1:return M=z.sent(),P=M[0],N=M[1],E=M[2],I=M[3],F=Tt(F=Mt(P,N,E,I,this.baseModel.outputStride,r.maxDetections,r.scoreThreshold,r.nmsRadius),[a,f],d,v,!1),[4,Ho(x,w,F,a,f,this.baseModel.outputStride,d,v,r.scoreThreshold,r.refineSteps,r.minKeypointScore,r.maxDetections)];case 2:return U=z.sent(),y.dispose(),x.dispose(),w.dispose(),A.dispose(),S.dispose(),j.dispose(),O.dispose(),[2,U]}})})},s.prototype.segmentPersonPartsActivation=function(i,r,u){var a=this;u===void 0&&(u=.5);var f=it(i),d=f[0],m=f[1],y=kt(r,this.baseModel.outputStride,[d,m]),v=Ot(i,y),p=v.resized,x=v.padding,w=Z(function(){var P=a.predictForPersonSegmentationAndPart(p),N=P.segmentLogits,E=P.partHeatmapLogits,I=P.heatmapScores,F=P.offsets,U=P.displacementFwd,L=P.displacementBwd,z=p.shape,G=z[0],C=z[1],q=Ke(N,[d,m],[G,C],[[x.top,x.bottom],[x.left,x.right]]),K=Ke(E,[d,m],[G,C],[[x.top,x.bottom],[x.left,x.right]]);return{partSegmentation:Bo(jt(Ie(q),u),K),heatmapScores:I,offsets:F,displacementFwd:U,displacementBwd:L}}),A=w.partSegmentation,S=w.heatmapScores,j=w.offsets,O=w.displacementFwd,M=w.displacementBwd;return p.dispose(),{partSegmentation:A,heatmapScores:S,offsets:j,displacementFwd:O,displacementBwd:M,padding:x,internalResolutionHeightAndWidth:y}},s.prototype.segmentPersonParts=function(i,r){return r===void 0&&(r=Nt),W(this,void 0,void 0,function(){var u,a,f,d,m,y,v,p,x,w,A,S,j,O,M,P,N,E;return V(this,function(I){switch(I.label){case 0:return Br(r=se(se({},Nt),r)),u=this.segmentPersonPartsActivation(i,r.internalResolution,r.segmentationThreshold),a=u.partSegmentation,f=u.heatmapScores,d=u.offsets,m=u.displacementFwd,y=u.displacementBwd,v=u.padding,p=u.internalResolutionHeightAndWidth,x=a.shape,w=x[0],A=x[1],[4,a.data()];case 1:return S=I.sent(),a.dispose(),[4,Pt([f,d,m,y])];case 2:return j=I.sent(),O=j[0],M=j[1],P=j[2],N=j[3],E=Tt(E=Mt(O,M,P,N,this.baseModel.outputStride,r.maxDetections,r.scoreThreshold,r.nmsRadius),[w,A],p,v,!1),f.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,{height:w,width:A,data:S,allPoses:E}]}})})},s.prototype.segmentMultiPersonParts=function(i,r){return r===void 0&&(r=Ft),W(this,void 0,void 0,function(){var u,a,f,d,m,y,v,p,x,w,A,S,j,O,M,P,N,E,I,F,U,L,z=this;return V(this,function(G){switch(G.label){case 0:return Dr(r=se(se({},Ft),r)),u=it(i),a=u[0],f=u[1],d=kt(r.internalResolution,this.baseModel.outputStride,[a,f]),m=Ot(i,d),y=m.resized,v=m.padding,p=Z(function(){var C=z.predictForMultiPersonInstanceSegmentationAndPart(y),q=C.segmentLogits,K=C.longOffsets,ee=C.heatmapScores,te=C.offsets,ne=C.displacementFwd,ue=C.displacementBwd,ve=C.partHeatmaps,fe=Ke(q,[a,f],d,[[v.top,v.bottom],[v.left,v.right]]),Re=Ke(ve,[a,f],d,[[v.top,v.bottom],[v.left,v.right]]),Ce=K,Me=jt(Ie(fe),r.segmentationThreshold),he=function(de){var ge=de.shape,pe=ge[0],ke=ge[1],Ne=ge[2];return Z(function(){var Be=qr(de),Ve=Xe(Wr(0,Ne,1,"int32"),1),De=We(Vr(Be,Ve),"int32");return Ut(De,[pe,ke])})}(Re);return{segmentation:Me,longOffsets:Ce,heatmapScoresRaw:ee,offsetsRaw:te,displacementFwdRaw:ne,displacementBwdRaw:ue,partSegmentation:he}}),x=p.segmentation,w=p.longOffsets,A=p.heatmapScoresRaw,S=p.offsetsRaw,j=p.displacementFwdRaw,O=p.displacementBwdRaw,M=p.partSegmentation,[4,Pt([A,S,j,O])];case 1:return P=G.sent(),N=P[0],E=P[1],I=P[2],F=P[3],U=Tt(U=Mt(N,E,I,F,this.baseModel.outputStride,r.maxDetections,r.scoreThreshold,r.nmsRadius),[a,f],d,v,!1),[4,zo(x,w,M,U,a,f,this.baseModel.outputStride,d,v,r.scoreThreshold,r.refineSteps,r.minKeypointScore,r.maxDetections)];case 2:return L=G.sent(),y.dispose(),x.dispose(),w.dispose(),A.dispose(),S.dispose(),j.dispose(),O.dispose(),M.dispose(),[2,L]}})})},s.prototype.dispose=function(){this.baseModel.dispose()},s}();function Qo(s){return W(this,void 0,void 0,function(){var i,r,u,a,f,d;return V(this,function(m){switch(m.label){case 0:if(i=s.outputStride,r=s.quantBytes,u=s.multiplier,En==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return a=function(y,v,p){var x={1:"100",.75:"075",.5:"050"},w="model-stride"+y+".json";return p===4?Pr+"float/"+x[v]+"/"+w:Pr+"quant"+p+"/"+x[v]+"/"+w}(i,u,r),[4,Bt(s.modelUrl||a)];case 1:return f=m.sent(),d=new Do(f,i),[2,new ai(d)]}})})}function qo(s){return W(this,void 0,void 0,function(){var i,r,u,a,f;return V(this,function(d){switch(d.label){case 0:if(i=s.outputStride,r=s.quantBytes,En==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return u=function(m,y){var v="model-stride"+m+".json";return y===4?Or+"float/"+v:Or+"quant"+y+"/"+v}(i,r),[4,Bt(s.modelUrl||u)];case 1:return a=d.sent(),f=new Xo(a,i),[2,new ai(f)]}})})}function Zo(s){return s===void 0&&(s=Nr),W(this,void 0,void 0,function(){return V(this,function(i){return(s=function(r){if((r=r||Nr).architecture==null&&(r.architecture="MobileNetV1"),Fr.indexOf(r.architecture)<0)throw new Error("Invalid architecture "+r.architecture+". Should be one of "+Fr);if(r.outputStride==null&&(r.outputStride=16),Ir[r.architecture].indexOf(r.outputStride)<0)throw new Error("Invalid outputStride "+r.outputStride+". Should be one of "+Ir[r.architecture]+" for architecture "+r.architecture+".");if(r.multiplier==null&&(r.multiplier=1),Rr[r.architecture].indexOf(r.multiplier)<0)throw new Error("Invalid multiplier "+r.multiplier+". Should be one of "+Rr[r.architecture]+" for architecture "+r.architecture+".");if(r.quantBytes==null&&(r.quantBytes=4),Cr.indexOf(r.quantBytes)<0)throw new Error("Invalid quantBytes "+r.quantBytes+". Should be one of "+Cr+" for architecture "+r.architecture+".");return r}(s)).architecture==="ResNet50"?[2,qo(s)]:s.architecture==="MobileNetV1"?[2,Qo(s)]:[2,null]})})}var xn=["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],Lr=function(){function s(i){this.mask=i}return s.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,kn(this.mask)]})})},s.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,this.mask]})})},s.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,Qr(this.mask)]})})},s.prototype.getUnderlyingType=function(){return"imagedata"},s}();function Jo(s){if(ct(s),s!==255)throw new Error("Foreground id must be 255 but got "+s);return"person"}function es(s){if(ct(s),s>=xn.length)throw new Error("Invalid body part value "+s);return xn[s]}var ts=function(){function s(i){this.bodyPixModel=i}return s.prototype.segmentPeople=function(i,r){return W(this,void 0,void 0,function(){var u,a,f,d;return V(this,function(m){switch(m.label){case 0:return i instanceof ImageBitmap&&((u=document.createElement("canvas")).getContext("2d").drawImage(i,0,0),i=u),r.segmentBodyParts?r.multiSegmentation?[4,this.bodyPixModel.segmentMultiPersonParts(i,r)]:[3,2]:[3,5];case 1:return f=m.sent(),[3,4];case 2:return[4,this.bodyPixModel.segmentPersonParts(i,r)];case 3:f=[m.sent()],m.label=4;case 4:return a=f.map(function(y){var v=y.data,p=y.width,x=y.height,w=new Uint8ClampedArray(p*x*4).fill(0);return v.forEach(function(A,S){A===-1?(w[4*S]=xn.length,w[4*S+3]=0):(w[4*S]=A,w[4*S+3]=255)}),{maskValueToLabel:es,mask:new Lr(new ImageData(w,p,x))}}),[3,10];case 5:return r.multiSegmentation?[4,this.bodyPixModel.segmentMultiPerson(i,r)]:[3,7];case 6:return d=m.sent(),[3,9];case 7:return[4,this.bodyPixModel.segmentPerson(i,r)];case 8:d=[m.sent()],m.label=9;case 9:a=d.map(function(y){var v=y.data,p=y.width,x=y.height,w=new Uint8ClampedArray(p*x*4).fill(0);return v.forEach(function(A,S){A===0?(w[4*S]=0,w[4*S+3]=0):(w[4*S]=255,w[4*S+3]=255)}),{maskValueToLabel:Jo,mask:new Lr(new ImageData(w,p,x))}}),m.label=10;case 10:return[2,a]}})})},s.prototype.dispose=function(){this.bodyPixModel.dispose()},s.prototype.reset=function(){},s}();function ns(s){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,Zo(s).then(function(r){return new ts(r)})]})})}var Ur={runtime:"mediapipe",modelType:"general"},rs=function(){function s(i){this.mask=i}return s.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,this.mask]})})},s.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,$r(this.mask)]})})},s.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,Qr(this.mask)]})})},s.prototype.getUnderlyingType=function(){return"canvasimagesource"},s}();function is(s){return ct(s),"person"}var os=function(){function s(i){var r,u=this;this.selfieMode=!1;var a;this.selfieSegmentationSolution=new Ro.SelfieSegmentation({locateFile:(r=i.locateFile)!==null&&r!==void 0?r:function(f,d){return i.solutionPath?i.solutionPath.replace(/\/+$/,"")+"/"+f:d+"/"+f}}),i.modelType==="landscape"?a=1:a=0,this.selfieSegmentationSolution.setOptions({modelSelection:a,selfieMode:this.selfieMode}),this.selfieSegmentationSolution.onResults(function(f){u.segmentation=[{maskValueToLabel:is,mask:new rs(f.segmentationMask)}]})}return s.prototype.segmentPeople=function(i,r){return W(this,void 0,void 0,function(){var u,a;return V(this,function(f){switch(f.label){case 0:return r&&r.flipHorizontal&&r.flipHorizontal!==this.selfieMode&&(this.selfieMode=r.flipHorizontal,this.selfieSegmentationSolution.setOptions({selfieMode:this.selfieMode})),i instanceof Te?(a=ImageData.bind,[4,Lt(i)]):[3,2];case 1:return u=new(a.apply(ImageData,[void 0,f.sent(),i.shape[1],i.shape[0]])),[3,3];case 2:u=i,f.label=3;case 3:return i=u,[4,this.selfieSegmentationSolution.send({image:i})];case 4:return f.sent(),[2,this.segmentation]}})})},s.prototype.dispose=function(){this.selfieSegmentationSolution.close()},s.prototype.reset=function(){this.selfieSegmentationSolution.reset(),this.segmentation=null,this.selfieMode=!1},s.prototype.initialize=function(){return this.selfieSegmentationSolution.initialize()},s}();function ss(s){return W(this,void 0,void 0,function(){var i,r;return V(this,function(u){switch(u.label){case 0:return i=function(a){if(a==null)return se({},Ur);var f=se({},a);return f.runtime="mediapipe",f.modelType==null&&(f.modelType=Ur.modelType),f}(s),[4,(r=new os(i)).initialize()];case 1:return u.sent(),[2,r]}})})}function as(s,i,r,u){var a=s.width,f=s.height,d=1,m=Math.cos(s.rotation),y=Math.sin(s.rotation),v=s.xCenter,p=s.yCenter,x=1/i,w=1/r,A=new Array(16);return A[0]=a*m*d*x,A[1]=-f*y*x,A[2]=0,A[3]=(-.5*a*m*d+.5*f*y+v)*x,A[4]=a*y*d*w,A[5]=f*m*w,A[6]=0,A[7]=(-.5*f*m-.5*a*y*d+p)*w,A[8]=0,A[9]=0,A[10]=a*x,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,function(S){if(S.length!==16)throw new Error("Array length must be 16 but got "+S.length);return[[S[0],S[1],S[2],S[3]],[S[4],S[5],S[6],S[7]],[S[8],S[9],S[10],S[11]],[S[12],S[13],S[14],S[15]]]}(A)}function ui(s){return s instanceof Te?{height:s.shape[0],width:s.shape[1]}:{height:s.height,width:s.width}}function yn(s,i){st(s.width!==0,function(){return i+" width cannot be 0."}),st(s.height!==0,function(){return i+" height cannot be 0."})}function us(s,i){var r=function(u,a,f,d){var m=a-u,y=d-f,v=y/m;return{scale:v,offset:f-u*v}}(0,255,i[0],i[1]);return Z(function(){return Dt(Mn(s,r.scale),r.offset)})}function ls(s,i,r){var u=i.outputTensorSize,a=i.keepAspectRatio,f=i.borderMode,d=i.outputTensorFloatRange,m=ui(s),y=function(w,A){return{xCenter:.5*w.width,yCenter:.5*w.height,width:w.width,height:w.height,rotation:0}}(m),v=function(w,A,S){if(S===void 0&&(S=!1),!S)return{top:0,left:0,right:0,bottom:0};var j=A.height,O=A.width;yn(A,"targetSize"),yn(w,"roi");var M,P,N=j/O,E=w.height/w.width,I=0,F=0;return N>E?(M=w.width,P=w.width*N,F=(1-E/N)/2):(M=w.height/N,P=w.height,I=(1-N/E)/2),w.width=M,w.height=P,{top:F,left:I,right:I,bottom:F}}(y,u,a),p=as(y,m.width,m.height),x=Z(function(){var w,A=(w=s)instanceof Te?w:jn(w),S=go(function(M,P,N){return yn(N,"inputResolution"),[1/N.width*M[0][0]*P.width,1/N.height*M[0][1]*P.width,M[0][3]*P.width,1/N.width*M[1][0]*P.height,1/N.height*M[1][1]*P.height,M[1][3]*P.height,0,0]}(p,m,u),[1,8]),j=f==="zero"?"constant":"nearest",O=at.transform(Xe(We(A,"float32")),S,"bilinear",j,0,[u.height,u.width]);return d!=null?us(O,d):O});return{imageTensor:x,padding:v,transformationMatrix:p}}function cs(s,i,r){return Z(function(){var u=Ie(s,[0]),a=u.shape[2];if(a===1){var f=u;switch(i.activation){case"none":break;case"sigmoid":f=An(f);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+i.activation+")")}var d=r?at.resizeBilinear(f,[r.height,r.width]):f;return Ie(d,[2])}throw new Error("Unsupported number of tensor channels "+a)})}var Hr={runtime:"tfjs",modelType:"general",modelUrl:"https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1"},zr={flipHorizontal:!1},fs={outputTensorSize:{width:256,height:256},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},hs={outputTensorSize:{width:256,height:144},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},ds={activation:"none"},ps=function(){function s(i){this.mask=i}return s.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,kn(this.mask)]})})},s.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,$r(this.mask)]})})},s.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(i){return[2,this.mask]})})},s.prototype.getUnderlyingType=function(){return"tensor"},s}();function ms(s){return ct(s),"person"}var lt,vs=function(){function s(i,r){this.modelType=i,this.model=r}return s.prototype.segmentPeople=function(i,r){return W(this,void 0,void 0,function(){var u,a=this;return V(this,function(f){return r=function(d){if(d==null)return se({},zr);var m=se({},d);return m.flipHorizontal==null&&(m.flipHorizontal=zr.flipHorizontal),m}(r),i==null?(this.reset(),[2,[]]):(u=Z(function(){var d=ls(i,a.modelType==="general"?fs:hs).imageTensor,m=po(a.model.predict(d),[0,0,0,1],-1),y=ui(i),v=cs(m,ds,y),p=Xe(v,2),x=mo(p,[[0,0],[0,0],[0,1]]);return vo(x,[[0,0],[0,0],[0,2]],"symmetric")}),[2,[{maskValueToLabel:ms,mask:new ps(u)}]])})})},s.prototype.dispose=function(){this.model.dispose()},s.prototype.reset=function(){},s}();function gs(s){return W(this,void 0,void 0,function(){var i,r,u;return V(this,function(a){switch(a.label){case 0:return i=function(f){if(f==null)return se({},Hr);var d=se({},f);if(d.runtime="tfjs",d.modelType==null&&(d.modelType=Hr.modelType),d.modelType!=="general"&&d.modelType!=="landscape")throw new Error("Model type must be one of general or landscape, but got "+d.modelType);return d.modelUrl==null&&(d.modelType==="general"?d.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1":d.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/landscape/1"),d}(s),r=typeof i.modelUrl=="string"&&i.modelUrl.indexOf("https://tfhub.dev")>-1,[4,Bt(i.modelUrl,{fromTFHub:r})];case 1:return u=a.sent(),[2,new vs(i.modelType,u)]}})})}function ys(s,i){return W(this,void 0,void 0,function(){var r,u;return V(this,function(a){switch(s){case lt.MediaPipeSelfieSegmentation:if(r=void 0,(u=i)!=null){if(u.runtime==="tfjs")return[2,gs(u)];if(u.runtime==="mediapipe")return[2,ss(u)];r=u.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case lt.BodyPix:return[2,ns(u=i)];default:throw new Error(s+" is not a supported model name.")}})})}(function(s){s.BodyPix="BodyPix",s.MediaPipeSelfieSegmentation="MediaPipeSelfieSegmentation"})(lt||(lt={}));var ws="blurred-mask",bs="mask",xs="draw-image",wn={};function Ss(s,i,r,u){var a=s.width,f=s.height,d=i.width,m=i.height;if(a!==d||f!==m)throw new Error("error: dimensions must match. "+r+" has dimensions "+a+"x"+f+", "+u+" has dimensions "+d+"x"+m)}function zt(s){if(typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement)return function(i){if("offsetHeight"in i&&i.offsetHeight!==0&&"offsetWidth"in i&&i.offsetWidth!==0)return[i.offsetHeight,i.offsetWidth];if(i.height!=null&&i.width!=null)return[i.height,i.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(s);if(typeof ImageData<"u"&&s instanceof ImageData)return[s.height,s.width];if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement)return function(i){return i.hasAttribute("height")&&i.hasAttribute("width")?[i.height,i.width]:[i.videoHeight,i.videoWidth]}(s);if(s instanceof Te)return[s.shape[0],s.shape[1]];throw new Error("error: Unknown input type: "+s+".")}function li(s){return wn[s]||(wn[s]=function(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),wn[s]}function ci(s,i){var r=li(i);return function(u,a){a.width=u.width,a.height=u.height,a.getContext("2d").putImageData(u,0,0)}(s,r),r}function Wt(s,i,r,u,a,f){return W(this,void 0,void 0,function(){var d,m,y,v;return V(this,function(p){switch(p.label){case 0:return i instanceof Te?[4,Lt(i)]:[3,2];case 1:d=p.sent(),m=zt(i),y=m[0],v=m[1],i=new ImageData(d,v,y),p.label=2;case 2:return i instanceof ImageData&&(i=ci(i,xs)),a==null||f==null?s.drawImage(i,r,u):s.drawImage(i,r,u,a,f),[2]}})})}function As(s,i){return W(this,void 0,void 0,function(){var r,u,a;return V(this,function(f){switch(f.label){case 0:return r=zt(s),u=r[0],a=r[1],i.width=a,i.height=u,[4,Wt(i.getContext("2d"),s,0,0,a,u)];case 1:return f.sent(),[2]}})})}function _s(s,i,r){return W(this,void 0,void 0,function(){var u,a,f,d,m,y,v,p;return V(this,function(x){switch(x.label){case 0:for(u=s.getContext("2d"),a=0,f=5,d=1/(2*Math.PI*f*f),m=1,v=-r;v<=r;v+=m)for(p=-r;p<=r;p+=m)y=d*Math.exp(-(p*p+v*v)/(2*f*f)),a+=y;v=-r,x.label=1;case 1:if(!(v<=r))return[3,6];p=-r,x.label=2;case 2:return p<=r?(u.globalAlpha=d*Math.exp(-(p*p+v*v)/(2*f*f))/a*r,[4,Wt(u,i,p,v)]):[3,5];case 3:x.sent(),x.label=4;case 4:return p+=m,[3,2];case 5:return v+=m,[3,1];case 6:return u.globalAlpha=1,[2]}})})}function Es(s,i,r){return W(this,void 0,void 0,function(){var u,a,f,d;return V(this,function(m){switch(m.label){case 0:return u=zt(s),a=u[0],f=u[1],d=r.getContext("2d"),r.width=f,r.height=a,d.clearRect(0,0,f,a),d.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?[4,_s(r,s,i)]:[3,2];case 1:return m.sent(),[3,4];case 2:return d.filter="blur("+i+"px)",[4,Wt(d,s,0,0,f,a)];case 3:m.sent(),m.label=4;case 4:return d.restore(),[2]}})})}function js(s,i,r){return W(this,void 0,void 0,function(){var u;return V(this,function(a){switch(a.label){case 0:return u=li(r),[4,As(s,u)];case 1:return a.sent(),[3,4];case 2:return[4,Es(s,i,u)];case 3:a.sent(),a.label=4;case 4:return[2,u]}})})}function Ms(s,i,r,u){return r===void 0&&(r={r:0,g:0,b:0,a:255}),u===void 0&&(u=.5),W(this,void 0,void 0,function(){var a,f,d,m,y,v,p,x,w,A,S,j,O,M;return V(this,function(P){switch(P.label){case 0:return(a=Array.isArray(s)?s:[s]).length===0?[2,null]:[4,Promise.all(a.map(function(N){return N.mask.toImageData()}))];case 1:for(f=P.sent(),d=f[0],m=d.width,y=d.height,v=new Uint8ClampedArray(m*y*4),p=Math.round(255*u),x=0;x<y*m;++x)for(v[(w=4*x)+0]=r.r,v[w+1]=r.g,v[w+2]=r.b,v[w+3]=r.a,A=0,S=f;A<S.length;A++)(j=S[A]).data[w+3]>=p&&(O=j.data[w],M=i(O),v[w+0]=M.r,v[w+1]=M.g,v[w+2]=M.b,v[w+3]=M.a);return[2,new ImageData(v,m,y)]}})})}function ks(s,i,r,u,a,f){return W(this,void 0,void 0,function(){var d,m,y,v,p;return V(this,function(x){switch(x.label){case 0:return d=zt(i),m=d[0],y=d[1],s.width=y,s.height=m,(v=s.getContext("2d")).save(),[4,Wt(v,i,0,0)];case 1:return x.sent(),v.globalAlpha=u,r?(Ss({width:y,height:m},r,"image","mask"),[4,js(ci(r,bs),a,ws)]):[3,3];case 2:p=x.sent(),v.drawImage(p,0,0,y,m),x.label=3;case 3:return v.restore(),[2]}})})}var Sn={exports:{}};const Os=Kr(Io),Ps=Kr(En);/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */(function(s,i){(function(r,u){u(i,Os,Ps)})(It,function(r,u,a){const f={1:{name:"/m/01g317",id:1,displayName:"person"},2:{name:"/m/0199g",id:2,displayName:"bicycle"},3:{name:"/m/0k4j",id:3,displayName:"car"},4:{name:"/m/04_sv",id:4,displayName:"motorcycle"},5:{name:"/m/05czz6l",id:5,displayName:"airplane"},6:{name:"/m/01bjv",id:6,displayName:"bus"},7:{name:"/m/07jdr",id:7,displayName:"train"},8:{name:"/m/07r04",id:8,displayName:"truck"},9:{name:"/m/019jd",id:9,displayName:"boat"},10:{name:"/m/015qff",id:10,displayName:"traffic light"},11:{name:"/m/01pns0",id:11,displayName:"fire hydrant"},13:{name:"/m/02pv19",id:13,displayName:"stop sign"},14:{name:"/m/015qbp",id:14,displayName:"parking meter"},15:{name:"/m/0cvnqh",id:15,displayName:"bench"},16:{name:"/m/015p6",id:16,displayName:"bird"},17:{name:"/m/01yrx",id:17,displayName:"cat"},18:{name:"/m/0bt9lr",id:18,displayName:"dog"},19:{name:"/m/03k3r",id:19,displayName:"horse"},20:{name:"/m/07bgp",id:20,displayName:"sheep"},21:{name:"/m/01xq0k1",id:21,displayName:"cow"},22:{name:"/m/0bwd_0j",id:22,displayName:"elephant"},23:{name:"/m/01dws",id:23,displayName:"bear"},24:{name:"/m/0898b",id:24,displayName:"zebra"},25:{name:"/m/03bk1",id:25,displayName:"giraffe"},27:{name:"/m/01940j",id:27,displayName:"backpack"},28:{name:"/m/0hnnb",id:28,displayName:"umbrella"},31:{name:"/m/080hkjn",id:31,displayName:"handbag"},32:{name:"/m/01rkbr",id:32,displayName:"tie"},33:{name:"/m/01s55n",id:33,displayName:"suitcase"},34:{name:"/m/02wmf",id:34,displayName:"frisbee"},35:{name:"/m/071p9",id:35,displayName:"skis"},36:{name:"/m/06__v",id:36,displayName:"snowboard"},37:{name:"/m/018xm",id:37,displayName:"sports ball"},38:{name:"/m/02zt3",id:38,displayName:"kite"},39:{name:"/m/03g8mr",id:39,displayName:"baseball bat"},40:{name:"/m/03grzl",id:40,displayName:"baseball glove"},41:{name:"/m/06_fw",id:41,displayName:"skateboard"},42:{name:"/m/019w40",id:42,displayName:"surfboard"},43:{name:"/m/0dv9c",id:43,displayName:"tennis racket"},44:{name:"/m/04dr76w",id:44,displayName:"bottle"},46:{name:"/m/09tvcd",id:46,displayName:"wine glass"},47:{name:"/m/08gqpm",id:47,displayName:"cup"},48:{name:"/m/0dt3t",id:48,displayName:"fork"},49:{name:"/m/04ctx",id:49,displayName:"knife"},50:{name:"/m/0cmx8",id:50,displayName:"spoon"},51:{name:"/m/04kkgm",id:51,displayName:"bowl"},52:{name:"/m/09qck",id:52,displayName:"banana"},53:{name:"/m/014j1m",id:53,displayName:"apple"},54:{name:"/m/0l515",id:54,displayName:"sandwich"},55:{name:"/m/0cyhj_",id:55,displayName:"orange"},56:{name:"/m/0hkxq",id:56,displayName:"broccoli"},57:{name:"/m/0fj52s",id:57,displayName:"carrot"},58:{name:"/m/01b9xk",id:58,displayName:"hot dog"},59:{name:"/m/0663v",id:59,displayName:"pizza"},60:{name:"/m/0jy4k",id:60,displayName:"donut"},61:{name:"/m/0fszt",id:61,displayName:"cake"},62:{name:"/m/01mzpv",id:62,displayName:"chair"},63:{name:"/m/02crq1",id:63,displayName:"couch"},64:{name:"/m/03fp41",id:64,displayName:"potted plant"},65:{name:"/m/03ssj5",id:65,displayName:"bed"},67:{name:"/m/04bcr3",id:67,displayName:"dining table"},70:{name:"/m/09g1w",id:70,displayName:"toilet"},72:{name:"/m/07c52",id:72,displayName:"tv"},73:{name:"/m/01c648",id:73,displayName:"laptop"},74:{name:"/m/020lf",id:74,displayName:"mouse"},75:{name:"/m/0qjjc",id:75,displayName:"remote"},76:{name:"/m/01m2v",id:76,displayName:"keyboard"},77:{name:"/m/050k8",id:77,displayName:"cell phone"},78:{name:"/m/0fx9l",id:78,displayName:"microwave"},79:{name:"/m/029bxz",id:79,displayName:"oven"},80:{name:"/m/01k6s3",id:80,displayName:"toaster"},81:{name:"/m/0130jx",id:81,displayName:"sink"},82:{name:"/m/040b_t",id:82,displayName:"refrigerator"},84:{name:"/m/0bt_c3",id:84,displayName:"book"},85:{name:"/m/01x3z",id:85,displayName:"clock"},86:{name:"/m/02s195",id:86,displayName:"vase"},87:{name:"/m/01lsmm",id:87,displayName:"scissors"},88:{name:"/m/0kmg4",id:88,displayName:"teddy bear"},89:{name:"/m/03wvsk",id:89,displayName:"hair drier"},90:{name:"/m/012xff",id:90,displayName:"toothbrush"}};class d{constructor(y,v){this.modelPath=v||`https://storage.googleapis.com/tfjs-models/savedmodel/${this.getPrefix(y)}/model.json`}getPrefix(y){return y==="lite_mobilenet_v2"?`ssd${y}`:`ssd_${y}`}async load(){this.model=await u.loadGraphModel(this.modelPath);const y=a.zeros([1,300,300,3],"int32"),v=await this.model.executeAsync(y);await Promise.all(v.map(p=>p.data())),v.map(p=>p.dispose()),y.dispose()}async infer(y,v,p){const x=a.tidy(()=>(y instanceof a.Tensor||(y=a.browser.fromPixels(y)),a.expandDims(y))),w=x.shape[1],A=x.shape[2],S=await this.model.executeAsync(x),j=S[0].dataSync(),O=S[1].dataSync();x.dispose(),a.dispose(S);const[M,P]=this.calculateMaxScores(j,S[0].shape[1],S[0].shape[2]),N=a.getBackend();a.getBackend()==="webgl"&&a.setBackend("cpu");const E=a.tidy(()=>{const F=a.tensor2d(O,[S[1].shape[1],S[1].shape[3]]);return a.image.nonMaxSuppression(F,M,v,p,p)}),I=E.dataSync();return E.dispose(),N!==a.getBackend()&&a.setBackend(N),this.buildDetectedObjects(A,w,O,M,I,P)}buildDetectedObjects(y,v,p,x,w,A){const S=w.length,j=[];for(let O=0;O<S;O++){const M=[];for(let F=0;F<4;F++)M[F]=p[4*w[O]+F];const P=M[0]*v,N=M[1]*y,E=M[2]*v,I=M[3]*y;M[0]=N,M[1]=P,M[2]=I-N,M[3]=E-P,j.push({bbox:M,class:f[A[w[O]]+1].displayName,score:x[w[O]]})}return j}calculateMaxScores(y,v,p){const x=[],w=[];for(let A=0;A<v;A++){let S=Number.MIN_VALUE,j=-1;for(let O=0;O<p;O++)y[A*p+O]>S&&(S=y[A*p+O],j=O);x[A]=S,w[A]=j}return[x,w]}async detect(y,v=20,p=.5){return this.infer(y,v,p)}dispose(){this.model!=null&&this.model.dispose()}}r.ObjectDetection=d,r.load=async function(m={}){if(a==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");const y=m.base||"lite_mobilenet_v2",v=m.modelUrl;if(["mobilenet_v1","mobilenet_v2","lite_mobilenet_v2"].indexOf(y)===-1)throw new Error(`ObjectDetection constructed with invalid base model ${y}. Valid names are 'mobilenet_v1', 'mobilenet_v2' and 'lite_mobilenet_v2'.`);const p=new d(y,v);return await p.load(),p},r.version="2.2.3",Object.defineProperty(r,"__esModule",{value:!0})})})(Sn,Sn.exports);var Ts=Sn.exports;class Ns{constructor(){oe(this,"cocoSsdModel",null);oe(this,"drawCanvas",!1);oe(this,"canvasses",null);oe(this,"bodySegmenter",null);oe(this,"bodySegmentationModel",lt.BodyPix);oe(this,"bodySegmentationModelConfig",{architecture:"ResNet50",outputStride:16,quantBytes:4});oe(this,"bodySegmentationConfig",{multiSegmentation:!0,segmentBodyParts:!0,flipHorizontal:!1,internalResolution:"full",segmentationThreshold:.7,maxDetections:30,scoreThreshold:.2,nmsRadius:20,minKeypointScore:.5,refineSteps:20});oe(this,"cutouts",[]);oe(this,"getPixelData",async i=>{let r=await i.mask.toImageData();const u=r.width;r.height;const a=r.data;let f=[];for(let d=0;d<a.length;d+=4){let m={x:d/4%u,y:Math.floor(d/4/u),color:{r:a[d],g:a[d+1],b:a[d+2],a:a[d+3]}};f.push(m)}return f});oe(this,"getBoundingBoxesRaw",async i=>{let r={};for(let u in labelTable){let a=i.filter(f=>f.color.r===parseInt(u));if(a.length>0){let f=a.reduce((v,p)=>p.x<v?p.x:v,a[0].x),d=a.reduce((v,p)=>p.x>v?p.x:v,a[0].x),m=a.reduce((v,p)=>p.y<v?p.y:v,a[0].y),y=a.reduce((v,p)=>p.y>v?p.y:v,a[0].y);r[labelTable[u]]={minX:f,maxX:d,minY:m,maxY:y}}}return console.log("Raw part bounding boxes:",r),r});oe(this,"getBoundingBoxesCombinations",async i=>{let r={};for(let u in labelTableCombinations){let a=i.filter(f=>labelTableCombinations[u].includes(f.color.r));if(a.length>0){let f=a.reduce((v,p)=>p.x<v?p.x:v,a[0].x),d=a.reduce((v,p)=>p.x>v?p.x:v,a[0].x),m=a.reduce((v,p)=>p.y<v?p.y:v,a[0].y),y=a.reduce((v,p)=>p.y>v?p.y:v,a[0].y);r[u]={minX:f,maxX:d,minY:m,maxY:y,pixels:a}}}return console.log("Combinations part bounding boxes:",r),r});oe(this,"drawMaskOnCanvas",async(i,r,u)=>{const a=await Ms(i,Co,{r:255,g:255,b:255,a:0});await ks(u,r,a,1,0)});oe(this,"drawRawBoxes",async(i,r)=>{let u=document.createElement("canvas");if(!u){console.error("No img canvas");return}u.width=i.width,u.height=i.height;let a=u.getContext("2d");if(!a){console.error("No img ctx");return}a.drawImage(i,0,0,i.width,i.height),a.strokeStyle="red",a.lineWidth=2;for(let f in r){let{minX:d,maxX:m,minY:y,maxY:v}=r[f];a.strokeRect(d,y,m-d,v-y)}});oe(this,"drawCombinedBoxes",async(i,r)=>{let u=document.createElement("canvas");if(!u){console.error("No img canvas");return}u.width=i.width,u.height=i.height;let a=u.getContext("2d");if(!a){console.error("No img ctx");return}a.drawImage(i,0,0,i.width,i.height),a.strokeStyle="green",a.lineWidth=2;for(let f in r){let{minX:d,maxX:m,minY:y,maxY:v}=r[f];a.strokeRect(d,y,m-d,v-y)}});oe(this,"extractCutouts",async(i,r)=>{let u=document.createElement("canvas");if(!u){console.error("No img canvas");return}u.width=i.width,u.height=i.height;let a=u.getContext("2d");if(!a){console.error("No img ctx");return}a.drawImage(i,0,0,i.width,i.height);let f=[];for(let d in r){let{minX:m,maxX:y,minY:v,maxY:p}=r[d],x=document.createElement("canvas");x.width=y-m,x.height=p-v;let w=x.getContext("2d");if(!w){console.error("No part ctx");return}w.drawImage(i,m,v,y-m,p-v,0,0,y-m,p-v);let A={part:d,img:x.toDataURL()};f.push(A)}return console.log("cutouts",f),f});console.log("ImageProcessor constructor")}async init(){return console.log("init"),this.cocoSsdModel=await Ts.load(),console.log("cocoSsdModel loaded"),this.bodySegmenter=await ys(this.bodySegmentationModel,this.bodySegmentationModelConfig),console.log("bodySegmenter loaded"),new Promise((i,r)=>{i(!0)})}async processImage(i){console.log("processImage"),i.complete?console.log("image is loaded"):(console.log("image is not loaded"),await new Promise(f=>{i.addEventListener("load",f)})),console.log("image is now loaded");const r=await this.detectHumans(i);if(!r){console.error("No persons detected");return}const u=await this.splitCanvasIntoPersons(i,r);let a=[];for(let f=0;f<u.length;f++){let d=await this.drawMasksFromImgData(u[f]);d&&a.push(...d)}return console.log("total cutouts",a),new Promise((f,d)=>{f(a)})}async detectHumans(i){if(!this.cocoSsdModel){console.error("cocoSsdModel is not loaded");return}const r=await this.cocoSsdModel.detect(i,50,.6);console.log("predictions",r);const u=r.filter(a=>a.class==="person");return this.drawCanvas&&this.drawBoundingBoxesFromObjectDetection(i,r),new Promise((a,f)=>{a(u)})}async drawBoundingBoxesFromObjectDetection(i,r){let u=document.createElement("canvas");u.width=i.width,u.height=i.height;let a=u.getContext("2d");if(!a){console.error("ctx is null");return}a.drawImage(i,0,0,i.width,i.height),r.forEach(f=>{const{bbox:d}=f,[m,y,v,p]=d;a.beginPath(),a.rect(m,y,v,p),f.class==="person"?a.strokeStyle="green":a.strokeStyle="red",a.lineWidth=2,a.stroke(),a.beginPath(),a.measureText(f.class).width,a.rect(m,y-20,v,20),a.fillStyle="black",a.fill(),a.font="16px Arial",a.fillStyle="white",a.fillText(`${f.class} (${Math.round(f.score*100)}%)`,m,y-10),a.fillStyle="black",a.fill(),a.font="16px Arial",a.fillStyle="white",a.fillText(`${f.class} (${Math.round(f.score*100)}%)`,m,y-10)})}async splitCanvasIntoPersons(i,r){const u=[];return r.forEach((a,f)=>{let d=document.createElement("canvas");d.width=a.bbox[2],d.height=a.bbox[3];let m=d.getContext("2d");if(!m){console.error("No ctx");return}m.drawImage(i,a.bbox[0],a.bbox[1],a.bbox[2],a.bbox[3],0,0,a.bbox[2],a.bbox[3]),u.push(d.toDataURL())}),new Promise((a,f)=>{a(u)})}async getSegmentationFromImage(i){if(!this.bodySegmenter){console.error("bodySegmenter is not loaded");return}const r=await this.bodySegmenter.segmentPeople(i,this.bodySegmentationConfig);return console.log("segmentation",r),new Promise((u,a)=>{u(r)})}async drawMasksFromImgData(i){const r=new Image;r.src=i,await new Promise(f=>{r.onload=f});const u=await this.getSegmentationFromImage(r);if(!u){console.error("No segmentation");return}let a=[];for(let f=0;f<u.length;f++){const d=u[f];let m=await this.getPixelData(d);await this.getBoundingBoxesRaw(m);let y=await this.getBoundingBoxesCombinations(m),v=document.createElement("canvas");v.width=r.width,v.height=r.height;let p=await this.extractCutouts(r,y);p&&a.push(...p)}return console.log("cutouts",a),this.cutouts.push(...a),new Promise((f,d)=>{f(a)})}}const Fs=je("h1",null,"Pool Manager",-1),Is={class:"manager"},Rs={key:0,class:"manager-images"},Cs={key:0,class:"manager-image"},Bs={class:"masks"},Ds=["hint","onClick"],Ls={class:"mask-img"},Us=["src"],Hs={key:1},zs=je("div",{class:"actions"},null,-1),Ws=je("br",null,null,-1),$s=Eo({__name:"PoolManager",setup(s){new Ns;const i=jo(),r=At([]);Mo(async()=>{console.log("page",i.props.baseImages),i.props.baseImages&&(r.value=i.props.baseImages.map(m=>({baseImage:m,isProcessed:!1,isUploaded:!1,cutouts:[]})))}),At([]);const u=m=>{let y=!m.included;No.patch(route("maskimage.setincluded"),{id:m.id,included:y}).then(()=>{m.included=y}).catch(()=>{console.error("Failed to update included status")})},a=At(10),f=At(!0),d=()=>{var m;a.value+=10,(m=i.props.baseImages)!=null&&m.length&&a.value>i.props.baseImages.length&&(a.value=i.props.baseImages.length,f.value=!1)};return(m,y)=>(Ee(),ko(so,null,{default:Oo(()=>{var v;return[je("div",null,[Fs,je("span",null,"Total "+hn(((v=dn(i).props.baseImages)==null?void 0:v.length)??0)+" base images / Loaded "+hn(a.value),1)]),je("div",Is,[dn(i).props.baseImages?(Ee(),Pe("div",Rs,[(Ee(!0),Pe(_t,null,_r(dn(i).props.baseImages,(p,x)=>(Ee(),Pe(_t,{key:p.id},[x<a.value?(Ee(),Pe("div",Cs,[p.processed?(Ee(),Pe(_t,{key:0},[Po(ao,{baseImage:p,onDeleted:w=>(m.$page.props.baseImages??[]).splice(x,1)},null,8,["baseImage","onDeleted"]),je("div",Bs,[p.mask_images?(Ee(!0),Pe(_t,{key:0},_r(p.mask_images,w=>(Ee(),Pe("div",{key:w.id+w.label,class:To(["mask",{included:w.included}]),hint:`${w.included?"Included":"Not Included"}`,onClick:A=>u(w)},[je("div",Ls,[je("img",{src:w.path,alt:"mask.title"},null,8,Us)]),je("span",null,hn(w.label),1)],10,Ds))),128)):(Ee(),Pe("strong",Hs,"No masks for this base image"))]),zs],64)):Et("",!0)])):Et("",!0)],64))),128))])):Et("",!0),Ws,f.value?(Ee(),Pe("button",{key:1,onClick:d},"Load more")):Et("",!0)])]}),_:1}))}});export{$s as default};
