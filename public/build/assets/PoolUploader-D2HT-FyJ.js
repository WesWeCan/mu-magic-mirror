import{d as T,l as d,o as i,c as V,w as E,b as l,t as k,g as r,h as p,j as v,G as _,s as F,F as y,A as L,p as A}from"./app-CF6YtaFa.js";import{_ as B}from"./PoolLayout.vue_vue_type_script_setup_true_lang-B7YuJLqs.js";const D={class:"upload-form"},N=l("h1",null,"Upload New Batch",-1),$=l("span",null,"Select multiple images for upload",-1),P={class:"upload-preview"},G={key:0},I={key:1,class:"macro-actions"},R={class:"macro-action"},H=l("label",null,"Give all images the same title:",-1),S={class:"macro-action"},j=l("label",null,"Give all images the same link:",-1),M={class:"preview-images"},q={class:"preview"},z=["src"],J={class:"details"},K=l("label",null,"Title",-1),O=["onUpdate:modelValue"],Q=l("label",null,"Link",-1),W=["onUpdate:modelValue"],X={key:0,class:"error"},Y={class:"actions"},Z=["onClick"],ee=["onClick"],ae=T({__name:"PoolUploader",setup(le){const o=d([]),b=a=>{const s=a.target.files;if(s)for(let e=0;e<s.length;e++){const t=s[e],n=new FileReader;n.onload=f=>{var u;o.value.push({url:(u=f.target)==null?void 0:u.result,fileName:t.name,extension:t.name.split(".").pop()??"",title:"",link:"",uploaded:!1})},n.readAsDataURL(t)}},h=d(""),C=()=>{o.value.forEach(a=>{a.title=h.value})},m=d(""),U=()=>{o.value.forEach(a=>{a.link=m.value})},c=d(!1),g=a=>new Promise(async(s,e)=>{try{const t=new FormData,f=await(await fetch(a.url)).blob(),u=new File([f],`${a.fileName}`,{type:`image/${a.extension}`});t.append("image",u),t.append("title",a.title),t.append("link",a.link),await L.post(route("pool.base.upload"),t,{headers:{"Content-Type":"multipart/form-data"}}),o.value=o.value.filter(x=>x.url!==a.url),s()}catch(t){console.error(t),a.error=t.response.data.message,e(t.response.data.message)}}),w=async()=>{var s;c.value=!0;for(let e=0;e<o.value.length;e++){if(o.value[e].uploaded){console.log("already uploaded");continue}if((s=o.value[e])!=null&&s.error){console.log("has a error");continue}try{await g(o.value[e])}catch(t){console.error(t),o.value[e].error=t}await new Promise(t=>setTimeout(t,100))}c.value=!1,o.value.every(e=>e.error)||A(()=>{w()})};return(a,s)=>(i(),V(B,null,{default:E(()=>[l("div",D,[N,$,l("input",{type:"file",multiple:"",onChange:b},null,32)]),l("div",P,[l("h2",null,"Preview ("+k(o.value.length)+" "+k(c.value?"images left to upload":"images loaded")+")",1),c.value?(i(),r("h3",G,"Uploading...")):p("",!0),o.value.length?(i(),r("div",I,[l("div",R,[H,v(l("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e)},null,512),[[_,h.value]]),l("button",{onClick:C},"Change all titles")]),l("div",S,[j,v(l("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=e=>m.value=e)},null,512),[[_,m.value]]),l("button",{onClick:U},"Change all links")]),l("div",{class:"macro-action"},[l("button",{class:"success",onClick:w},"Upload all")])])):p("",!0),l("div",M,[(i(!0),r(y,null,F(o.value,(e,t)=>(i(),r("div",{class:"preview-image",key:t},[e.uploaded?p("",!0):(i(),r(y,{key:0},[l("div",q,[l("img",{src:e.url,alt:"preview"},null,8,z)]),l("div",J,[K,v(l("input",{type:"text","onUpdate:modelValue":n=>e.title=n,placeholder:"Title"},null,8,O),[[_,e.title]]),Q,v(l("input",{type:"text","onUpdate:modelValue":n=>e.link=n,placeholder:"link"},null,8,W),[[_,e.link]]),e.error?(i(),r("div",X,"Error: "+k(e.error),1)):p("",!0),l("div",Y,[l("button",{class:"danger",onClick:n=>o.value.splice(t,1)},"Remove",8,Z),l("button",{class:"success",onClick:n=>g(e)},"Upload",8,ee)])])],64))]))),128))])])]),_:1}))}});export{ae as default};
