import{d2 as J,dc as Fe,b as ne,d7 as Dt,d3 as Vt,d8 as _t,db as hn,dh as dn,dk as Ki,cY as pn,c_ as Mt,c$ as _e,dw as Pr,df as Yi,d4 as Xi,d5 as Qi,dd as mn,d1 as Zi,d9 as re,dx as Rr,dy as kr,da as Pe,de as vn,dq as $i,dz as Ji,dA as qi,dn as ie,d as Ir,dB as Br,dC as to,dD as eo,dg as no,cZ as ro}from"./register_all_kernels-VAx2wV-G.js";import{y as nn}from"./app-DGkwBVRO.js";var io={};(function(){var i;function s(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var o=typeof Object.defineProperties=="function"?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};function l(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof nn=="object"&&nn];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}var c=l(this);function h(t,e){if(e)t:{var n=c;t=t.split(".");for(var r=0;r<t.length-1;r++){var u=t[r];if(!(u in n))break t;n=n[u]}t=t[t.length-1],r=n[t],e=e(r),e!=r&&e!=null&&o(n,t,{configurable:!0,writable:!0,value:e})}}h("Symbol",function(t){function e(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new n(r+(f||"")+"_"+u++,f)}function n(f,a){this.h=f,o(this,"description",{configurable:!0,writable:!0,value:a})}if(t)return t;n.prototype.toString=function(){return this.h};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",u=0;return e}),h("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<e.length;n++){var r=c[e[n]];typeof r=="function"&&typeof r.prototype[t]!="function"&&o(r.prototype,t,{configurable:!0,writable:!0,value:function(){return p(s(this))}})}return t});function p(t){return t={next:t},t[Symbol.iterator]=function(){return this},t}function m(t){var e=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:s(t)}}function b(t){if(!(t instanceof Array)){t=m(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}var y=typeof Object.assign=="function"?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t};h("Object.assign",function(t){return t||y});var v=typeof Object.create=="function"?Object.create:function(t){function e(){}return e.prototype=t,new e},x;if(typeof Object.setPrototypeOf=="function")x=Object.setPrototypeOf;else{var w;t:{var A={a:!0},S={};try{S.__proto__=A,w=S.a;break t}catch{}w=!1}x=w?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var M=x;function R(t,e){if(t.prototype=v(e.prototype),t.prototype.constructor=t,M)M(t,e);else for(var n in e)if(n!="prototype")if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(e,n);r&&Object.defineProperty(t,n,r)}else t[n]=e[n];t.za=e.prototype}function _(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function F(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}_.prototype.u=function(t){this.i=t};function P(t,e){t.l={ma:e,na:!0},t.h=t.s||t.v}_.prototype.return=function(t){this.l={return:t},this.h=this.v};function O(t,e,n){return t.h=n,{value:e}}function I(t){this.h=new _,this.i=t}function U(t,e){F(t.h);var n=t.h.j;return n?C(t,"return"in n?n.return:function(r){return{value:r,done:!0}},e,t.h.return):(t.h.return(e),D(t))}function C(t,e,n,r){try{var u=e.call(t.h.j,n);if(!(u instanceof Object))throw new TypeError("Iterator result "+u+" is not an object");if(!u.done)return t.h.m=!1,u;var f=u.value}catch(a){return t.h.j=null,P(t.h,a),D(t)}return t.h.j=null,r.call(t.h,f),D(t)}function D(t){for(;t.h.h;)try{var e=t.i(t.h);if(e)return t.h.m=!1,{value:e.value,done:!1}}catch(n){t.h.i=void 0,P(t.h,n)}if(t.h.m=!1,t.h.l){if(e=t.h.l,t.h.l=null,e.na)throw e.ma;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function z(t){this.next=function(e){return F(t.h),t.h.j?e=C(t,t.h.j.next,e,t.h.u):(t.h.u(e),e=D(t)),e},this.throw=function(e){return F(t.h),t.h.j?e=C(t,t.h.j.throw,e,t.h.u):(P(t.h,e),e=D(t)),e},this.return=function(e){return U(t,e)},this[Symbol.iterator]=function(){return this}}function G(t){function e(r){return t.next(r)}function n(r){return t.throw(r)}return new Promise(function(r,u){function f(a){a.done?r(a.value):Promise.resolve(a.value).then(e,n).then(f,u)}f(t.next())})}function B(t){return G(new z(new I(t)))}h("Promise",function(t){function e(a){this.i=0,this.j=void 0,this.h=[],this.u=!1;var d=this.l();try{a(d.resolve,d.reject)}catch(g){d.reject(g)}}function n(){this.h=null}function r(a){return a instanceof e?a:new e(function(d){d(a)})}if(t)return t;n.prototype.i=function(a){if(this.h==null){this.h=[];var d=this;this.j(function(){d.m()})}this.h.push(a)};var u=c.setTimeout;n.prototype.j=function(a){u(a,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var a=this.h;this.h=[];for(var d=0;d<a.length;++d){var g=a[d];a[d]=null;try{g()}catch(E){this.l(E)}}}this.h=null},n.prototype.l=function(a){this.j(function(){throw a})},e.prototype.l=function(){function a(E){return function(j){g||(g=!0,E.call(d,j))}}var d=this,g=!1;return{resolve:a(this.I),reject:a(this.m)}},e.prototype.I=function(a){if(a===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.L(a);else{t:switch(typeof a){case"object":var d=a!=null;break t;case"function":d=!0;break t;default:d=!1}d?this.F(a):this.s(a)}},e.prototype.F=function(a){var d=void 0;try{d=a.then}catch(g){this.m(g);return}typeof d=="function"?this.M(d,a):this.s(a)},e.prototype.m=function(a){this.v(2,a)},e.prototype.s=function(a){this.v(1,a)},e.prototype.v=function(a,d){if(this.i!=0)throw Error("Cannot settle("+a+", "+d+"): Promise already settled in state"+this.i);this.i=a,this.j=d,this.i===2&&this.K(),this.H()},e.prototype.K=function(){var a=this;u(function(){if(a.D()){var d=c.console;typeof d<"u"&&d.error(a.j)}},1)},e.prototype.D=function(){if(this.u)return!1;var a=c.CustomEvent,d=c.Event,g=c.dispatchEvent;return typeof g>"u"?!0:(typeof a=="function"?a=new a("unhandledrejection",{cancelable:!0}):typeof d=="function"?a=new d("unhandledrejection",{cancelable:!0}):(a=c.document.createEvent("CustomEvent"),a.initCustomEvent("unhandledrejection",!1,!0,a)),a.promise=this,a.reason=this.j,g(a))},e.prototype.H=function(){if(this.h!=null){for(var a=0;a<this.h.length;++a)f.i(this.h[a]);this.h=null}};var f=new n;return e.prototype.L=function(a){var d=this.l();a.T(d.resolve,d.reject)},e.prototype.M=function(a,d){var g=this.l();try{a.call(d,g.resolve,g.reject)}catch(E){g.reject(E)}},e.prototype.then=function(a,d){function g(k,T){return typeof k=="function"?function(L){try{E(k(L))}catch(N){j(N)}}:T}var E,j,H=new e(function(k,T){E=k,j=T});return this.T(g(a,E),g(d,j)),H},e.prototype.catch=function(a){return this.then(void 0,a)},e.prototype.T=function(a,d){function g(){switch(E.i){case 1:a(E.j);break;case 2:d(E.j);break;default:throw Error("Unexpected state: "+E.i)}}var E=this;this.h==null?f.i(g):this.h.push(g),this.u=!0},e.resolve=r,e.reject=function(a){return new e(function(d,g){g(a)})},e.race=function(a){return new e(function(d,g){for(var E=m(a),j=E.next();!j.done;j=E.next())r(j.value).T(d,g)})},e.all=function(a){var d=m(a),g=d.next();return g.done?r([]):new e(function(E,j){function H(L){return function(N){k[L]=N,T--,T==0&&E(k)}}var k=[],T=0;do k.push(void 0),T++,r(g.value).T(H(k.length-1),j),g=d.next();while(!g.done)})},e});function $(t,e){t instanceof String&&(t+="");var n=0,r=!1,u={next:function(){if(!r&&n<t.length){var f=n++;return{value:e(f,t[f]),done:!1}}return r=!0,{done:!0,value:void 0}}};return u[Symbol.iterator]=function(){return u},u}h("Array.prototype.keys",function(t){return t||function(){return $(this,function(e){return e})}}),h("Array.prototype.fill",function(t){return t||function(e,n,r){var u=this.length||0;for(0>n&&(n=Math.max(0,u+n)),(r==null||r>u)&&(r=u),r=Number(r),0>r&&(r=Math.max(0,u+r)),n=Number(n||0);n<r;n++)this[n]=e;return this}});function Y(t){return t||Array.prototype.fill}h("Int8Array.prototype.fill",Y),h("Uint8Array.prototype.fill",Y),h("Uint8ClampedArray.prototype.fill",Y),h("Int16Array.prototype.fill",Y),h("Uint16Array.prototype.fill",Y),h("Int32Array.prototype.fill",Y),h("Uint32Array.prototype.fill",Y),h("Float32Array.prototype.fill",Y),h("Float64Array.prototype.fill",Y),h("Object.is",function(t){return t||function(e,n){return e===n?e!==0||1/e===1/n:e!==e&&n!==n}}),h("Array.prototype.includes",function(t){return t||function(e,n){var r=this;r instanceof String&&(r=String(r));var u=r.length;for(n=n||0,0>n&&(n=Math.max(n+u,0));n<u;n++){var f=r[n];if(f===e||Object.is(f,e))return!0}return!1}}),h("String.prototype.includes",function(t){return t||function(e,n){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(e,n||0)!==-1}});var tt=this||self;function et(t,e){t=t.split(".");var n=tt;t[0]in n||typeof n.execScript>"u"||n.execScript("var "+t[0]);for(var r;t.length&&(r=t.shift());)t.length||e===void 0?n[r]&&n[r]!==Object.prototype[r]?n=n[r]:n=n[r]={}:n[r]=e}function nt(t){var e;t:{if((e=tt.navigator)&&(e=e.userAgent))break t;e=""}return e.indexOf(t)!=-1}var ut=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),u=typeof t=="string"?t.split(""):t,f=0;f<n;f++)f in u&&(r[f]=e.call(void 0,u[f],f,t));return r},mt={},lt=null;function Pt(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);var r=new Uint8Array(n),u=0;return Rt(t,function(f){r[u++]=f}),u!==n?r.subarray(0,u):r}function Rt(t,e){function n(g){for(;r<t.length;){var E=t.charAt(r++),j=lt[E];if(j!=null)return j;if(!/^[\s\xa0]*$/.test(E))throw Error("Unknown base64 encoding at char: "+E)}return g}Et();for(var r=0;;){var u=n(-1),f=n(0),a=n(64),d=n(64);if(d===64&&u===-1)break;e(u<<2|f>>4),a!=64&&(e(f<<4&240|a>>2),d!=64&&e(a<<6&192|d))}}function Et(){if(!lt){lt={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=t.concat(e[n].split(""));mt[n]=r;for(var u=0;u<r.length;u++){var f=r[u];lt[f]===void 0&&(lt[f]=u)}}}}var ct=typeof Uint8Array<"u",ht=!(nt("Trident")||nt("MSIE"))&&typeof tt.btoa=="function";function vt(t){if(!ht){var e;e===void 0&&(e=0),Et(),e=mt[e];for(var n=Array(Math.floor(t.length/3)),r=e[64]||"",u=0,f=0;u<t.length-2;u+=3){var a=t[u],d=t[u+1],g=t[u+2],E=e[a>>2];a=e[(a&3)<<4|d>>4],d=e[(d&15)<<2|g>>6],g=e[g&63],n[f++]=E+a+d+g}switch(E=0,g=r,t.length-u){case 2:E=t[u+1],g=e[(E&15)<<2]||r;case 1:t=t[u],n[f]=e[t>>2]+e[(t&3)<<4|E>>4]+g+r}return n.join("")}for(e="";10240<t.length;)e+=String.fromCharCode.apply(null,t.subarray(0,10240)),t=t.subarray(10240);return e+=String.fromCharCode.apply(null,t),btoa(e)}var dt=RegExp("[-_.]","g");function Ot(t){switch(t){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function Tt(t){if(!ht)return Pt(t);dt.test(t)&&(t=t.replace(dt,Ot)),t=atob(t);for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}var kt;function Ct(){return kt||(kt=new Uint8Array(0))}var It={},qr=typeof Uint8Array.prototype.slice=="function",q=0,st=0;function wn(t){var e=0>t;t=Math.abs(t);var n=t>>>0;t=Math.floor((t-n)/4294967296),e&&(n=m(bn(n,t)),e=n.next().value,t=n.next().value,n=e),q=n>>>0,st=t>>>0}var ti=typeof BigInt=="function";function bn(t,e){return e=~e,t?t=~t+1:e+=1,[t,e]}function xn(t,e){this.i=t>>>0,this.h=e>>>0}function Sn(t){if(!t)return An||(An=new xn(0,0));if(!/^-?\d+$/.test(t))return null;if(16>t.length)wn(Number(t));else if(ti)t=BigInt(t),q=Number(t&BigInt(4294967295))>>>0,st=Number(t>>BigInt(32)&BigInt(4294967295));else{var e=+(t[0]==="-");st=q=0;for(var n=t.length,r=e,u=(n-e)%6+e;u<=n;r=u,u+=6)r=Number(t.slice(r,u)),st*=1e6,q=1e6*q+r,4294967296<=q&&(st+=q/4294967296|0,q%=4294967296);e&&(e=m(bn(q,st)),t=e.next().value,e=e.next().value,q=t,st=e)}return new xn(q,st)}var An;function En(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function Be(){return Error("Failed to read varint, encoding is invalid.")}function On(t,e){return Error("Tried to read past the end of the data "+e+" > "+t)}function Bt(){throw Error("Invalid UTF8")}function jn(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}var se=void 0,Ue,ei=typeof TextDecoder<"u",Mn,ni=typeof TextEncoder<"u",Tn;function Fn(t){if(t!==It)throw Error("illegal external caller")}function Gt(t,e){if(Fn(e),this.V=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}function He(){return Tn||(Tn=new Gt(null,It))}function _n(t){Fn(It);var e=t.V;return e=e==null||ct&&e!=null&&e instanceof Uint8Array?e:typeof e=="string"?Tt(e):null,e==null?e:t.V=e}function ri(t){if(typeof t=="string")return{buffer:Tt(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Gt)return{buffer:_n(t)||Ct(),C:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Pn(t,e){this.i=null,this.m=!1,this.h=this.j=this.l=0,Le(this,t,e)}function Le(t,e,n){n=n===void 0?{}:n,t.S=n.S===void 0?!1:n.S,e&&(e=ri(e),t.i=e.buffer,t.m=e.C,t.l=0,t.j=t.i.length,t.h=t.l)}Pn.prototype.reset=function(){this.h=this.l};function Ut(t,e){if(t.h=e,e>t.j)throw On(t.j,e)}function Kt(t){var e=t.i,n=t.h,r=e[n++],u=r&127;if(r&128&&(r=e[n++],u|=(r&127)<<7,r&128&&(r=e[n++],u|=(r&127)<<14,r&128&&(r=e[n++],u|=(r&127)<<21,r&128&&(r=e[n++],u|=r<<28,r&128&&e[n++]&128&&e[n++]&128&&e[n++]&128&&e[n++]&128&&e[n++]&128)))))throw Be();return Ut(t,n),u}function Rn(t,e){if(0>e)throw Error("Tried to read a negative byte length: "+e);var n=t.h,r=n+e;if(r>t.j)throw On(e,t.j-n);return t.h=r,n}var kn=[];function De(){this.h=[]}De.prototype.length=function(){return this.h.length},De.prototype.end=function(){var t=this.h;return this.h=[],t};function In(t,e,n){for(;0<n||127<e;)t.h.push(e&127|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.h.push(e)}function Ht(t,e){for(;127<e;)t.h.push(e&127|128),e>>>=7;t.h.push(e)}function Ce(t,e){if(kn.length){var n=kn.pop();Le(n,t,e),t=n}else t=new Pn(t,e);this.h=t,this.j=this.h.h,this.i=this.l=-1,this.setOptions(e)}Ce.prototype.setOptions=function(t){t=t===void 0?{}:t,this.ca=t.ca===void 0?!1:t.ca},Ce.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Bn(t){var e=t.h;if(e.h==e.j)return!1;t.j=t.h.h;var n=Kt(t.h)>>>0;if(e=n>>>3,n&=7,!(0<=n&&5>=n))throw En(n,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.l=e,t.i=n,!0}function ue(t){switch(t.i){case 0:if(t.i!=0)ue(t);else t:{t=t.h;for(var e=t.h,n=e+10,r=t.i;e<n;)if(!(r[e++]&128)){Ut(t,e);break t}throw Be()}break;case 1:t=t.h,Ut(t,t.h+8);break;case 2:t.i!=2?ue(t):(e=Kt(t.h)>>>0,t=t.h,Ut(t,t.h+e));break;case 5:t=t.h,Ut(t,t.h+4);break;case 3:e=t.l;do{if(!Bn(t))throw Error("Unmatched start-group tag: stream EOF");if(t.i==4){if(t.l!=e)throw Error("Unmatched end-group tag");break}ue(t)}while(!0);break;default:throw En(t.i,t.j)}}var ae=[];function ii(){this.j=[],this.i=0,this.h=new De}function Nt(t,e){e.length!==0&&(t.j.push(e),t.i+=e.length)}function oi(t,e){if(e=e.R){Nt(t,t.h.end());for(var n=0;n<e.length;n++)Nt(t,_n(e[n])||Ct())}}var jt=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Lt(t,e){return jt?t[jt]|=e:t.A!==void 0?t.A|=e:(Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}}),e)}function Un(t,e){jt?t[jt]&&(t[jt]&=~e):t.A!==void 0&&(t.A&=~e)}function Z(t){var e;return jt?e=t[jt]:e=t.A,e??0}function bt(t,e){jt?t[jt]=e:t.A!==void 0?t.A=e:Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}})}function Ne(t){return Lt(t,1),t}function si(t,e){bt(e,(t|0)&-51)}function fe(t,e){bt(e,(t|18)&-41)}var ze={};function le(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}var Yt,Hn=[];bt(Hn,23),Yt=Object.freeze(Hn);function We(t){if(Z(t.o)&2)throw Error("Cannot mutate an immutable Message")}function Ve(t){var e=t.length;(e=e?t[e-1]:void 0)&&le(e)?e.g=1:(e={},t.push((e.g=1,e)))}function Ln(t){var e=t.i+t.G;return t.B||(t.B=t.o[e]={})}function gt(t,e){return e===-1?null:e>=t.i?t.B?t.B[e]:void 0:t.o[e+t.G]}function xt(t,e,n,r){We(t),Xt(t,e,n,r)}function Xt(t,e,n,r){t.j&&(t.j=void 0),e>=t.i||r?Ln(t)[e]=n:(t.o[e+t.G]=n,(t=t.B)&&e in t&&delete t[e])}function Ge(t,e,n,r){var u=gt(t,e);Array.isArray(u)||(u=Yt);var f=Z(u);if(f&1||Ne(u),r)f&2||Lt(u,2),n&1||Object.freeze(u);else{r=!(n&2);var a=f&2;n&1||!a?r&&f&16&&!a&&Un(u,16):(u=Ne(Array.prototype.slice.call(u)),Xt(t,e,u))}return u}function Ke(t,e){var n=gt(t,e),r=n==null?n:typeof n=="number"||n==="NaN"||n==="Infinity"||n==="-Infinity"?Number(n):void 0;return r!=null&&r!==n&&Xt(t,e,r),r}function Dn(t,e,n,r,u){t.h||(t.h={});var f=t.h[n],a=Ge(t,n,3,u);if(!f){var d=a;f=[];var g=!!(Z(t.o)&16);a=!!(Z(d)&2);var E=d;!u&&a&&(d=Array.prototype.slice.call(d));for(var j=a,H=0;H<d.length;H++){var k=d[H],T=e,L=!1;if(L=L===void 0?!1:L,k=Array.isArray(k)?new T(k):L?new T:void 0,k!==void 0){T=k.o;var N=L=Z(T);a&&(N|=2),g&&(N|=16),N!=L&&bt(T,N),T=N,j=j||!!(2&T),f.push(k)}}return t.h[n]=f,g=Z(d),e=g|33,e=j?e&-9:e|8,g!=e&&(j=d,Object.isFrozen(j)&&(j=Array.prototype.slice.call(j)),bt(j,e),d=j),E!==d&&Xt(t,n,d),(u||r&&a)&&Lt(f,2),r&&Object.freeze(f),f}return u||(u=Object.isFrozen(f),r&&!u?Object.freeze(f):!r&&u&&(f=Array.prototype.slice.call(f),t.h[n]=f)),f}function Ye(t,e,n){var r=!!(Z(t.o)&2);if(e=Dn(t,e,n,r,r),t=Ge(t,n,3,r),!(r||Z(t)&8)){for(r=0;r<e.length;r++){if(n=e[r],Z(n.o)&2){var u=Gn(n,!1);u.j=n}else u=n;n!==u&&(e[r]=u,t[r]=u.o)}Lt(t,8)}return e}function St(t,e,n){if(n!=null&&typeof n!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);xt(t,e,n)}function Cn(t,e,n,r,u){We(t);var f=Dn(t,n,e,!1,!1);return n=r??new n,t=Ge(t,e,2,!1),u!=null?(f.splice(u,0,n),t.splice(u,0,n.o)):(f.push(n),t.push(n.o)),n.C()&&Un(t,8),n}function ce(t,e){return t??e}function At(t,e,n){return n=n===void 0?0:n,ce(Ke(t,e),n)}var he;function ui(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t)if(Array.isArray(t)){if(Z(t)&128)return t=Array.prototype.slice.call(t),Ve(t),t}else{if(ct&&t!=null&&t instanceof Uint8Array)return vt(t);if(t instanceof Gt){var e=t.V;return e==null?"":typeof e=="string"?e:t.V=vt(e)}}}return t}function Nn(t,e,n,r){if(t!=null){if(Array.isArray(t))t=Xe(t,e,n,r!==void 0);else if(le(t)){var u={},f;for(f in t)u[f]=Nn(t[f],e,n,r);t=u}else t=e(t,r);return t}}function Xe(t,e,n,r){var u=Z(t);r=r?!!(u&16):void 0,t=Array.prototype.slice.call(t);for(var f=0;f<t.length;f++)t[f]=Nn(t[f],e,n,r);return n(u,t),t}function ai(t){return t.ja===ze?t.toJSON():ui(t)}function fi(t,e){t&128&&Ve(e)}function zn(t,e,n){if(n=n===void 0?fe:n,t!=null){if(ct&&t instanceof Uint8Array)return t.length?new Gt(new Uint8Array(t),It):He();if(Array.isArray(t)){var r=Z(t);return r&2?t:e&&!(r&32)&&(r&16||r===0)?(bt(t,r|2),t):(t=Xe(t,zn,r&4?fe:n,!0),e=Z(t),e&4&&e&2&&Object.freeze(t),t)}return t.ja===ze?Vn(t):t}}function Wn(t,e,n,r,u,f,a){if(t=t.h&&t.h[n]){if(r=Z(t),r&2?r=t:(f=ut(t,Vn),fe(r,f),Object.freeze(f),r=f),We(e),a=r==null?Yt:Ne([]),r!=null){for(f=!!r.length,t=0;t<r.length;t++){var d=r[t];f=f&&!(Z(d.o)&2),a[t]=d.o}f=(f?8:0)|1,t=Z(a),(t&f)!==f&&(Object.isFrozen(a)&&(a=Array.prototype.slice.call(a)),bt(a,t|f)),e.h||(e.h={}),e.h[n]=r}else e.h&&(e.h[n]=void 0);Xt(e,n,a,u)}else xt(e,n,zn(r,f,a),u)}function Vn(t){return Z(t.o)&2||(t=Gn(t,!0),Lt(t.o,2)),t}function Gn(t,e){var n=t.o,r=[];Lt(r,16);var u=t.constructor.h;if(u&&r.push(u),u=t.B,u){r.length=n.length,r.fill(void 0,r.length,n.length);var f={};r[r.length-1]=f}Z(n)&128&&Ve(r),e=e||t.C()?fe:si,f=t.constructor,he=r,r=new f(r),he=void 0,t.R&&(r.R=t.R.slice()),f=!!(Z(n)&16);for(var a=u?n.length-1:n.length,d=0;d<a;d++)Wn(t,r,d-t.G,n[d],!1,f,e);if(u)for(var g in u)Wn(t,r,+g,u[g],!0,f,e);return r}function at(t,e,n){t==null&&(t=he),he=void 0;var r=this.constructor.i||0,u=0<r,f=this.constructor.h,a=!1;if(t==null){t=f?[f]:[];var d=48,g=!0;u&&(r=0,d|=128),bt(t,d)}else{if(!Array.isArray(t)||f&&f!==t[0])throw Error();var E=d=Lt(t,0);if((g=(16&E)!==0)&&((a=(32&E)!==0)||(E|=32)),u){if(128&E)r=0;else if(0<t.length){var j=t[t.length-1];if(le(j)&&"g"in j){r=0,E|=128,delete j.g;var H=!0,k;for(k in j){H=!1;break}H&&t.pop()}}}else if(128&E)throw Error();d!==E&&bt(t,E)}this.G=(f?0:-1)-r,this.h=void 0,this.o=t;t:{if(f=this.o.length,r=f-1,f&&(f=this.o[r],le(f))){this.B=f,this.i=r-this.G;break t}e!==void 0&&-1<e?(this.i=Math.max(e,r+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!u&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n){e=g&&!a&&!0,u=this.i;var T;for(g=0;g<n.length;g++)a=n[g],a<u?(a+=this.G,(r=t[a])?Kn(r,e):t[a]=Yt):(T||(T=Ln(this)),(r=T[a])?Kn(r,e):T[a]=Yt)}}at.prototype.toJSON=function(){return Xe(this.o,ai,fi)},at.prototype.C=function(){return!!(Z(this.o)&2)};function Kn(t,e){if(Array.isArray(t)){var n=Z(t),r=1;!e||n&2||(r|=16),(n&r)!==r&&bt(t,n|r)}}at.prototype.ja=ze,at.prototype.toString=function(){return this.o.toString()};function Yn(t,e,n){if(n){var r={},u;for(u in n){var f=n[u],a=f.ra;a||(r.J=f.xa||f.oa.W,f.ia?(r.aa=Jn(f.ia),a=function(d){return function(g,E,j){return d.J(g,E,j,d.aa)}}(r)):f.ka?(r.Z=qn(f.da.P,f.ka),a=function(d){return function(g,E,j){return d.J(g,E,j,d.Z)}}(r)):a=r.J,f.ra=a),a(e,t,f.da),r={J:r.J,aa:r.aa,Z:r.Z}}}oi(e,t)}var de=Symbol();function Xn(t,e,n){return t[de]||(t[de]=function(r,u){return e(r,u,n)})}function Qn(t){var e=t[de];if(!e){var n=Ze(t);e=function(r,u){return tr(r,u,n)},t[de]=e}return e}function li(t){var e=t.ia;if(e)return Qn(e);if(e=t.wa)return Xn(t.da.P,e,t.ka)}function ci(t){var e=li(t),n=t.da,r=t.oa.U;return e?function(u,f){return r(u,f,n,e)}:function(u,f){return r(u,f,n)}}function Zn(t,e){var n=t[e];return typeof n=="function"&&n.length===0&&(n=n(),t[e]=n),Array.isArray(n)&&(Zt in n||Qt in n||0<n.length&&typeof n[0]=="function")?n:void 0}function $n(t,e,n,r,u,f){e.P=t[0];var a=1;if(t.length>a&&typeof t[a]!="number"){var d=t[a++];n(e,d)}for(;a<t.length;){n=t[a++];for(var g=a+1;g<t.length&&typeof t[g]!="number";)g++;switch(d=t[a++],g-=a,g){case 0:r(e,n,d);break;case 1:(g=Zn(t,a))?(a++,u(e,n,d,g)):r(e,n,d,t[a++]);break;case 2:g=a++,g=Zn(t,g),u(e,n,d,g,t[a++]);break;case 3:f(e,n,d,t[a++],t[a++],t[a++]);break;case 4:f(e,n,d,t[a++],t[a++],t[a++],t[a++]);break;default:throw Error("unexpected number of binary field arguments: "+g)}}return e}var pe=Symbol();function Jn(t){var e=t[pe];if(!e){var n=Qe(t);e=function(r,u){return er(r,u,n)},t[pe]=e}return e}function qn(t,e){var n=t[pe];return n||(n=function(r,u){return Yn(r,u,e)},t[pe]=n),n}var Qt=Symbol();function hi(t,e){t.push(e)}function di(t,e,n){t.push(e,n.W)}function pi(t,e,n,r){var u=Jn(r),f=Qe(r).P,a=n.W;t.push(e,function(d,g,E){return a(d,g,E,f,u)})}function mi(t,e,n,r,u,f){var a=qn(r,f),d=n.W;t.push(e,function(g,E,j){return d(g,E,j,r,a)})}function Qe(t){var e=t[Qt];return e||(e=$n(t,t[Qt]=[],hi,di,pi,mi),Zt in t&&Qt in t&&(t.length=0),e)}var Zt=Symbol();function vi(t,e){t[0]=e}function gi(t,e,n,r){var u=n.U;t[e]=r?function(f,a,d){return u(f,a,d,r)}:u}function yi(t,e,n,r,u){var f=n.U,a=Qn(r),d=Ze(r).P;t[e]=function(g,E,j){return f(g,E,j,d,a,u)}}function wi(t,e,n,r,u,f,a){var d=n.U,g=Xn(r,u,f);t[e]=function(E,j,H){return d(E,j,H,r,g,a)}}function Ze(t){var e=t[Zt];return e||(e=$n(t,t[Zt]={},vi,gi,yi,wi),Zt in t&&Qt in t&&(t.length=0),e)}function tr(t,e,n){for(;Bn(e)&&e.i!=4;){var r=e.l,u=n[r];if(!u){var f=n[0];f&&(f=f[r])&&(u=n[r]=ci(f))}if(!u||!u(e,t,r)){u=e,r=t,f=u.j,ue(u);var a=u;if(!a.ca){if(u=a.h.h-f,a.h.h=f,a=a.h,u==0)u=He();else{if(f=Rn(a,u),a.S&&a.m)u=a.i.subarray(f,f+u);else{a=a.i;var d=f;u=f+u,u=d===u?Ct():qr?a.slice(d,u):new Uint8Array(a.subarray(d,u))}u=u.length==0?He():new Gt(u,It)}(f=r.R)?f.push(u):r.R=[u]}}}return t}function er(t,e,n){for(var r=n.length,u=r%2==1,f=u?1:0;f<r;f+=2)(0,n[f+1])(e,t,n[f]);Yn(t,e,u?n[0]:void 0)}function $t(t,e){return{U:t,W:e}}var yt=$t(function(t,e,n){if(t.i!==5)return!1;t=t.h;var r=t.i,u=t.h,f=r[u],a=r[u+1],d=r[u+2];return r=r[u+3],Ut(t,t.h+4),a=(f<<0|a<<8|d<<16|r<<24)>>>0,t=2*(a>>31)+1,f=a>>>23&255,a&=8388607,xt(e,n,f==255?a?NaN:1/0*t:f==0?t*Math.pow(2,-149)*a:t*Math.pow(2,f-150)*(a+Math.pow(2,23))),!0},function(t,e,n){if(e=Ke(e,n),e!=null){Ht(t.h,8*n+5),t=t.h;var r=+e;r===0?0<1/r?q=st=0:(st=0,q=2147483648):isNaN(r)?(st=0,q=2147483647):(r=(n=0>r?-2147483648:0)?-r:r,34028234663852886e22<r?(st=0,q=(n|2139095040)>>>0):11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),st=0,q=(n|r)>>>0):(e=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-e),r=Math.round(8388608*r),16777216<=r&&++e,st=0,q=(n|e+127<<23|r&8388607)>>>0)),n=q,t.h.push(n>>>0&255),t.h.push(n>>>8&255),t.h.push(n>>>16&255),t.h.push(n>>>24&255)}}),bi=$t(function(t,e,n){if(t.i!==0)return!1;var r=t.h,u=0,f=t=0,a=r.i,d=r.h;do{var g=a[d++];u|=(g&127)<<f,f+=7}while(32>f&&g&128);for(32<f&&(t|=(g&127)>>4),f=3;32>f&&g&128;f+=7)g=a[d++],t|=(g&127)<<f;if(Ut(r,d),128>g)r=u>>>0,g=t>>>0,(t=g&2147483648)&&(r=~r+1>>>0,g=~g>>>0,r==0&&(g=g+1>>>0)),r=4294967296*g+(r>>>0);else throw Be();return xt(e,n,t?-r:r),!0},function(t,e,n){e=gt(e,n),e!=null&&(typeof e=="string"&&Sn(e),e!=null&&(Ht(t.h,8*n),typeof e=="number"?(t=t.h,wn(e),In(t,q,st)):(n=Sn(e),In(t.h,n.i,n.h))))}),xi=$t(function(t,e,n){return t.i!==0?!1:(xt(e,n,Kt(t.h)),!0)},function(t,e,n){if(e=gt(e,n),e!=null&&e!=null)if(Ht(t.h,8*n),t=t.h,n=e,0<=n)Ht(t,n);else{for(e=0;9>e;e++)t.h.push(n&127|128),n>>=7;t.h.push(1)}}),nr=$t(function(t,e,n){if(t.i!==2)return!1;var r=Kt(t.h)>>>0;t=t.h;var u=Rn(t,r);if(t=t.i,ei){var f=t,a;(a=Ue)||(a=Ue=new TextDecoder("utf-8",{fatal:!0})),t=u+r,f=u===0&&t===f.length?f:f.subarray(u,t);try{var d=a.decode(f)}catch(H){if(se===void 0){try{a.decode(new Uint8Array([128]))}catch{}try{a.decode(new Uint8Array([97])),se=!0}catch{se=!1}}throw!se&&(Ue=void 0),H}}else{d=u,r=d+r,u=[];for(var g=null,E,j;d<r;)E=t[d++],128>E?u.push(E):224>E?d>=r?Bt():(j=t[d++],194>E||(j&192)!==128?(d--,Bt()):u.push((E&31)<<6|j&63)):240>E?d>=r-1?Bt():(j=t[d++],(j&192)!==128||E===224&&160>j||E===237&&160<=j||((f=t[d++])&192)!==128?(d--,Bt()):u.push((E&15)<<12|(j&63)<<6|f&63)):244>=E?d>=r-2?Bt():(j=t[d++],(j&192)!==128||(E<<28)+(j-144)>>30||((f=t[d++])&192)!==128||((a=t[d++])&192)!==128?(d--,Bt()):(E=(E&7)<<18|(j&63)<<12|(f&63)<<6|a&63,E-=65536,u.push((E>>10&1023)+55296,(E&1023)+56320))):Bt(),8192<=u.length&&(g=jn(g,u),u.length=0);d=jn(g,u)}return xt(e,n,d),!0},function(t,e,n){if(e=gt(e,n),e!=null){var r=!1;if(r=r===void 0?!1:r,ni){if(r&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(Mn||(Mn=new TextEncoder)).encode(e)}else{for(var u=0,f=new Uint8Array(3*e.length),a=0;a<e.length;a++){var d=e.charCodeAt(a);if(128>d)f[u++]=d;else{if(2048>d)f[u++]=d>>6|192;else{if(55296<=d&&57343>=d){if(56319>=d&&a<e.length){var g=e.charCodeAt(++a);if(56320<=g&&57343>=g){d=1024*(d-55296)+g-56320+65536,f[u++]=d>>18|240,f[u++]=d>>12&63|128,f[u++]=d>>6&63|128,f[u++]=d&63|128;continue}else a--}if(r)throw Error("Found an unpaired surrogate");d=65533}f[u++]=d>>12|224,f[u++]=d>>6&63|128}f[u++]=d&63|128}}e=u===f.length?f:f.subarray(0,u)}Ht(t.h,8*n+2),Ht(t.h,e.length),Nt(t,t.h.end()),Nt(t,e)}}),rr=$t(function(t,e,n,r,u){if(t.i!==2)return!1;e=Cn(e,n,r),n=t.h.j,r=Kt(t.h)>>>0;var f=t.h.h+r,a=f-n;if(0>=a&&(t.h.j=f,u(e,t,void 0,void 0,void 0),a=f-t.h.h),a)throw Error("Message parsing ended unexpectedly. Expected to read "+(r+" bytes, instead read "+(r-a)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return t.h.h=f,t.h.j=n,!0},function(t,e,n,r,u){if(e=Ye(e,r,n),e!=null)for(r=0;r<e.length;r++){var f=t;Ht(f.h,8*n+2);var a=f.h.end();Nt(f,a),a.push(f.i),f=a,u(e[r],t),a=t;var d=f.pop();for(d=a.i+a.h.length()-d;127<d;)f.push(d&127|128),d>>>=7,a.i++;f.push(d),a.i++}});function $e(t){return function(e,n){t:{if(ae.length){var r=ae.pop();r.setOptions(n),Le(r.h,e,n),e=r}else e=new Ce(e,n);try{var u=Ze(t),f=tr(new u.P,e,u);break t}finally{u=e.h,u.i=null,u.m=!1,u.l=0,u.j=0,u.h=0,u.S=!1,e.l=-1,e.i=-1,100>ae.length&&ae.push(e)}f=void 0}return f}}function Je(t){return function(){var e=new ii;er(this,e,Qe(t)),Nt(e,e.h.end());for(var n=new Uint8Array(e.i),r=e.j,u=r.length,f=0,a=0;a<u;a++){var d=r[a];n.set(d,f),f+=d.length}return e.j=[n],n}}function zt(t){at.call(this,t)}R(zt,at);var ir=[zt,1,xi,2,yt,3,nr,4,nr];zt.prototype.l=Je(ir);function qe(t){at.call(this,t,-1,Si)}R(qe,at),qe.prototype.addClassification=function(t,e){return Cn(this,1,zt,t,e),this};var Si=[1],Ai=$e([qe,1,rr,ir]);function Jt(t){at.call(this,t)}R(Jt,at);var or=[Jt,1,yt,2,yt,3,yt,4,yt,5,yt];Jt.prototype.l=Je(or);function sr(t){at.call(this,t,-1,Ei)}R(sr,at);var Ei=[1],Oi=$e([sr,1,rr,or]);function me(t){at.call(this,t)}R(me,at);var ur=[me,1,yt,2,yt,3,yt,4,yt,5,yt,6,bi],ji=$e(ur);me.prototype.l=Je(ur);function ar(t,e,n){if(n=t.createShader(n===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+t.getShaderInfoLog(n));return n}function Mi(t){return Ye(t,zt,1).map(function(e){var n=gt(e,1);return{index:n??0,qa:At(e,2),label:gt(e,3)!=null?ce(gt(e,3),""):void 0,displayName:gt(e,4)!=null?ce(gt(e,4),""):void 0}})}function Ti(t){return{x:At(t,1),y:At(t,2),z:At(t,3),visibility:Ke(t,4)!=null?At(t,4):void 0}}function tn(t,e){this.i=t,this.h=e,this.m=0}function fr(t,e,n){return Fi(t,e),typeof t.h.canvas.transferToImageBitmap=="function"?Promise.resolve(t.h.canvas.transferToImageBitmap()):n?Promise.resolve(t.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(t.h.canvas):(t.j===void 0&&(t.j=document.createElement("canvas")),new Promise(function(r){t.j.height=t.h.canvas.height,t.j.width=t.h.canvas.width,t.j.getContext("2d",{}).drawImage(t.h.canvas,0,0,t.h.canvas.width,t.h.canvas.height),r(t.j)}))}function Fi(t,e){var n=t.h;if(t.s===void 0){var r=ar(n,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),u=ar(n,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),f=n.createProgram();if(n.attachShader(f,r),n.attachShader(f,u),n.linkProgram(f),!n.getProgramParameter(f,n.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+n.getProgramInfoLog(f));r=t.s=f,n.useProgram(r),u=n.getUniformLocation(r,"sampler0"),t.l={O:n.getAttribLocation(r,"aVertex"),N:n.getAttribLocation(r,"aTex"),ya:u},t.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.v),n.enableVertexAttribArray(t.l.O),n.vertexAttribPointer(t.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.enableVertexAttribArray(t.l.N),n.vertexAttribPointer(t.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(u,0)}r=t.l,n.useProgram(t.s),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.i.bindTexture2d(e.glName),n.enableVertexAttribArray(r.O),n.bindBuffer(n.ARRAY_BUFFER,t.v),n.vertexAttribPointer(r.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.N),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.vertexAttribPointer(r.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.O),n.disableVertexAttribArray(r.N),n.bindBuffer(n.ARRAY_BUFFER,null),t.i.bindTexture2d(0)}function _i(t){this.h=t}var Pi=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Ri(t,e){return e+t}function lr(t,e){window[t]=e}function ki(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise(function(n){e.addEventListener("load",function(){n()},!1),e.addEventListener("error",function(){n()},!1),document.body.appendChild(e)})}function Ii(){return B(function(t){switch(t.h){case 1:return t.s=2,O(t,WebAssembly.instantiate(Pi),4);case 4:t.h=3,t.s=0;break;case 2:return t.s=0,t.l=null,t.return(!1);case 3:return t.return(!0)}})}function en(t){if(this.h=t,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=t&&t.locateFile||Ri,typeof window=="object")var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=e,t.options){e=m(Object.keys(t.options));for(var n=e.next();!n.done;n=e.next()){n=n.value;var r=t.options[n].default;r!==void 0&&(this.l[n]=typeof r=="function"?r():r)}}}i=en.prototype,i.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function Bi(t){var e,n,r,u,f,a,d,g,E,j,H;return B(function(k){switch(k.h){case 1:return t.ga?(e=t.h.files===void 0?[]:typeof t.h.files=="function"?t.h.files(t.l):t.h.files,O(k,Ii(),2)):k.return();case 2:if(n=k.i,typeof window=="object")return lr("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),lr("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),a=e.filter(function(T){return T.data!==void 0}),d=e.filter(function(T){return T.data===void 0}),g=Promise.all(a.map(function(T){var L=ve(t,T.url);if(T.path!==void 0){var N=T.path;L=L.then(function(Q){return t.overrideFile(N,Q),Promise.resolve(Q)})}return L})),E=Promise.all(d.map(function(T){return T.simd===void 0||T.simd&&n||!T.simd&&!n?ki(t.locateFile(T.url,t.ha)):Promise.resolve()})).then(function(){var T,L,N;return B(function(Q){if(Q.h==1)return T=window.createMediapipeSolutionsWasm,L=window.createMediapipeSolutionsPackedAssets,N=t,O(Q,T(L),2);N.i=Q.i,Q.h=0})}),j=function(){return B(function(T){return t.h.graph&&t.h.graph.url?T=O(T,ve(t,t.h.graph.url),0):(T.h=0,T=void 0),T})}(),O(k,Promise.all([E,g,j]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return r=e.filter(function(T){return T.simd===void 0||T.simd&&n||!T.simd&&!n}).map(function(T){return t.locateFile(T.url,t.ha)}),importScripts.apply(null,b(r)),u=t,O(k,createMediapipeSolutionsWasm(Module),6);case 6:u.i=k.i,t.m=new OffscreenCanvas(1,1),t.i.canvas=t.m,f=t.i.GL.createContext(t.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),t.i.GL.makeContextCurrent(f),k.h=4;break;case 7:if(t.m=document.createElement("canvas"),H=t.m.getContext("webgl2",{}),!H&&(H=t.m.getContext("webgl",{}),!H))return alert("Failed to create WebGL canvas context when passing video frame."),k.return();t.K=H,t.i.canvas=t.m,t.i.createContext(t.m,!0,!0,{});case 4:t.j=new t.i.SolutionWasm,t.ga=!1,k.h=0}})}function Ui(t){var e,n,r,u,f,a,d,g;return B(function(E){if(E.h==1){if(t.h.graph&&t.h.graph.url&&t.fa===t.h.graph.url)return E.return();if(t.u=!0,!t.h.graph||!t.h.graph.url){E.h=2;return}return t.fa=t.h.graph.url,O(E,ve(t,t.h.graph.url),3)}for(E.h!=2&&(e=E.i,t.j.loadGraph(e)),n=m(Object.keys(t.D)),r=n.next();!r.done;r=n.next())u=r.value,t.j.overrideFile(u,t.D[u]);if(t.D={},t.h.listeners)for(f=m(t.h.listeners),a=f.next();!a.done;a=f.next())d=a.value,Ci(t,d);g=t.l,t.l={},t.setOptions(g),E.h=0})}i.reset=function(){var t=this;return B(function(e){t.j&&(t.j.reset(),t.s={},t.v={}),e.h=0})},i.setOptions=function(t,e){var n=this;if(e=e||this.h.options){for(var r=[],u=[],f={},a=m(Object.keys(t)),d=a.next();!d.done;f={X:f.X,Y:f.Y},d=a.next())if(d=d.value,!(d in this.l&&this.l[d]===t[d])){this.l[d]=t[d];var g=e[d];g!==void 0&&(g.onChange&&(f.X=g.onChange,f.Y=t[d],r.push(function(E){return function(){var j;return B(function(H){if(H.h==1)return O(H,E.X(E.Y),2);j=H.i,j===!0&&(n.u=!0),H.h=0})}}(f))),g.graphOptionXref&&(d=Object.assign({},{calculatorName:"",calculatorIndex:0},g.graphOptionXref,{valueNumber:g.type===1?t[d]:0,valueBoolean:g.type===0?t[d]:!1,valueString:g.type===2?t[d]:""}),u.push(d)))}(r.length!==0||u.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(u),this.F=(this.F===void 0?[]:this.F).concat(r))}};function Hi(t){var e,n,r,u,f,a,d;return B(function(g){switch(g.h){case 1:if(!t.u)return g.return();if(!t.F){g.h=2;break}e=m(t.F),n=e.next();case 3:if(n.done){g.h=5;break}return r=n.value,O(g,r(),4);case 4:n=e.next(),g.h=3;break;case 5:t.F=void 0;case 2:if(t.H){for(u=new t.i.GraphOptionChangeRequestList,f=m(t.H),a=f.next();!a.done;a=f.next())d=a.value,u.push_back(d);t.j.changeOptions(u),u.delete(),t.H=void 0}t.u=!1,g.h=0}})}i.initialize=function(){var t=this;return B(function(e){return e.h==1?O(e,Bi(t),2):e.h!=3?O(e,Ui(t),3):O(e,Hi(t),0)})};function ve(t,e){var n,r;return B(function(u){return e in t.L?u.return(t.L[e]):(n=t.locateFile(e,""),r=fetch(n).then(function(f){return f.arrayBuffer()}),t.L[e]=r,u.return(r))})}i.overrideFile=function(t,e){this.j?this.j.overrideFile(t,e):this.D[t]=e},i.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},i.send=function(t,e){var n=this,r,u,f,a,d,g,E,j,H;return B(function(k){switch(k.h){case 1:return n.h.inputs?(r=1e3*(e??performance.now()),O(k,n.I,2)):k.return();case 2:return O(k,n.initialize(),3);case 3:for(u=new n.i.PacketDataList,f=m(Object.keys(t)),a=f.next();!a.done;a=f.next())if(d=a.value,g=n.h.inputs[d]){t:{var T=t[d];switch(g.type){case"video":var L=n.s[g.stream];if(L||(L=new tn(n.i,n.K),n.s[g.stream]=L),L.m===0&&(L.m=L.i.createTexture()),typeof HTMLVideoElement<"u"&&T instanceof HTMLVideoElement)var N=T.videoWidth,Q=T.videoHeight;else typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement?(N=T.naturalWidth,Q=T.naturalHeight):(N=T.width,Q=T.height);Q={glName:L.m,width:N,height:Q},N=L.h,N.canvas.width=Q.width,N.canvas.height=Q.height,N.activeTexture(N.TEXTURE0),L.i.bindTexture2d(L.m),N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,T),L.i.bindTexture2d(0),L=Q;break t;case"detections":for(L=n.s[g.stream],L||(L=new _i(n.i),n.s[g.stream]=L),L.data||(L.data=new L.h.DetectionListData),L.data.reset(T.length),Q=0;Q<T.length;++Q){N=T[Q];var X=L.data,rt=X.setBoundingBox,pt=Q,ft=N.la,K=new me;if(St(K,1,ft.sa),St(K,2,ft.ta),St(K,3,ft.height),St(K,4,ft.width),St(K,5,ft.rotation),xt(K,6,ft.pa),ft=K.l(),rt.call(X,pt,ft),N.ea)for(X=0;X<N.ea.length;++X){K=N.ea[X],rt=L.data,pt=rt.addNormalizedLandmark,ft=Q,K=Object.assign({},K,{visibility:K.visibility?K.visibility:0});var it=new Jt;St(it,1,K.x),St(it,2,K.y),St(it,3,K.z),K.visibility&&St(it,4,K.visibility),K=it.l(),pt.call(rt,ft,K)}if(N.ba)for(X=0;X<N.ba.length;++X)rt=L.data,pt=rt.addClassification,ft=Q,K=N.ba[X],it=new zt,St(it,2,K.qa),K.index&&xt(it,1,K.index),K.label&&xt(it,3,K.label),K.displayName&&xt(it,4,K.displayName),K=it.l(),pt.call(rt,ft,K)}L=L.data;break t;default:L={}}}switch(E=L,j=g.stream,g.type){case"video":u.pushTexture2d(Object.assign({},E,{stream:j,timestamp:r}));break;case"detections":H=E,H.stream=j,H.timestamp=r,u.pushDetectionList(H);break;default:throw Error("Unknown input config type: '"+g.type+"'")}}return n.j.send(u),O(k,n.I,4);case 4:u.delete(),k.h=0}})};function Li(t,e,n){var r,u,f,a,d,g,E,j,H,k,T,L,N,Q;return B(function(X){switch(X.h){case 1:if(!n)return X.return(e);for(r={},u=0,f=m(Object.keys(n)),a=f.next();!a.done;a=f.next())d=a.value,g=n[d],typeof g!="string"&&g.type==="texture"&&e[g.stream]!==void 0&&++u;1<u&&(t.M=!1),E=m(Object.keys(n)),a=E.next();case 2:if(a.done){X.h=4;break}if(j=a.value,H=n[j],typeof H=="string")return N=r,Q=j,O(X,Di(t,j,e[H]),14);if(k=e[H.stream],H.type==="detection_list"){if(k){for(var rt=k.getRectList(),pt=k.getLandmarksList(),ft=k.getClassificationsList(),K=[],it=0;it<rt.size();++it){var Ft=ji(rt.get(it)),Ni=At(Ft,1),zi=At(Ft,2),Wi=At(Ft,3),Vi=At(Ft,4),Gi=At(Ft,5,0),ge=void 0;ge=ge===void 0?0:ge,Ft={la:{sa:Ni,ta:zi,height:Wi,width:Vi,rotation:Gi,pa:ce(gt(Ft,6),ge)},ea:Ye(Oi(pt.get(it)),Jt,1).map(Ti),ba:Mi(Ai(ft.get(it)))},K.push(Ft)}rt=K}else rt=[];r[j]=rt,X.h=7;break}if(H.type==="proto_list"){if(k){for(rt=Array(k.size()),pt=0;pt<k.size();pt++)rt[pt]=k.get(pt);k.delete()}else rt=[];r[j]=rt,X.h=7;break}if(k===void 0){X.h=3;break}if(H.type==="float_list"){r[j]=k,X.h=7;break}if(H.type==="proto"){r[j]=k,X.h=7;break}if(H.type!=="texture")throw Error("Unknown output config type: '"+H.type+"'");return T=t.v[j],T||(T=new tn(t.i,t.K),t.v[j]=T),O(X,fr(T,k,t.M),13);case 13:L=X.i,r[j]=L;case 7:H.transform&&r[j]&&(r[j]=H.transform(r[j])),X.h=3;break;case 14:N[Q]=X.i;case 3:a=E.next(),X.h=2;break;case 4:return X.return(r)}})}function Di(t,e,n){var r;return B(function(u){return typeof n=="number"||n instanceof Uint8Array||n instanceof t.i.Uint8BlobList?u.return(n):n instanceof t.i.Texture2dDataOut?(r=t.v[e],r||(r=new tn(t.i,t.K),t.v[e]=r),u.return(fr(r,n,t.M))):u.return(void 0)})}function Ci(t,e){for(var n=e.name||"$",r=[].concat(b(e.wants)),u=new t.i.StringList,f=m(e.wants),a=f.next();!a.done;a=f.next())u.push_back(a.value);f=t.i.PacketListener.implement({onResults:function(d){for(var g={},E=0;E<e.wants.length;++E)g[r[E]]=d.get(E);var j=t.listeners[n];j&&(t.I=Li(t,g,e.outs).then(function(H){H=j(H);for(var k=0;k<e.wants.length;++k){var T=g[r[k]];typeof T=="object"&&T.hasOwnProperty&&T.hasOwnProperty("delete")&&T.delete()}H&&(t.I=H)}))}}),t.j.attachMultiListener(u,f),u.delete()}i.onResults=function(t,e){this.listeners[e||"$"]=t},et("Solution",en),et("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function cr(t){switch(t===void 0&&(t=0),t){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function hr(t){var e=this;t=t||{},this.h=new en({locateFile:t.locateFile,files:function(n){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:cr(n.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(n){var r,u,f;return B(function(a){return a.h==1?(r=cr(n),u="third_party/mediapipe/modules/selfie_segmentation/"+r,O(a,ve(e.h,r),2)):(f=a.i,e.h.overrideFile(u,f),a.return(!0))})}}}})}i=hr.prototype,i.close=function(){return this.h.close(),Promise.resolve()},i.onResults=function(t){this.h.onResults(t)},i.initialize=function(){var t=this;return B(function(e){return O(e,t.h.initialize(),0)})},i.reset=function(){this.h.reset()},i.send=function(t){var e=this;return B(function(n){return O(n,e.h.send(t),0)})},i.setOptions=function(t){this.h.setOptions(t)},et("SelfieSegmentation",hr),et("VERSION","0.1.1675465747")}).call(nn);/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var ln=function(i,s){return ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,l){o.__proto__=l}||function(o,l){for(var c in l)l.hasOwnProperty(c)&&(o[c]=l[c])},ln(i,s)};function Ur(i,s){function o(){this.constructor=i}ln(i,s),i.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}var ot=function(){return ot=Object.assign||function(i){for(var s,o=1,l=arguments.length;o<l;o++)for(var c in s=arguments[o])Object.prototype.hasOwnProperty.call(s,c)&&(i[c]=s[c]);return i},ot.apply(this,arguments)};function W(i,s,o,l){return new(o||(o=Promise))(function(c,h){function p(y){try{b(l.next(y))}catch(v){h(v)}}function m(y){try{b(l.throw(y))}catch(v){h(v)}}function b(y){var v;y.done?c(y.value):(v=y.value,v instanceof o?v:new o(function(x){x(v)})).then(p,m)}b((l=l.apply(i,[])).next())})}function V(i,s){var o,l,c,h,p={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(b){return function(y){return function(v){if(o)throw new TypeError("Generator is already executing.");for(;p;)try{if(o=1,l&&(c=2&v[0]?l.return:v[0]?l.throw||((c=l.return)&&c.call(l),0):l.next)&&!(c=c.call(l,v[1])).done)return c;switch(l=0,c&&(v=[2&v[0],c.value]),v[0]){case 0:case 1:c=v;break;case 4:return p.label++,{value:v[1],done:!1};case 5:p.label++,l=v[1],v=[0];continue;case 7:v=p.ops.pop(),p.trys.pop();continue;default:if(c=p.trys,!((c=c.length>0&&c[c.length-1])||v[0]!==6&&v[0]!==2)){p=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){p.label=v[1];break}if(v[0]===6&&p.label<c[1]){p.label=c[1],c=v;break}if(c&&p.label<c[2]){p.label=c[2],p.ops.push(v);break}c[2]&&p.ops.pop(),p.trys.pop();continue}v=s.call(i,p)}catch(x){v=[6,x],l=0}finally{o=c=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}([b,y])}}}function je(i){return i instanceof SVGAnimatedLength?i.baseVal.value:i}function gn(i){return W(this,void 0,void 0,function(){var s,o;return V(this,function(l){switch(l.label){case 0:return s=document.createElement("canvas"),i instanceof Mt?[4,_e(i,s)]:[3,2];case 1:return l.sent(),[3,3];case 2:s.width=je(i.width),s.height=je(i.height),o=s.getContext("2d"),i instanceof ImageData?o.putImageData(i,0,0):o.drawImage(i,0,0),l.label=3;case 3:return[2,s]}})})}function Hr(i){return W(this,void 0,void 0,function(){var s,o,l,c,h,p;return V(this,function(m){switch(m.label){case 0:return i instanceof Mt?(s=i.shape.slice(0,2),o=s[0],l=s[1],c=ImageData.bind,[4,_e(i)]):[3,2];case 1:return[2,new(c.apply(ImageData,[void 0,m.sent(),l,o]))];case 2:return h=document.createElement("canvas"),p=h.getContext("2d"),h.width=je(i.width),h.height=je(i.height),p.drawImage(i,0,0),[2,p.getImageData(0,0,h.width,h.height)]}})})}function Lr(i){return W(this,void 0,void 0,function(){var s,o;return V(this,function(l){switch(l.label){case 0:return i instanceof SVGImageElement||i instanceof OffscreenCanvas?[4,gn(i)]:[3,2];case 1:return o=l.sent(),[3,3];case 2:o=i,l.label=3;case 3:return s=o,[2,mn(s,4)]}})})}function oe(i){if(i<0||i>=256)throw new Error("Mask value must be in range [0, 255] but got "+i);if(!Number.isInteger(i))throw new Error("Mask value must be an integer but got "+i)}var rn=[[110,64,170],[143,61,178],[178,60,178],[210,62,167],[238,67,149],[255,78,125],[255,94,99],[255,115,75],[255,140,56],[239,167,47],[217,194,49],[194,219,64],[175,240,91],[135,245,87],[96,247,96],[64,243,115],[40,234,141],[28,219,169],[26,199,194],[33,176,213],[47,150,224],[65,125,224],[84,101,214],[99,81,195]];function $o(i){if(oe(i),i<rn.length){var s=rn[i];return{r:s[0],g:s[1],b:s[2],a:255}}throw new Error("Mask value must be in range [0, "+rn.length+")")}function Dr(i){var s=i.shape[2],o=$i(i,2),l=Pe(o,[-1]);return Ji(l,s)}function ye(i,s){return J(function(){return Dt(qi(i,ie(s)),"int32")})}function oo(i,s){var o=s.shape,l=o[0],c=o[1],h=o[2];return J(function(){var p=Dr(s),m=Vt(Rr(0,h,1,"int32"),1),b=Dt(kr(p,m),"int32"),y=Pe(b,[l,c]),v=Fe(y,ie(1,"int32"));return dn(function(x,w){return vn(x,w)}(v,i),ie(1,"int32"))})}var Cr=function(){function i(s,o){this.model=s,this.outputStride=o;var l=this.model.inputs[0].shape;ne(l[1]===-1&&l[2]===-1,function(){return"Input shape ["+l[1]+", "+l[2]+"] must both be equal to or -1"})}return i.prototype.predict=function(s){var o=this;return J(function(){var l=o.preprocessInput(Dt(s,"float32")),c=Vt(l,0),h=o.model.predict(c).map(function(m){return _t(m,[0])}),p=o.nameOutputResults(h);return{heatmapScores:hn(p.heatmap),offsets:p.offsets,displacementFwd:p.displacementFwd,displacementBwd:p.displacementBwd,segmentation:p.segmentation,partHeatmaps:p.partHeatmaps,longOffsets:p.longOffsets,partOffsets:p.partOffsets}})},i.prototype.dispose=function(){this.model.dispose()},i}(),so=function(i){function s(){return i!==null&&i.apply(this,arguments)||this}return Ur(s,i),s.prototype.preprocessInput=function(o){return J(function(){return dn(Ki(o,127.5),1)})},s.prototype.nameOutputResults=function(o){return{offsets:o[0],segmentation:o[1],partHeatmaps:o[2],longOffsets:o[3],heatmap:o[4],displacementFwd:o[5],displacementBwd:o[6],partOffsets:o[7]}},s}(Cr),Re=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],wt=Re.length,Me=Re.reduce(function(i,s,o){return i[s]=o,i},{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map(function(i){var s=i[0],o=i[1];return[Me[s],Me[o]]});function yn(i,s,o){var l=i[0],c=i[1],h=s[0],p=s[1],m=o.top,b=o.bottom;return[p/(o.left+o.right+c),h/(m+b+l)]}function Nr(i,s,o,l){return{y:l.get(i,s,o),x:l.get(i,s,o+wt)}}function zr(i,s,o){var l=Nr(i.heatmapY,i.heatmapX,i.id,o),c=l.y,h=l.x;return{x:i.heatmapX*s+h,y:i.heatmapY*s+c}}function dr(i,s,o){return i<s?s:i>o?o:i}function pr(i,s){return{x:i.x+s.x,y:i.y+s.y}}function uo(i,s,o){o===void 0&&(o=.3);for(var l=0,c=0,h=0;h<i.length;h++)s.keypoints[h].score>o&&(c+=1,l+=Math.pow(i[h].x-s.keypoints[h].position.x,2)+Math.pow(i[h].y-s.keypoints[h].position.y,2));return c===0?l=1/0:l/=c,l}function ao(i,s,o,l,c,h,p){for(var m=p[0],b=p[1],y=o(i),v=y.y*l+y.x,x=c[wt*(2*v)+s],w=c[wt*(2*v+1)+s],A=i.y+x,S=i.x+w,M=0;M<h;M++){A=Math.min(A,m-1);var R=o({x:S=Math.min(S,b-1),y:A}),_=R.y*l+R.x;A+=x=c[wt*(2*_)+s],S+=w=c[wt*(2*_+1)+s]}return{x:S,y:A}}function Wr(i,s,o,l,c,h,p,m,b,y){for(var v=c[0],x=c[1],w=h[0],A=h[1],S=m[0],M=m[1],R=[],_=function(D){return function(z,G,B,$){var Y=G[0],tt=G[1],et=B[0],nt=B[1],ut=Math.round(((Y+z.y+1)*nt-1)/$);return{x:Math.round(((tt+z.x+1)*et-1)/$),y:ut}}(D,[v,x],[w,A],b)},F=0;F<l;F++){var P=ao(i,F,_,p,s,y,[S,M]);R.push(P)}for(var O=-1,I=1/0,U=0;U<o.length;U++){var C=uo(R,o[U]);C<I&&(O=U,I=C)}return O}function Vr(i,s){var o=i[0],l=i[1];return[Math.round((l-1)/s+1),Math.round((o-1)/s+1)]}function Gr(i,s,o,l,c,h,p,m,b,y,v){for(var x=p[0],w=p[1],A=i.shape,S=A[0],M=A[1],R=s.shape.slice(0,2),_=R[0],F=R[1],P=Pe(s,[_,F,2,wt]),O=new Float32Array(v*wt*3).fill(0),I=0;I<o.length;I++)for(var U=I*wt*3,C=o[I],D=0;D<wt;D++){var z=C.keypoints[D],G=U+3*D;O[G]=z.score,O[G+1]=z.position.y,O[G+2]=z.position.x}var B=yn([l,c],[x,w],m),$=B[0],Y=B[1],tt=eo(O,[v,wt,3]),et=m.top,nt=m.left,ut={variableNames:["segmentation","longOffsets","poses"],outputShape:[S,M],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+et+", "+Y+", "+h+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+nt+", "+$+", "+h+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+v+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+wt+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+b+`; s++) {
            int yRounded = round(min(y, float(`+(l-1)+`)));
            int xRounded = round(min(x, float(`+(c-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+et+", "+Y+", "+h+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+nt+", "+$+", "+h+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+y+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return no().compileAndRun(ut,[i,P,tt])}function Kr(){return ro()==="webgl"}function fo(i,s,o,l,c,h,p,m,b,y,v,x){var w=p[0],A=p[1];return b===void 0&&(b=.2),y===void 0&&(y=8),v===void 0&&(v=.3),x===void 0&&(x=10),W(this,void 0,void 0,function(){var S,M,R,_,F;return V(this,function(P){switch(P.label){case 0:return S=o.filter(function(O){return O.score>=b}),Kr()?(R=J(function(){var O=Gr(i,s,S,l,c,h,[w,A],m,y,v,x),I=Ir().makeTensorFromDataId(O.dataId,O.shape,O.dtype);return S.map(function(U,C){return function(D,z){return J(function(){return Dt(Br(D,ie(z)),"int32")})}(I,C)})}),[4,Promise.all(R.map(function(O){return O.data()}))]):[3,2];case 1:return M=P.sent(),R.forEach(function(O){return O.dispose()}),[3,5];case 2:return[4,i.data()];case 3:return _=P.sent(),[4,s.data()];case 4:F=P.sent(),M=function(O,I,U,C,D,z,G,B,$,Y){var tt=G[0],et=G[1];Y===void 0&&(Y=5);for(var nt=U.map(function(Ot){return new Uint8Array(C*D).fill(0)}),ut=B.top,mt=B.left,lt=yn([C,D],[tt,et],B),Pt=lt[0],Rt=lt[1],Et=Vr([tt,et],z)[0],ct=0;ct<C;ct+=1)for(var ht=0;ht<D;ht+=1){var vt=ct*D+ht;if(O[vt]===1){var dt=Wr({x:ht,y:ct},I,U,Y,[ut,mt],[Pt,Rt],Et,[C,D],z,$);dt>=0&&(nt[dt][vt]=1)}}return nt}(_,F,S,l,c,h,[w,A],m,y),P.label=5;case 5:return[2,M.map(function(O,I){return{data:O,pose:S[I],width:c,height:l}})]}})})}function lo(i,s,o,l,c,h,p,m,b,y,v,x,w){var A=m[0],S=m[1];return y===void 0&&(y=.2),v===void 0&&(v=8),x===void 0&&(x=.3),w===void 0&&(w=10),W(this,void 0,void 0,function(){var M,R,_,F,P,O;return V(this,function(I){switch(I.label){case 0:return M=l.filter(function(U){return U.score>=y}),Kr()?(_=J(function(){var U=Gr(i,s,M,c,h,p,[A,S],b,v,x,w),C=Ir().makeTensorFromDataId(U.dataId,U.shape,U.dtype);return M.map(function(D,z){return function(G,B,$){return J(function(){return dn(vn(Dt(Br(G,ie($)),"int32"),Fe(B,1)),1)})}(C,o,z)})}),[4,Promise.all(_.map(function(U){return U.data()}))]):[3,2];case 1:return R=I.sent(),_.forEach(function(U){return U.dispose()}),[3,6];case 2:return[4,i.data()];case 3:return F=I.sent(),[4,s.data()];case 4:return P=I.sent(),[4,o.data()];case 5:O=I.sent(),R=function(U,C,D,z,G,B,$,Y,tt,et,nt){var ut=Y[0],mt=Y[1];nt===void 0&&(nt=5);for(var lt=z.map(function(Ct){return new Int32Array(G*B).fill(-1)}),Pt=tt.top,Rt=tt.left,Et=yn([G,B],[ut,mt],tt),ct=Et[0],ht=Et[1],vt=Vr([ut,mt],$)[0],dt=0;dt<G;dt+=1)for(var Ot=0;Ot<B;Ot+=1){var Tt=dt*B+Ot;if(U[Tt]===1){var kt=Wr({x:Ot,y:dt},C,z,nt,[Pt,Rt],[ct,ht],vt,[G,B],$,et);kt>=0&&(lt[kt][Tt]=D[Tt])}}return lt}(F,P,O,M,c,h,p,[A,S],b,v),I.label=6;case 6:return[2,R.map(function(U,C){return{pose:M[C],data:U,height:c,width:h}})]}})})}function on(i){return Math.floor(i/2)}var co=function(){function i(s,o){this.priorityQueue=new Array(s),this.numberOfElements=-1,this.getElementValue=o}return i.prototype.enqueue=function(s){this.priorityQueue[++this.numberOfElements]=s,this.swim(this.numberOfElements)},i.prototype.dequeue=function(){var s=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,s},i.prototype.empty=function(){return this.numberOfElements===-1},i.prototype.size=function(){return this.numberOfElements+1},i.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},i.prototype.max=function(){return this.priorityQueue[0]},i.prototype.swim=function(s){for(;s>0&&this.less(on(s),s);)this.exchange(s,on(s)),s=on(s)},i.prototype.sink=function(s){for(;2*s<=this.numberOfElements;){var o=2*s;if(o<this.numberOfElements&&this.less(o,o+1)&&o++,!this.less(s,o))break;this.exchange(s,o),s=o}},i.prototype.getValueAt=function(s){return this.getElementValue(this.priorityQueue[s])},i.prototype.less=function(s,o){return this.getValueAt(s)<this.getValueAt(o)},i.prototype.exchange=function(s,o){var l=this.priorityQueue[s];this.priorityQueue[s]=this.priorityQueue[o],this.priorityQueue[o]=l},i}();function ho(i,s,o,l,c,h){for(var p=h.shape,m=p[0],b=p[1],y=!0,v=Math.max(o-c,0),x=Math.min(o+c+1,m),w=v;w<x;++w){for(var A=Math.max(l-c,0),S=Math.min(l+c+1,b),M=A;M<S;++M)if(h.get(w,M,i)>s){y=!1;break}if(!y)break}return y}var Yr=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map(function(i){var s=i[0],o=i[1];return[Me[s],Me[o]]}),sn=Yr.map(function(i){return i[1]}),mr=Yr.map(function(i){return i[0]});function un(i,s,o,l){return{y:dr(Math.round(i.y/s),0,o-1),x:dr(Math.round(i.x/s),0,l-1)}}function vr(i,s,o,l,c,h,p,m){m===void 0&&(m=2);for(var b=l.shape,y=b[0],v=b[1],x=function(F,P,O){var I=O.shape[2]/2;return{y:O.get(P.y,P.x,F),x:O.get(P.y,P.x,I+F)}}(i,un(s.position,h,y,v),p),w=pr(s.position,x),A=0;A<m;A++){var S=un(w,h,y,v),M=Nr(S.y,S.x,o,c);w=pr({x:S.x*h,y:S.y*h},{x:M.x,y:M.y})}var R=un(w,h,y,v),_=l.get(R.y,R.x,o);return{position:w,part:Re[o],score:_}}function po(i,s,o,l,c,h){var p=s.shape[2],m=sn.length,b=new Array(p),y=i.part,v=i.score,x=zr(y,l,o);b[y.id]={score:v,part:Re[y.id],position:x};for(var w=m-1;w>=0;--w){var A=sn[w],S=mr[w];b[A]&&!b[S]&&(b[S]=vr(w,b[A],S,s,o,l,h))}for(w=0;w<m;++w)A=mr[w],S=sn[w],b[A]&&!b[S]&&(b[S]=vr(w,b[A],S,s,o,l,c));return b}function Xr(i,s,o,l){var c=o.x,h=o.y;return i.some(function(p){var m,b,y,v,x,w,A=p.keypoints[l].position;return m=h,b=c,y=A.y,v=A.x,(x=y-m)*x+(w=v-b)*w<=s})}function mo(i,s,o){var l=o.reduce(function(c,h,p){var m=h.position,b=h.score;return Xr(i,s,m,p)||(c+=b),c},0);return l/o.length}function we(i,s,o,l,c,h,p,m){p===void 0&&(p=.5),m===void 0&&(m=20);for(var b=[],y=function(S,M,R){for(var _=R.shape,F=_[0],P=_[1],O=_[2],I=new co(F*P*O,function(G){return G.score}),U=0;U<F;++U)for(var C=0;C<P;++C)for(var D=0;D<O;++D){var z=R.get(U,C,D);z<S||ho(D,z,U,C,M,R)&&I.enqueue({score:z,part:{heatmapY:U,heatmapX:C,id:D}})}return I}(p,1,i),v=m*m;b.length<h&&!y.empty();){var x=y.dequeue();if(!Xr(b,v,zr(x.part,c,s),x.part.id)){var w=po(x,i,s,c,o,l),A=mo(b,v,w);b.push({keypoints:w,score:A})}}return b}var qt,vo=[-123.15,-115.9,-103.06],go=function(i){function s(){return i!==null&&i.apply(this,arguments)||this}return Ur(s,i),s.prototype.preprocessInput=function(o){return Fe(o,vo)},s.prototype.nameOutputResults=function(o){var l=o[0],c=o[1],h=o[2],p=o[3],m=o[4],b=o[5];return{offsets:m,segmentation:o[6],partHeatmaps:b,longOffsets:p,heatmap:h,displacementFwd:c,displacementBwd:l,partOffsets:o[7]}},s}(Cr),gr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",yr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function te(i){if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return function(s){if("offsetHeight"in s&&s.offsetHeight!==0&&"offsetWidth"in s&&s.offsetWidth!==0)return[s.offsetHeight,s.offsetWidth];if(s.height!=null&&s.width!=null)return[s.height,s.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(i);if(typeof ImageData<"u"&&i instanceof ImageData)return[i.height,i.width];if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return function(s){return s.hasAttribute("height")&&s.hasAttribute("width")?[s.height,s.width]:[s.videoHeight,s.videoWidth]}(i);if(i instanceof Mt)return[i.shape[0],i.shape[1]];throw new Error("error: Unknown input type: "+i+".")}function wr(i,s){return function(o,l){return(o-1)%l==0}(i,s)?i:Math.floor(i/s)*s+1}var ee={low:"low",medium:"medium",high:"high",full:"full"},yo=((qt={})[ee.low]=.25,qt[ee.medium]=.5,qt[ee.high]=.75,qt[ee.full]=1,qt);function be(i,s,o){var l=o[0],c=o[1],h=function(p){if(typeof p=="string"){var m=yo[p];return ne(typeof m=="number",function(){return"string value of inputResolution must be one of "+Object.values(ee).join(",")+" but was "+p+"."}),m}return ne(typeof p=="number"&&p<=2&&p>=.1,function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+p}),p}(i);return[wr(l*h,s),wr(c*h,s)]}function Wt(i,s,o,l,c){var h=s[0],p=s[1],m=o[0],b=o[1],y=l[0],v=y[0],x=y[1],w=l[1],A=w[0],S=w[1];return J(function(){var M=re.resizeBilinear(i,[m,b],!0);return M=hn(M),function(R,_,F){var P=_[0],O=_[1],I=F[0],U=I[0],C=I[1],D=F[1],z=D[0],G=D[1];return J(function(){var B=Vt(R);return _t(re.cropAndResize(B,[[U/(P+U+C-1),z/(O+z+G-1),(U+P-1)/(P+U+C-1),(z+O-1)/(O+z+G-1)]],[0],[P,O]),[0])})}(M,[h,p],[[v,x],[A,S]])})}function xe(i,s){var o=s[0],l=s[1],c=te(i),h=c[0],p=c[1],m=l/o,b=[0,0,0,0],y=b[0],v=b[1],x=b[2],w=b[3];p/h<m?(y=0,v=0,x=Math.round(.5*(m*h-p)),w=Math.round(.5*(m*h-p))):(y=Math.round(.5*(1/m*p-h)),v=Math.round(.5*(1/m*p-h)),x=0,w=0);var A=J(function(){var S=function(M){return M instanceof Mt?M:mn(M)}(i);return S=to(S,[[y,v],[x,w],[0,0]]),re.resizeBilinear(S,[o,l])});return{resized:A,padding:{top:y,left:x,right:w,bottom:v}}}function Se(i){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,Promise.all(i.map(function(o){return o.buffer()}))]})})}function Ae(i,s,o,l,c){var h=s[0],p=s[1],m=o[0],b=o[1],y=function(v,x,w,A,S){return A===void 0&&(A=0),S===void 0&&(S=0),w===1&&x===1&&A===0&&S===0?v:v.map(function(M){return function(R,_,F,P,O){return P===void 0&&(P=0),O===void 0&&(O=0),{score:R.score,keypoints:R.keypoints.map(function(I){var U=I.score,C=I.part,D=I.position;return{score:U,part:C,position:{x:D.x*F+O,y:D.y*_+P}}})}}(M,x,w,A,S)})}(i,(h+l.top+l.bottom)/m,(p+l.left+l.right)/b,-l.top,-l.left);return c?function(v,x){return x<=0?v:v.map(function(w){return function(A,S){return{score:A.score,keypoints:A.keypoints.map(function(M){var R=M.score,_=M.part,F=M.position;return{score:R,part:_,position:{x:S-1-F.x,y:F.y}}})}}(w,x)})}(y,p):y}var br={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},xr=["MobileNetV1","ResNet50"],Sr={MobileNetV1:[8,16,32],ResNet50:[32,16]},Ar={MobileNetV1:[.5,.75,1],ResNet50:[1]},Er=[1,2,4],Ee={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},Oe={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function Or(i){var s=i.segmentationThreshold,o=i.maxDetections,l=i.scoreThreshold,c=i.nmsRadius;if(s<0||s>1)throw new Error("segmentationThreshold "+s+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid maxDetections "+o+". Should be > 0");if(l<0||l>1)throw new Error("Invalid scoreThreshold "+l+". Should be in range [0.0, 1.0]");if(c<=0)throw new Error("Invalid nmsRadius "+c+".")}function jr(i){var s=i.segmentationThreshold,o=i.maxDetections,l=i.scoreThreshold,c=i.nmsRadius,h=i.minKeypointScore,p=i.refineSteps;if(s<0||s>1)throw new Error("segmentationThreshold "+s+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid maxDetections "+o+". Should be > 0");if(l<0||l>1)throw new Error("Invalid scoreThreshold "+l+". Should be in range [0.0, 1.0]");if(c<=0)throw new Error("Invalid nmsRadius "+c+".");if(h<0||h>1)throw new Error("Invalid minKeypointScore "+h+".Should be in range [0.0, 1.0]");if(p<=0||p>20)throw new Error("Invalid refineSteps "+p+".Should be in range [1, 20]")}var Qr=function(){function i(s){this.baseModel=s}return i.prototype.predictForPersonSegmentation=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}},i.prototype.predictForPersonSegmentationAndPart=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,partHeatmapLogits:o.partHeatmaps,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}},i.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,longOffsets:o.longOffsets,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd,partHeatmaps:o.partHeatmaps}},i.prototype.segmentPersonActivation=function(s,o,l){var c=this;l===void 0&&(l=.5);var h=te(s),p=h[0],m=h[1],b=be(o,this.baseModel.outputStride,[p,m]),y=xe(s,b),v=y.resized,x=y.padding,w=J(function(){var F=c.predictForPersonSegmentation(v),P=F.segmentLogits,O=F.heatmapScores,I=F.offsets,U=F.displacementFwd,C=F.displacementBwd,D=v.shape,z=D[0],G=D[1],B=Wt(P,[p,m],[z,G],[[x.top,x.bottom],[x.left,x.right]]);return{segmentation:ye(_t(B),l),heatmapScores:O,offsets:I,displacementFwd:U,displacementBwd:C}}),A=w.segmentation,S=w.heatmapScores,M=w.offsets,R=w.displacementFwd,_=w.displacementBwd;return v.dispose(),{segmentation:A,heatmapScores:S,offsets:M,displacementFwd:R,displacementBwd:_,padding:x,internalResolutionHeightAndWidth:b}},i.prototype.segmentPerson=function(s,o){return o===void 0&&(o=Ee),W(this,void 0,void 0,function(){var l,c,h,p,m,b,y,v,x,w,A,S,M,R,_,F,P,O;return V(this,function(I){switch(I.label){case 0:return Or(o=ot(ot({},Ee),o)),l=this.segmentPersonActivation(s,o.internalResolution,o.segmentationThreshold),c=l.segmentation,h=l.heatmapScores,p=l.offsets,m=l.displacementFwd,b=l.displacementBwd,y=l.padding,v=l.internalResolutionHeightAndWidth,x=c.shape,w=x[0],A=x[1],[4,c.data()];case 1:return S=I.sent(),c.dispose(),[4,Se([h,p,m,b])];case 2:return M=I.sent(),R=M[0],_=M[1],F=M[2],P=M[3],O=Ae(O=we(R,_,F,P,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[w,A],v,y,!1),h.dispose(),p.dispose(),m.dispose(),b.dispose(),[2,{height:w,width:A,data:S,allPoses:O}]}})})},i.prototype.segmentMultiPerson=function(s,o){return o===void 0&&(o=Oe),W(this,void 0,void 0,function(){var l,c,h,p,m,b,y,v,x,w,A,S,M,R,_,F,P,O,I,U,C,D=this;return V(this,function(z){switch(z.label){case 0:return jr(o=ot(ot({},Oe),o)),l=te(s),c=l[0],h=l[1],p=be(o.internalResolution,this.baseModel.outputStride,[c,h]),m=xe(s,p),b=m.resized,y=m.padding,v=J(function(){var G,B=D.predictForMultiPersonInstanceSegmentationAndPart(b),$=B.segmentLogits,Y=B.longOffsets,tt=B.heatmapScores,et=B.offsets,nt=B.displacementFwd,ut=B.displacementBwd,mt=Wt($,[c,h],p,[[y.top,y.bottom],[y.left,y.right]]);return G=Y,{segmentation:ye(_t(mt),o.segmentationThreshold),longOffsets:G,heatmapScoresRaw:tt,offsetsRaw:et,displacementFwdRaw:nt,displacementBwdRaw:ut}}),x=v.segmentation,w=v.longOffsets,A=v.heatmapScoresRaw,S=v.offsetsRaw,M=v.displacementFwdRaw,R=v.displacementBwdRaw,[4,Se([A,S,M,R])];case 1:return _=z.sent(),F=_[0],P=_[1],O=_[2],I=_[3],U=Ae(U=we(F,P,O,I,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[c,h],p,y,!1),[4,fo(x,w,U,c,h,this.baseModel.outputStride,p,y,o.scoreThreshold,o.refineSteps,o.minKeypointScore,o.maxDetections)];case 2:return C=z.sent(),b.dispose(),x.dispose(),w.dispose(),A.dispose(),S.dispose(),M.dispose(),R.dispose(),[2,C]}})})},i.prototype.segmentPersonPartsActivation=function(s,o,l){var c=this;l===void 0&&(l=.5);var h=te(s),p=h[0],m=h[1],b=be(o,this.baseModel.outputStride,[p,m]),y=xe(s,b),v=y.resized,x=y.padding,w=J(function(){var F=c.predictForPersonSegmentationAndPart(v),P=F.segmentLogits,O=F.partHeatmapLogits,I=F.heatmapScores,U=F.offsets,C=F.displacementFwd,D=F.displacementBwd,z=v.shape,G=z[0],B=z[1],$=Wt(P,[p,m],[G,B],[[x.top,x.bottom],[x.left,x.right]]),Y=Wt(O,[p,m],[G,B],[[x.top,x.bottom],[x.left,x.right]]);return{partSegmentation:oo(ye(_t($),l),Y),heatmapScores:I,offsets:U,displacementFwd:C,displacementBwd:D}}),A=w.partSegmentation,S=w.heatmapScores,M=w.offsets,R=w.displacementFwd,_=w.displacementBwd;return v.dispose(),{partSegmentation:A,heatmapScores:S,offsets:M,displacementFwd:R,displacementBwd:_,padding:x,internalResolutionHeightAndWidth:b}},i.prototype.segmentPersonParts=function(s,o){return o===void 0&&(o=Ee),W(this,void 0,void 0,function(){var l,c,h,p,m,b,y,v,x,w,A,S,M,R,_,F,P,O;return V(this,function(I){switch(I.label){case 0:return Or(o=ot(ot({},Ee),o)),l=this.segmentPersonPartsActivation(s,o.internalResolution,o.segmentationThreshold),c=l.partSegmentation,h=l.heatmapScores,p=l.offsets,m=l.displacementFwd,b=l.displacementBwd,y=l.padding,v=l.internalResolutionHeightAndWidth,x=c.shape,w=x[0],A=x[1],[4,c.data()];case 1:return S=I.sent(),c.dispose(),[4,Se([h,p,m,b])];case 2:return M=I.sent(),R=M[0],_=M[1],F=M[2],P=M[3],O=Ae(O=we(R,_,F,P,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[w,A],v,y,!1),h.dispose(),p.dispose(),m.dispose(),b.dispose(),[2,{height:w,width:A,data:S,allPoses:O}]}})})},i.prototype.segmentMultiPersonParts=function(s,o){return o===void 0&&(o=Oe),W(this,void 0,void 0,function(){var l,c,h,p,m,b,y,v,x,w,A,S,M,R,_,F,P,O,I,U,C,D,z=this;return V(this,function(G){switch(G.label){case 0:return jr(o=ot(ot({},Oe),o)),l=te(s),c=l[0],h=l[1],p=be(o.internalResolution,this.baseModel.outputStride,[c,h]),m=xe(s,p),b=m.resized,y=m.padding,v=J(function(){var B=z.predictForMultiPersonInstanceSegmentationAndPart(b),$=B.segmentLogits,Y=B.longOffsets,tt=B.heatmapScores,et=B.offsets,nt=B.displacementFwd,ut=B.displacementBwd,mt=B.partHeatmaps,lt=Wt($,[c,h],p,[[y.top,y.bottom],[y.left,y.right]]),Pt=Wt(mt,[c,h],p,[[y.top,y.bottom],[y.left,y.right]]),Rt=Y,Et=ye(_t(lt),o.segmentationThreshold),ct=function(ht){var vt=ht.shape,dt=vt[0],Ot=vt[1],Tt=vt[2];return J(function(){var kt=Dr(ht),Ct=Vt(Rr(0,Tt,1,"int32"),1),It=Dt(kr(kt,Ct),"int32");return Pe(It,[dt,Ot])})}(Pt);return{segmentation:Et,longOffsets:Rt,heatmapScoresRaw:tt,offsetsRaw:et,displacementFwdRaw:nt,displacementBwdRaw:ut,partSegmentation:ct}}),x=v.segmentation,w=v.longOffsets,A=v.heatmapScoresRaw,S=v.offsetsRaw,M=v.displacementFwdRaw,R=v.displacementBwdRaw,_=v.partSegmentation,[4,Se([A,S,M,R])];case 1:return F=G.sent(),P=F[0],O=F[1],I=F[2],U=F[3],C=Ae(C=we(P,O,I,U,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[c,h],p,y,!1),[4,lo(x,w,_,C,c,h,this.baseModel.outputStride,p,y,o.scoreThreshold,o.refineSteps,o.minKeypointScore,o.maxDetections)];case 2:return D=G.sent(),b.dispose(),x.dispose(),w.dispose(),A.dispose(),S.dispose(),M.dispose(),R.dispose(),_.dispose(),[2,D]}})})},i.prototype.dispose=function(){this.baseModel.dispose()},i}();function wo(i){return W(this,void 0,void 0,function(){var s,o,l,c,h,p;return V(this,function(m){switch(m.label){case 0:if(s=i.outputStride,o=i.quantBytes,l=i.multiplier,Pr==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return c=function(b,y,v){var x={1:"100",.75:"075",.5:"050"},w="model-stride"+b+".json";return v===4?yr+"float/"+x[y]+"/"+w:yr+"quant"+v+"/"+x[y]+"/"+w}(s,l,o),[4,pn(i.modelUrl||c)];case 1:return h=m.sent(),p=new so(h,s),[2,new Qr(p)]}})})}function bo(i){return W(this,void 0,void 0,function(){var s,o,l,c,h;return V(this,function(p){switch(p.label){case 0:if(s=i.outputStride,o=i.quantBytes,Pr==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return l=function(m,b){var y="model-stride"+m+".json";return b===4?gr+"float/"+y:gr+"quant"+b+"/"+y}(s,o),[4,pn(i.modelUrl||l)];case 1:return c=p.sent(),h=new go(c,s),[2,new Qr(h)]}})})}function xo(i){return i===void 0&&(i=br),W(this,void 0,void 0,function(){return V(this,function(s){return(i=function(o){if((o=o||br).architecture==null&&(o.architecture="MobileNetV1"),xr.indexOf(o.architecture)<0)throw new Error("Invalid architecture "+o.architecture+". Should be one of "+xr);if(o.outputStride==null&&(o.outputStride=16),Sr[o.architecture].indexOf(o.outputStride)<0)throw new Error("Invalid outputStride "+o.outputStride+". Should be one of "+Sr[o.architecture]+" for architecture "+o.architecture+".");if(o.multiplier==null&&(o.multiplier=1),Ar[o.architecture].indexOf(o.multiplier)<0)throw new Error("Invalid multiplier "+o.multiplier+". Should be one of "+Ar[o.architecture]+" for architecture "+o.architecture+".");if(o.quantBytes==null&&(o.quantBytes=4),Er.indexOf(o.quantBytes)<0)throw new Error("Invalid quantBytes "+o.quantBytes+". Should be one of "+Er+" for architecture "+o.architecture+".");return o}(i)).architecture==="ResNet50"?[2,bo(i)]:i.architecture==="MobileNetV1"?[2,wo(i)]:[2,null]})})}var cn=["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],Mr=function(){function i(s){this.mask=s}return i.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,gn(this.mask)]})})},i.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,this.mask]})})},i.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,Lr(this.mask)]})})},i.prototype.getUnderlyingType=function(){return"imagedata"},i}();function So(i){if(oe(i),i!==255)throw new Error("Foreground id must be 255 but got "+i);return"person"}function Ao(i){if(oe(i),i>=cn.length)throw new Error("Invalid body part value "+i);return cn[i]}var Eo=function(){function i(s){this.bodyPixModel=s}return i.prototype.segmentPeople=function(s,o){return W(this,void 0,void 0,function(){var l,c,h,p;return V(this,function(m){switch(m.label){case 0:return s instanceof ImageBitmap&&((l=document.createElement("canvas")).getContext("2d").drawImage(s,0,0),s=l),o.segmentBodyParts?o.multiSegmentation?[4,this.bodyPixModel.segmentMultiPersonParts(s,o)]:[3,2]:[3,5];case 1:return h=m.sent(),[3,4];case 2:return[4,this.bodyPixModel.segmentPersonParts(s,o)];case 3:h=[m.sent()],m.label=4;case 4:return c=h.map(function(b){var y=b.data,v=b.width,x=b.height,w=new Uint8ClampedArray(v*x*4).fill(0);return y.forEach(function(A,S){A===-1?(w[4*S]=cn.length,w[4*S+3]=0):(w[4*S]=A,w[4*S+3]=255)}),{maskValueToLabel:Ao,mask:new Mr(new ImageData(w,v,x))}}),[3,10];case 5:return o.multiSegmentation?[4,this.bodyPixModel.segmentMultiPerson(s,o)]:[3,7];case 6:return p=m.sent(),[3,9];case 7:return[4,this.bodyPixModel.segmentPerson(s,o)];case 8:p=[m.sent()],m.label=9;case 9:c=p.map(function(b){var y=b.data,v=b.width,x=b.height,w=new Uint8ClampedArray(v*x*4).fill(0);return y.forEach(function(A,S){A===0?(w[4*S]=0,w[4*S+3]=0):(w[4*S]=255,w[4*S+3]=255)}),{maskValueToLabel:So,mask:new Mr(new ImageData(w,v,x))}}),m.label=10;case 10:return[2,c]}})})},i.prototype.dispose=function(){this.bodyPixModel.dispose()},i.prototype.reset=function(){},i}();function Oo(i){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,xo(i).then(function(o){return new Eo(o)})]})})}var Tr={runtime:"mediapipe",modelType:"general"},jo=function(){function i(s){this.mask=s}return i.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,this.mask]})})},i.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,Hr(this.mask)]})})},i.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,Lr(this.mask)]})})},i.prototype.getUnderlyingType=function(){return"canvasimagesource"},i}();function Mo(i){return oe(i),"person"}var To=function(){function i(s){var o,l=this;this.selfieMode=!1;var c;this.selfieSegmentationSolution=new io.SelfieSegmentation({locateFile:(o=s.locateFile)!==null&&o!==void 0?o:function(h,p){return s.solutionPath?s.solutionPath.replace(/\/+$/,"")+"/"+h:p+"/"+h}}),s.modelType==="landscape"?c=1:c=0,this.selfieSegmentationSolution.setOptions({modelSelection:c,selfieMode:this.selfieMode}),this.selfieSegmentationSolution.onResults(function(h){l.segmentation=[{maskValueToLabel:Mo,mask:new jo(h.segmentationMask)}]})}return i.prototype.segmentPeople=function(s,o){return W(this,void 0,void 0,function(){var l,c;return V(this,function(h){switch(h.label){case 0:return o&&o.flipHorizontal&&o.flipHorizontal!==this.selfieMode&&(this.selfieMode=o.flipHorizontal,this.selfieSegmentationSolution.setOptions({selfieMode:this.selfieMode})),s instanceof Mt?(c=ImageData.bind,[4,_e(s)]):[3,2];case 1:return l=new(c.apply(ImageData,[void 0,h.sent(),s.shape[1],s.shape[0]])),[3,3];case 2:l=s,h.label=3;case 3:return s=l,[4,this.selfieSegmentationSolution.send({image:s})];case 4:return h.sent(),[2,this.segmentation]}})})},i.prototype.dispose=function(){this.selfieSegmentationSolution.close()},i.prototype.reset=function(){this.selfieSegmentationSolution.reset(),this.segmentation=null,this.selfieMode=!1},i.prototype.initialize=function(){return this.selfieSegmentationSolution.initialize()},i}();function Fo(i){return W(this,void 0,void 0,function(){var s,o;return V(this,function(l){switch(l.label){case 0:return s=function(c){if(c==null)return ot({},Tr);var h=ot({},c);return h.runtime="mediapipe",h.modelType==null&&(h.modelType=Tr.modelType),h}(i),[4,(o=new To(s)).initialize()];case 1:return l.sent(),[2,o]}})})}function _o(i,s,o,l){var c=i.width,h=i.height,p=1,m=Math.cos(i.rotation),b=Math.sin(i.rotation),y=i.xCenter,v=i.yCenter,x=1/s,w=1/o,A=new Array(16);return A[0]=c*m*p*x,A[1]=-h*b*x,A[2]=0,A[3]=(-.5*c*m*p+.5*h*b+y)*x,A[4]=c*b*p*w,A[5]=h*m*w,A[6]=0,A[7]=(-.5*h*m-.5*c*b*p+v)*w,A[8]=0,A[9]=0,A[10]=c*x,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,function(S){if(S.length!==16)throw new Error("Array length must be 16 but got "+S.length);return[[S[0],S[1],S[2],S[3]],[S[4],S[5],S[6],S[7]],[S[8],S[9],S[10],S[11]],[S[12],S[13],S[14],S[15]]]}(A)}function Zr(i){return i instanceof Mt?{height:i.shape[0],width:i.shape[1]}:{height:i.height,width:i.width}}function an(i,s){ne(i.width!==0,function(){return s+" width cannot be 0."}),ne(i.height!==0,function(){return s+" height cannot be 0."})}function Po(i,s){var o=function(l,c,h,p){var m=c-l,b=p-h,y=b/m;return{scale:y,offset:h-l*y}}(0,255,s[0],s[1]);return J(function(){return Fe(vn(i,o.scale),o.offset)})}function Ro(i,s,o){var l=s.outputTensorSize,c=s.keepAspectRatio,h=s.borderMode,p=s.outputTensorFloatRange,m=Zr(i),b=function(w,A){return{xCenter:.5*w.width,yCenter:.5*w.height,width:w.width,height:w.height,rotation:0}}(m),y=function(w,A,S){if(S===void 0&&(S=!1),!S)return{top:0,left:0,right:0,bottom:0};var M=A.height,R=A.width;an(A,"targetSize"),an(w,"roi");var _,F,P=M/R,O=w.height/w.width,I=0,U=0;return P>O?(_=w.width,F=w.width*P,U=(1-O/P)/2):(_=w.height/P,F=w.height,I=(1-P/O)/2),w.width=_,w.height=F,{top:U,left:I,right:I,bottom:U}}(b,l,c),v=_o(b,m.width,m.height),x=J(function(){var w,A=(w=i)instanceof Mt?w:mn(w),S=Zi(function(_,F,P){return an(P,"inputResolution"),[1/P.width*_[0][0]*F.width,1/P.height*_[0][1]*F.width,_[0][3]*F.width,1/P.width*_[1][0]*F.height,1/P.height*_[1][1]*F.height,_[1][3]*F.height,0,0]}(v,m,l),[1,8]),M=h==="zero"?"constant":"nearest",R=re.transform(Vt(Dt(A,"float32")),S,"bilinear",M,0,[l.height,l.width]);return p!=null?Po(R,p):R});return{imageTensor:x,padding:y,transformationMatrix:v}}function ko(i,s,o){return J(function(){var l=_t(i,[0]),c=l.shape[2];if(c===1){var h=l;switch(s.activation){case"none":break;case"sigmoid":h=hn(h);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+s.activation+")")}var p=o?re.resizeBilinear(h,[o.height,o.width]):h;return _t(p,[2])}throw new Error("Unsupported number of tensor channels "+c)})}var Fr={runtime:"tfjs",modelType:"general",modelUrl:"https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1"},_r={flipHorizontal:!1},Io={outputTensorSize:{width:256,height:256},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},Bo={outputTensorSize:{width:256,height:144},keepAspectRatio:!1,borderMode:"zero",outputTensorFloatRange:[0,1]},Uo={activation:"none"},Ho=function(){function i(s){this.mask=s}return i.prototype.toCanvasImageSource=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,gn(this.mask)]})})},i.prototype.toImageData=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,Hr(this.mask)]})})},i.prototype.toTensor=function(){return W(this,void 0,void 0,function(){return V(this,function(s){return[2,this.mask]})})},i.prototype.getUnderlyingType=function(){return"tensor"},i}();function Lo(i){return oe(i),"person"}var Te,Do=function(){function i(s,o){this.modelType=s,this.model=o}return i.prototype.segmentPeople=function(s,o){return W(this,void 0,void 0,function(){var l,c=this;return V(this,function(h){return o=function(p){if(p==null)return ot({},_r);var m=ot({},p);return m.flipHorizontal==null&&(m.flipHorizontal=_r.flipHorizontal),m}(o),s==null?(this.reset(),[2,[]]):(l=J(function(){var p=Ro(s,c.modelType==="general"?Io:Bo).imageTensor,m=Yi(c.model.predict(p),[0,0,0,1],-1),b=Zr(s),y=ko(m,Uo,b),v=Vt(y,2),x=Xi(v,[[0,0],[0,0],[0,1]]);return Qi(x,[[0,0],[0,0],[0,2]],"symmetric")}),[2,[{maskValueToLabel:Lo,mask:new Ho(l)}]])})})},i.prototype.dispose=function(){this.model.dispose()},i.prototype.reset=function(){},i}();function Co(i){return W(this,void 0,void 0,function(){var s,o,l;return V(this,function(c){switch(c.label){case 0:return s=function(h){if(h==null)return ot({},Fr);var p=ot({},h);if(p.runtime="tfjs",p.modelType==null&&(p.modelType=Fr.modelType),p.modelType!=="general"&&p.modelType!=="landscape")throw new Error("Model type must be one of general or landscape, but got "+p.modelType);return p.modelUrl==null&&(p.modelType==="general"?p.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1":p.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/landscape/1"),p}(i),o=typeof s.modelUrl=="string"&&s.modelUrl.indexOf("https://tfhub.dev")>-1,[4,pn(s.modelUrl,{fromTFHub:o})];case 1:return l=c.sent(),[2,new Do(s.modelType,l)]}})})}function Jo(i,s){return W(this,void 0,void 0,function(){var o,l;return V(this,function(c){switch(i){case Te.MediaPipeSelfieSegmentation:if(o=void 0,(l=s)!=null){if(l.runtime==="tfjs")return[2,Co(l)];if(l.runtime==="mediapipe")return[2,Fo(l)];o=l.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+o);case Te.BodyPix:return[2,Oo(l=s)];default:throw new Error(i+" is not a supported model name.")}})})}(function(i){i.BodyPix="BodyPix",i.MediaPipeSelfieSegmentation="MediaPipeSelfieSegmentation"})(Te||(Te={}));var No="blurred-mask",zo="mask",Wo="draw-image",fn={};function Vo(i,s,o,l){var c=i.width,h=i.height,p=s.width,m=s.height;if(c!==p||h!==m)throw new Error("error: dimensions must match. "+o+" has dimensions "+c+"x"+h+", "+l+" has dimensions "+p+"x"+m)}function ke(i){if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return function(s){if("offsetHeight"in s&&s.offsetHeight!==0&&"offsetWidth"in s&&s.offsetWidth!==0)return[s.offsetHeight,s.offsetWidth];if(s.height!=null&&s.width!=null)return[s.height,s.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(i);if(typeof ImageData<"u"&&i instanceof ImageData)return[i.height,i.width];if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return function(s){return s.hasAttribute("height")&&s.hasAttribute("width")?[s.height,s.width]:[s.videoHeight,s.videoWidth]}(i);if(i instanceof Mt)return[i.shape[0],i.shape[1]];throw new Error("error: Unknown input type: "+i+".")}function $r(i){return fn[i]||(fn[i]=function(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")}()),fn[i]}function Jr(i,s){var o=$r(s);return function(l,c){c.width=l.width,c.height=l.height,c.getContext("2d").putImageData(l,0,0)}(i,o),o}function Ie(i,s,o,l,c,h){return W(this,void 0,void 0,function(){var p,m,b,y;return V(this,function(v){switch(v.label){case 0:return s instanceof Mt?[4,_e(s)]:[3,2];case 1:p=v.sent(),m=ke(s),b=m[0],y=m[1],s=new ImageData(p,y,b),v.label=2;case 2:return s instanceof ImageData&&(s=Jr(s,Wo)),c==null||h==null?i.drawImage(s,o,l):i.drawImage(s,o,l,c,h),[2]}})})}function Go(i,s){return W(this,void 0,void 0,function(){var o,l,c;return V(this,function(h){switch(h.label){case 0:return o=ke(i),l=o[0],c=o[1],s.width=c,s.height=l,[4,Ie(s.getContext("2d"),i,0,0,c,l)];case 1:return h.sent(),[2]}})})}function Ko(i,s,o){return W(this,void 0,void 0,function(){var l,c,h,p,m,b,y,v;return V(this,function(x){switch(x.label){case 0:for(l=i.getContext("2d"),c=0,h=5,p=1/(2*Math.PI*h*h),m=1,y=-o;y<=o;y+=m)for(v=-o;v<=o;v+=m)b=p*Math.exp(-(v*v+y*y)/(2*h*h)),c+=b;y=-o,x.label=1;case 1:if(!(y<=o))return[3,6];v=-o,x.label=2;case 2:return v<=o?(l.globalAlpha=p*Math.exp(-(v*v+y*y)/(2*h*h))/c*o,[4,Ie(l,s,v,y)]):[3,5];case 3:x.sent(),x.label=4;case 4:return v+=m,[3,2];case 5:return y+=m,[3,1];case 6:return l.globalAlpha=1,[2]}})})}function Yo(i,s,o){return W(this,void 0,void 0,function(){var l,c,h,p;return V(this,function(m){switch(m.label){case 0:return l=ke(i),c=l[0],h=l[1],p=o.getContext("2d"),o.width=h,o.height=c,p.clearRect(0,0,h,c),p.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?[4,Ko(o,i,s)]:[3,2];case 1:return m.sent(),[3,4];case 2:return p.filter="blur("+s+"px)",[4,Ie(p,i,0,0,h,c)];case 3:m.sent(),m.label=4;case 4:return p.restore(),[2]}})})}function Xo(i,s,o){return W(this,void 0,void 0,function(){var l;return V(this,function(c){switch(c.label){case 0:return l=$r(o),[4,Go(i,l)];case 1:return c.sent(),[3,4];case 2:return[4,Yo(i,s,l)];case 3:c.sent(),c.label=4;case 4:return[2,l]}})})}function qo(i,s,o,l){return o===void 0&&(o={r:0,g:0,b:0,a:255}),l===void 0&&(l=.5),W(this,void 0,void 0,function(){var c,h,p,m,b,y,v,x,w,A,S,M,R,_;return V(this,function(F){switch(F.label){case 0:return(c=Array.isArray(i)?i:[i]).length===0?[2,null]:[4,Promise.all(c.map(function(P){return P.mask.toImageData()}))];case 1:for(h=F.sent(),p=h[0],m=p.width,b=p.height,y=new Uint8ClampedArray(m*b*4),v=Math.round(255*l),x=0;x<b*m;++x)for(y[(w=4*x)+0]=o.r,y[w+1]=o.g,y[w+2]=o.b,y[w+3]=o.a,A=0,S=h;A<S.length;A++)(M=S[A]).data[w+3]>=v&&(R=M.data[w],_=s(R),y[w+0]=_.r,y[w+1]=_.g,y[w+2]=_.b,y[w+3]=_.a);return[2,new ImageData(y,m,b)]}})})}function ts(i,s,o,l,c,h){return W(this,void 0,void 0,function(){var p,m,b,y,v;return V(this,function(x){switch(x.label){case 0:return p=ke(s),m=p[0],b=p[1],i.width=b,i.height=m,(y=i.getContext("2d")).save(),[4,Ie(y,s,0,0)];case 1:return x.sent(),y.globalAlpha=l,o?(Vo({width:b,height:m},o,"image","mask"),[4,Xo(Jr(o,zo),c,No)]):[3,3];case 2:v=x.sent(),y.drawImage(v,0,0,b,m),x.label=3;case 3:return y.restore(),[2]}})})}export{ts as N,Te as S,$o as U,Jo as k,qo as q};
